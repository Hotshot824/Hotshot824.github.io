<!DOCTYPE HTML>
<html lang="en" >
    <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="google-site-verification" content="MrJpPCJ8htzZlGpC1wo97QA1_XWns05Ez0LBsW3wj3I" /><title>OS | Process and Thread Â· Home</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="Build Jekyll site with the GitBook style.
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><meta name="author" content="Benson Hsu"><link rel="stylesheet" href="/assets/gitbook/style.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-fontsettings/website.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-search-pro/search.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.css">

<link rel="stylesheet" href="/assets/gitbook/rouge/github.css">

<link rel="stylesheet" href="/assets/gitbook/custom.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="assets/gitbook/images/favicon.ico" type="image/x-icon">




            <link rel="prev" href="/jekyll/2023-10-17-container_of.html" />
        

        
            <link rel="next" href="/jekyll/2023-10-19-cpu_scheduler.html" />
        
    </head>
    <body>
        <div class="book"><div class="book-summary">
    <nav role="navigation">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search" />
        </div>
        <div id="book-search-input-link" role="search">
            <a href="/assets/search.html">Click to Search</a>
        </div>
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="">
            
                <a href="/">
                    Home
                </a>
            </li>

            <li class="divider"></li>

            
                <!-- <p>pages</p> -->
                
                    

                    

                    
                
            
                <!-- <p>posts</p> -->
                
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-25-method_level_structural_unit_testing.html">
                        
                            <a href="/jekyll/2023-11-25-method_level_structural_unit_testing.html">
                                Testing | Method-Level Structural Unit Testing (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-23-based_on_clp_testcases.html">
                        
                            <a href="/jekyll/2023-11-23-based_on_clp_testcases.html">
                                Testing | Based on CLP Testcases
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-28-method_level_function_unit_testing.html">
                        
                            <a href="/jekyll/2023-10-28-method_level_function_unit_testing.html">
                                Testing | Method-Level Functional Unit Testing (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2023-10-26-syntax_analysis.html">
                        
                            <a href="/jekylls/2023-10-26-syntax_analysis.html">
                                Compiler | Syntax Analysis Notes (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-19-cpu_scheduler.html">
                        
                            <a href="/jekyll/2023-10-19-cpu_scheduler.html">
                                OS | CPU Scheduler (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter active" data-level="1.2" data-path="/jekyll/2023-10-18-process_thread.html">
                        
                            <a href="/jekyll/2023-10-18-process_thread.html">
                                OS | Process and Thread
                            </a>
                            
                                
                                    <ul><li><a href="#process-model">Process model</a></li><li><a href="#process-life-cycle">Process Life Cycle</a></li><li><a href="#communication-model-between-process--process">Communication model between Process &amp; Process</a></li><li><a href="#producer-consumer-problem">Producer-Consumer problem</a></li><li><a href="#thread-concept">Thread concept</a></li></ul>

                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-17-container_of.html">
                        
                            <a href="/jekyll/2023-10-17-container_of.html">
                                Note | Linux Kernel Macro container_of &amp; offsetof
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-10-test_case_generation.html">
                        
                            <a href="/jekyll/2023-10-10-test_case_generation.html">
                                Testing | Test Case Generation
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-09-operating_system_structure.html">
                        
                            <a href="/jekyll/2023-10-09-operating_system_structure.html">
                                OS | Operating System Structure
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-23-software_testing_introduction.html">
                        
                            <a href="/jekyll/2023-09-23-software_testing_introduction.html">
                                Testing | Software Testing Introduction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2023-09-21-lexical_analysis.html">
                        
                            <a href="/jekylls/2023-09-21-lexical_analysis.html">
                                Compiler | Lexical Analysis Notes
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-20-compiler_introduction.html">
                        
                            <a href="/jekyll/2023-09-20-compiler_introduction.html">
                                Compiler | Compilers Introduction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-12-operating_system_introduction.html">
                        
                            <a href="/jekyll/2023-09-12-operating_system_introduction.html">
                                OS | Operating System Introduction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-07-test_case_generation_based_on_constraint_logic_graph.html">
                        
                            <a href="/jekyll/2023-09-07-test_case_generation_based_on_constraint_logic_graph.html">
                                Paper | Test Case Generation Based on Constraint Logic Graph
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-07-Introduction_OCL.html">
                        
                            <a href="/jekyll/2023-09-07-Introduction_OCL.html">
                                Note | Object Constraint Language Concepts (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-08-06-gdb_introduction.html">
                        
                            <a href="/jekyll/2023-08-06-gdb_introduction.html">
                                Note | GNU Debugger Quick Notes
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-08-05-linux_kernel_complie.html">
                        
                            <a href="/jekyll/2023-08-05-linux_kernel_complie.html">
                                OS | Linux Kernel Compilation
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-28-UML_structure_diagrams.html">
                        
                            <a href="/jekyll/2023-07-28-UML_structure_diagrams.html">
                                Note | UML Structure Diagrams Introduction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-28-UML_behavior_diagrams.html">
                        
                            <a href="/jekyll/2023-07-28-UML_behavior_diagrams.html">
                                Note | UML Behavior Diagrams Introduction (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-26-unified_modeling_language.html">
                        
                            <a href="/jekyll/2023-07-26-unified_modeling_language.html">
                                Note | Unified Modeling Language Concepts
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-22-property_based_testing_entropy_guided_backbox_REST_API-_fuzzer.html">
                        
                            <a href="/jekyll/2023-07-22-property_based_testing_entropy_guided_backbox_REST_API-_fuzzer.html">
                                Paper | BenFuzz: A Property Based Testing and Entropy Guided Blackbox REST API Fuzzer
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-19-MVVM_modeling_methodology_user_interface.html">
                        
                            <a href="/jekyll/2023-07-19-MVVM_modeling_methodology_user_interface.html">
                                Paper | A MVVM Modeling Methodology for Information Systems User Interface Design
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-18-software_arch_pattern.html">
                        
                            <a href="/jekyll/2023-07-18-software_arch_pattern.html">
                                Note | Architectural Patterns Compare MVP, MVC, MVVM
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-18-automated_gen_test_case_using_UML.html">
                        
                            <a href="/jekyll/2023-07-18-automated_gen_test_case_using_UML.html">
                                Paper | Automated-generating test case using UML statechart diagrams (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-06-23-Intergrated_environment_sdd.html">
                        
                            <a href="/jekyll/2023-06-23-Intergrated_environment_sdd.html">
                                Paper | An Integrated Environment for Specification Driven Development (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-05-28-characteristics_of_bdd.html">
                        
                            <a href="/jekyll/2023-05-28-characteristics_of_bdd.html">
                                Paper | A Study of the Characteristics of Behaviour Driven Development
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-05-20-analysis_mutation_testing.html">
                        
                            <a href="/jekyll/2023-05-20-analysis_mutation_testing.html">
                                Paper | An Analysis and Survey of the Development of Mutation Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-04-21-tdd_concepts.html">
                        
                            <a href="/jekyll/2023-04-21-tdd_concepts.html">
                                Paper | Test-driven development concepts, taxonomy, and future direction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-04-18-applying_isoiec25010.html">
                        
                            <a href="/jekyll/2023-04-18-applying_isoiec25010.html">
                                Paper | Applying the ISO/IEC 25010 Quality Models to Software Product
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-04-13-software_standard.html">
                        
                            <a href="/jekyll/2023-04-13-software_standard.html">
                                Note | Standard - ISO/IEC
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-02-04-algorithm_kmp.html">
                        
                            <a href="/jekyll/2023-02-04-algorithm_kmp.html">
                                Leetcode | Algorithm - KMP
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-01-12-gomoku_ai.html">
                        
                            <a href="/jekyll/2023-01-12-gomoku_ai.html">
                                Note | Gomoku AI - Game Tree
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-24-git_commit.html">
                        
                            <a href="/jekyll/2022-11-24-git_commit.html">
                                Note | Commit Message Format
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-08-ai_csp.html">
                        
                            <a href="/jekyll/2022-11-08-ai_csp.html">
                                Note | Constraint Satisfaction Problem
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-07-network_urat.html">
                        
                            <a href="/jekyll/2022-11-07-network_urat.html">
                                Note | Basic UART Concept
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-05-docker_jekyll.html">
                        
                            <a href="/jekyll/2022-11-05-docker_jekyll.html">
                                Note | Docker Build Github Pages
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/0000-01-01-virtual_machine_tool.html">
                        
                            <a href="/jekyll/0000-01-01-virtual_machine_tool.html">
                                Tool | Virtual Machine
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/0000-01-01-linux_config.html">
                        
                            <a href="/jekyll/0000-01-01-linux_config.html">
                                Tool | Linux Config
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/0000-01-01-leetcode_guide.html">
                        
                            <a href="/jekyll/0000-01-01-leetcode_guide.html">
                                Leetcode | Master Guide
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/0000-01-01-editor_envirmnment.html">
                        
                            <a href="/jekyll/0000-01-01-editor_envirmnment.html">
                                Tool | Edirot Guide
                            </a>
                            
                                
                            
                        </li>
                    

                    
                        <li class="divider"></li>
                    
                
            

            <!-- <li>
                <a href="https://github.com/sighingnow/jekyll-gitbook/fork" target="blank" class="gitbook-link">
                    Fork it Now!
                </a>
            </li> -->
        </ul>
    </nav>
</div>
<div class="book-body">
                <div class="book-header" role="navigation">
                    <!-- Title -->
                    <h1>
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        
                            <a href="." >OS | Process and Thread</a>
                        
                    </h1>
                </div>

                <div class="body-inner"><div class="page-wrapper" tabindex="-1" role="main">
    

    <div class="page-inner">
        <div class="normal">
            
            
            <section class="normal">October 18, 2023</section>
            
        </div>
        <div id="book-search-results">
            <div class="search-noresults">
                <section class="normal markdown-section">
                    
                    <h1 id="/jekyll/process_thread">OS | Process and Thread</h1>
                    

                    <blockquote class="block-tip">
  <p>Operating System: Design and Implementation course notes from CCU, lecturer Shiwu-Lo.</p>
</blockquote>

<p>éç« ç¯ä¸»è¦æ¯ä»ç´¹ Process è· Thread</p>

<ul>
  <li>Process model</li>
  <li>Process Life Cycle</li>
  <li>Communication model between Process &amp; Process</li>
  <li>Communication method between Process &amp; Process</li>
  <li>Producer-consumer problem</li>
  <li>Context switch main overhead (ä½¿ç¨ Thread çåæ©)</li>
  <li>Thread model</li>
</ul>

<h3 id="process-model">Process model</h3>

<h5 id="31-process-concept">3.1 Process Concept</h5>

<ul>
  <li>An OS executes a variety of programs:
    <ul>
      <li><a href="https://en.wikipedia.org/wiki/Batch_processing">Batch system</a> â jobs</li>
      <li>Time-shared systems â user programs or tasks</li>
    </ul>
  </li>
  <li>Process â Task â Job</li>
  <li>Process - a process is an instance of a program in execution
    <ul>
      <li>+Program code (text section)</li>
      <li>+Program counter &amp; registers (CPU status)</li>
      <li>+Stack</li>
      <li>+Data section</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>Batch system(æ¹æ¬¡ç³»çµ±): æ¯æè¢«æéå®æå¨ PC ä¸éè¡ï¼ä¸éè¦èä½¿ç¨èäºåçå·¥ä½</p>
</blockquote>

<h5 id="32-process-memory">3.2 Process Memory</h5>

<ul>
  <li>æ¯å Process éå¸¸æèªå·±å®æ´ç <a href="https://en.wikipedia.org/wiki/Address_space">Address space</a></li>
  <li>32bit çºä¾ï¼æ¯å Process æ 4GB ç Address(Memory) space</li>
  <li>
    <p>64bit ç x64 CPUï¼å çºææ¬çèéï¼éå¸¸åªæä½¿ç¨ 48bit ç Address spaceï¼ä¹å°±æ¯ 256TB (é è¶ Disk çå®¹é)</p>
  </li>
  <li>Address space è¡¨ç¤ºä¸å Process æå¤è½ä½¿ç¨å¤å° Memoryï¼å¯¦éä¸ RAM éå¸¸é å°æ¼ Process ç Address space</li>
  <li>éå¸¸å° Process ç Address space åçºå©åé¨åï¼ä¸åé¨åçº OS Kernelï¼ä¸åé¨åçº Process ç User space</li>
  <li>ä»¥ 64bit çºä¾ï¼ä¸å Process ç Memory address(User space) çº 0~128TBï¼Kernel åçº 256TB(2<sup>64</sup>) å¾ä¸ 128 TB çé¨å
    <ul>
      <li>User space: <code class="language-plaintext highlighter-rouge">00000000 00000000</code> ~ <code class="language-plaintext highlighter-rouge">00007FFF FFFFFFFF</code></li>
      <li>Kernel: <code class="language-plaintext highlighter-rouge">FFFF8000 00000000</code> ~ <code class="language-plaintext highlighter-rouge">FFFFFFFF FFFFFFFF</code></li>
    </ul>
  </li>
</ul>

<p><strong>Why kernel/user space need half of the memory space</strong></p>

<ul>
  <li>æ¯å Process ç Kernel Space é½æ¯å±ç¨çï¼å¨ SMP Processor ä¸ææ Process é½å±ç¨åä¸å Linux Kernel</li>
  <li>DRAM æå¾å¤ç¨éï¼ä¾å¦: ä½çº I/O å éç Buffer/Cache
    <ul>
      <li>I/O Buffer: CPU çè³æå¯ä»¥åå¯«å¥ DRAM bufferï¼ç¶å¾åç± DMA controller å°è³æå¯«å¥ Disk</li>
      <li>I/O Cache: Disk çè³æå¯ä»¥å¯«å¥ DRAM cacheï¼å çº I/O request æç¢ç overhead
        <ul>
          <li>è®å 4kb åè®å 16kb çéåº¦æ¯ä¸æ¨£çï¼é£ä¹¾èä¸æ¬¡å¾ cache è®å 16kb</li>
          <li>OS ææç¸éçè³ææ¾å¨ cacheï¼éæ¨£ä¸æ¬¡è®åå°±å¯ä»¥ç´æ¥å¾ cache è®åï¼èä¸ç¨åæ¬¡è®å Disk</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/1.png?raw=true" alt="" height="100%" width="100%" /></p>

<p><strong>When Multi-Process running, what does the memory look like to users/programmers</strong></p>

<p>éè£¡åªè¨è« User spaceï¼ä¸æ¬¡åªæå·è¡ä¸å Process éä¸å Proces åèªæå®æ´ç user spaceï¼ç¶ Context switch æé¤äº CPU æ§å¶æ¬æè¢«äº¤æå¤ï¼
ä¹æéæ°é²è¡ Memory mapping(ä¿®æ¹ MMU ç mapping table)</p>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/2.png?raw=true" alt="" height="100%" width="100%" /></p>

<p><strong>Internal memory configuration method of the Process</strong></p>

<p>ä¸å Process æ¯æéº¼å¨ Memeory ä¸­é²è¡åéççæ</p>
<ul>
  <li>Local variables: å¨ Stack ä¸­åé</li>
  <li>Global variables
    <ul>
      <li>initialized value: å¨ initialized data åé</li>
      <li>uninitialized value(BSS): å¨ unitialized data åé</li>
    </ul>
  </li>
  <li>Dynamic memory allocation: å¨ Heap ä¸­åé</li>
  <li>Program code: å¨ Text section åéï¼ä¾å¦ Main, malloc function çæä»¤</li>
</ul>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/3.png?raw=true" alt="" height="100%" width="100%" /></p>

<blockquote class="block-tip">
  <p>éå¸¸ OS ä¸æ¬¡æçµ¦ 4096(4K) å¤§å°ç Memoryï¼ä¸¦ä¸ææ¸ç©ºï¼éæ¨£å°±ä¸ææå®å¨æ§åé¡ï¼ä½å¯«ç¨å¼ææå¥½åªé è¨­ BSS æ®µçå¼ææ¯ 0ï¼ä¾å¦ Stack å¯è½æå çºå çº Call/Return çéä¿ï¼èæä¸äºä¸å¯é æçå¼ã
ä½å³ä½¿éæ¨£ä¹ç¡éè¦çµ¦äºåå§å¼ï¼ä¾å¦: int a = 0;ï¼æ¸å°ä¸å¯é æçé¯èª¤ç¼ç</p>
</blockquote>

<p><strong>The position of variable in the Process</strong></p>

<p>å¨ä¸åç¨å¼å·è¡æ</p>
<ul>
  <li>Text/initilized section å¹¾ä¹å°±æ¯ç´æ¥å¾ Disk copy å° Memory</li>
  <li>Unitialized section å çºæ²æè³æå²å­ï¼æä»¥å¯ä»¥ééä¸åè³æçµæ§ä¾æè¿°ï¼ä¸¦æ¾å¨å·è¡æªç Header ä¸­</li>
  <li>Stack/Heap æé¨èç¨å¼å·è¡èè®å¤§ï¼æä»¥æ¾å¨æå¾é¢ä¸¦ä¸å¾ä¸/ä¸æé·</li>
</ul>

<p>ä½æ¯ Stack éå¸¸æè¢«éå¶å¨åºå®å¤§å°ï¼ä¾å¦: ä¸éå§åé 16KBï¼ç¶éè¦æé·æå°± OS å°±ååé 4KBï¼ä½æå¤é·å° 8MBï¼éåå¯ä»¥éé <code class="language-plaintext highlighter-rouge">ulimit</code> æ¥çæä¿®æ¹</p>

<blockquote class="block-tip">
  <p>å¦æä¸å Memory è¢«å¯«å¥ DRAM å¾ï¼ä½é·æéæ²æè¢«ä½¿ç¨ï¼é£éº¼éå Memory å°±æè¢« swap out å° Diskï¼éæ¨£å°±å¯ä»¥éæ¾åº DRAM çµ¦å¶ä» Process ä½¿ç¨</p>
</blockquote>

<p><strong>Linux kernel uses Logical meaning to manage memory segments of processes</strong></p>

<p>Linux Kernel éé task_struct, mm_struct, vm_area_struct ä¾ç®¡ç Process ç Memory:</p>

<ul>
  <li>task_struct: æè¿° Task ç¸éçææè³è¨</li>
  <li>mm_struct: æè¿° Task çè¨æ¶é«ç¸éçè³è¨ï¼ä¾å¦: è©² Task ç Memory space æåªäº area</li>
  <li>vm_area_struct: æè¿°è©² area ç¸éçè³è¨ï¼ä¾å¦: è©² area çèµ·å§ä½ç½®ãå¤§å°ãæ¬éç­ç­
    <ul>
      <li>ä¾å¦é¤äº Text area æ¯å¯ Read, Execute(rx)ï¼å¶ä»ç area é½æ¯å¯ Read, Write(rw)</li>
    </ul>
  </li>
</ul>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/4.png?raw=true" alt="" height="100%" width="100%" /></p>

<p><strong>Example: Lab main.c</strong></p>

<p>æåç¨ä¸åç°¡å®çç¨å¼ main.c ä¾åæ¸¬è©¦:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">b</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="mi">1024</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"pid = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"main = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">main</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"printf = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">printf</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"a=%p, b=%p, c=%p, d=%p, *e=%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
    <span class="n">getchar</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*
benson@vm:~/OSDI$ ./main.exe
pid = 190697
main = 0x55d00a13218a
printf = 0x7f94c1974cc0
a=0x55d00a135010, b=0x55d00a135018, c=0x7ffe4cb7e4b8, d=0x7ffe4cb7e4bc, *e=0x55d00aca62a0
*/</span>
</code></pre></div></div>

<p>ç¶å¾å¨ /proc/<pid>/maps ä¸­å¯ä»¥çå°è©² Process ç Memory configuration:</pid></p>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/5.png?raw=true" alt="" height="100%" width="100%" /></p>

<p><strong>Address space layout randomization</strong></p>

<p>å¦ææåéæ°å·è¡ä¸æ¬¡ç¨å¼ï¼æç¼ç¾ Address åä¸ä¸æ¨£äºï¼éæ¯çºäºé¿åè¢«æ»æï¼å°±æ¯ <strong><a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization">Address space layout randomization</a></strong>(ASLR)</p>

<ul>
  <li>éæ¨£å¯ä»¥é¿åæ»æèä½¿ç¨è¨æ¶é«è£¡é¢çå½æ¸ï¼ä¾å¦: libc è£¡é¢ç system()ï¼å¦æå¯ä»¥å·è¡ system()ï¼é£éº¼å°±å¯ä»¥å·è¡ä»»æçæä»¤</li>
  <li>OS æé¨æ©ç¢çæ¯å Section ç Address</li>
  <li>å¹¾ä¹ææç OS é½æ¯æ´ ASLRï¼ä¾å¦: Linux, BSD, Windows, MacOS</li>
  <li>ä½æ¯ ASLR ä¹æç¼ºé»ï¼å¦æä¸ä½¿ç¨ ASLR é£å°±å¯ä»¥æå¸¸ç¨ç Function æ¾å¨åºå®çä½ç½®ï¼éæ¨£å°±å¯ä»¥å éç¨å¼çå·è¡
    <ul>
      <li>ç®åå¤§é¨åç¡¬é«é½ä½¿ç¨ phy.cache å¯ä»¥éä½éé¨åçå½±é¿</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>ç¾å¨ç Linux Kernel é½æä½¿ç¨ ASLRï¼å³æ¯ KASLR</p>
</blockquote>

<p><strong>Program in Memory</strong></p>

<ul>
  <li>ç®åå¤§é¨åçä½æ¥­ç³»çµ±è¨­è¨ä¸­ï¼å·è¡æªèå¨ Memory ä¸­ççµæ§å¹¾ä¹ä¸æ¨£ï¼OS åªéè¦ Copy(mapping) å°±å¯ä»¥å·è¡äº
    <ul>
      <li>ä¾å¦: Linux ç ELF(Executable and Linkable Format), Microsoft ç PE(Portable Executable)</li>
    </ul>
  </li>
</ul>

<p><img src="https://lh3.googleusercontent.com/blogger_img_proxy/ALY8t1u7XXZ7qZJoQ-wv-kB4apjLJpVS9E4fp8HKIjXVRgwFkMMPeWRSHAoUwWSBHCGG_IEFq4tcAfGYF_juOuKEMqBwApXNKRPWONR53P-UxuNR7KOlR142ePVMs9Xq80uohsQ=s0-d" alt="" height="100%" width="100%" /></p>

<p>å°å·è¡æª Mapping 1:1 æ å°å° Memoryï¼éæ¨£è® OS çå·¥ä½è½è®å¾å¾ç°¡å®</p>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="https://learnlinuxconcepts.blogspot.com/2014/03/memory-layout-of-userspace-c-program.html">Memory Layout of Kernel and UserSpace in Linux.</a></p>
</blockquote>

<h3 id="process-life-cycle">Process Life Cycle</h3>

<h5 id="33-process-life-cycle">3.3 Process Life Cycle</h5>

<p>ä¸é¢æ¯ä¸å Unix Process Life Cycleï¼ä½å¨éè£¡å å¥äºä¸äº Linux çè§å¿µ</p>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/6.png?raw=true" alt="" height="100%" width="100%" /></p>

<p><strong>Parent Process</strong> éå¸¸æ¯ Shellï¼éé fork() ç¢ç Child Process</p>
<ol>
  <li><strong>Ready queue</strong>: ç¶ä¸åæ°ç Process ç¢çæé²å¥ Ready Queueï¼ç­å¾ CPU è³æº</li>
  <li><strong>Running</strong>: å¦æ Scheduler é¸æå°è©² Processï¼é£éº¼å°±æé²å¥ Running çæ</li>
  <li><strong>Waiting</strong>: å¨ Linux ä¸­ Waiting åçºå©ç¨®
    <ul>
      <li>Interruptible: å¯ä»¥è¢« Signal ææ·</li>
      <li>Uninterruptible: ä¸è½è¢« Signal ææ·ï¼ä½æ¯å°æ¸ä¾å¤ä¸ä¾å¦ Kill -9 éæ¯è½å¤  Interruptible</li>
    </ul>
  </li>
  <li><strong>Terminate</strong>: éè£¡éè¦ç± OS å»åæ¶åéçµ¦ Process çè³æºï¼ä¾å¦: Memory, Kernel ä¸­å²å­ç Process ç¸éè³è¨
    <ul>
      <li><em>Zombie</em>: Linux ä¸­æå©ä¸ä¸åå¤§ç´ 4KB ~ 8KB ç Task structï¼ç¨±ä½ Zombie</li>
      <li>ä¿çéå Zombie æ¯çºäºè® Parent Process å¯ä»¥éé wait() åå¾ Child Process çè³è¨ï¼
éè£¡å¦æ Parent æ²ææ­£ç¢ºçåæ¶ Child Processï¼ä½éæ¯æçºéè¡ï¼éæ¨£ Zombie å°±æè¶ä¾è¶å¤ã
ä½å¦æ Parent ä¹çµæäºï¼é£éº¼ Zombie å°±æè¢« init process åæ¶ï¼éæ¨£å°±ä¸ææ Zombie Process</li>
    </ul>
  </li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pid_t</span> <span class="n">child_pid</span><span class="p">;</span>

    <span class="cm">/* Create a child process */</span>
    <span class="n">child_pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">child_pid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* Parent sleep */</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="cm">/* This is clild process will end immediately */</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Child pid %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>éåç¨å¼æå°åº <code class="language-plaintext highlighter-rouge">child_pid</code>ï¼æ­¤æå» top -p <code class="language-plaintext highlighter-rouge">child_pid</code> å°±å¯ä»¥çå° child è®æ zombie çæã</p>

<blockquote>
  <p>fork() æè¿å child pidï¼ä½å¨ child process ä¸­ child_pid ææ¯ 0</p>
</blockquote>

<h5 id="34-tack-contol-blocktcb-pcb">3.4 Tack Contol Block(TCB, PCB)</h5>

<blockquote>
  <p>Process control block â Task control block</p>
</blockquote>

<p><strong><a href="https://en.wikipedia.org/wiki/Process_control_block">Process control block</a></strong>(PCB) å°±æ¯ OS ç¨ä¾ç®¡ç Process çè³æçµæ§ï¼éå¸¸æåå«ä»¥ä¸è³è¨:</p>
<ul>
  <li><strong>Process state</strong>: å·è¡ççæï¼ä¾å¦: Running, Waiting, Ready</li>
  <li><strong>CPU information</strong>: Process ççæï¼ä¾å¦: PC, Register</li>
  <li><strong>Memory information</strong>: Memory çæï¼ä¾å¦: Text, Data section</li>
  <li><strong>Schedule information</strong>: æç¨è³è¨ï¼ä¾å¦: Priority</li>
  <li><strong>I/O status information</strong>: I/O çæï¼ä¾å¦: File descriptor</li>
  <li><strong>Using resource</strong>: Process ä½¿ç¨çè³æºï¼ä¾å¦: File, I/O device<br />
â¦</li>
</ul>

<div style="display: flex; flex-direction: row; align-items: center;">
    <img src="https://0uyangsheng.github.io/2018/05/17/Linux-process/task_struct.jpg" width="53%" height="53%" />
    <img src="https://mohammednv.files.wordpress.com/2013/06/process-structure.png" width="47%" height="47%" />
</div>

<h5 id="35-three-scheduler-model">3.5 Three Scheduler Model</h5>

<p>Scheduler ä¸æ¯åªæ CPU Schedulerï¼éæ Long-term Scheduler, Mid-term Scheduler:</p>
<ul>
  <li><strong>Long-term Scheduler</strong>(Job scheduler):
    <ul>
      <li>æ±ºå®åªäº Process è¦é²å¥ Ready Queueï¼éå¸¸å¨å¾å¤§åçä¸»æ©ä¸ï¼ä¾å¦: å°ç£æ</li>
      <li>Linux ä¸­ä¸¦æ²æ Long-term Schedulerï¼Task ç¢çå¾å°±æé²å¥ Ready Queue</li>
    </ul>
  </li>
  <li><strong>Mid-term Scheduler</strong>(Swapper):
    <ul>
      <li>ç¶ Degree of Multiprogramming éé«æå¯è½é æ(thrashing)ï¼å°ä¸äº Task swap out å° Diskï¼ç­å°è³æºè¶³å¤ æå swap in</li>
      <li>Linux Kernel ç®åä¹æ²æ Mid-term Schedulerï¼ä½ Linux ä¾ç§ Task è¨æ¶é«çä½¿ç¨ææ³ï¼å¨ Memory ä¸è¶³ææå°ä¸æ´»èºç Task swap out å° Disk</li>
    </ul>
  </li>
  <li><strong>Short-term Scheduler</strong>: CPU Scheduler
    <ul>
      <li>å¤§é¨åç OS åªæ CPU Schedulerï¼éå°åç¨®äºä»¶æå°å±¬ç Waiting Queueï¼ä¾å¦: ä¾å¦ I/O, Semaphore</li>
    </ul>
  </li>
</ul>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/7.png?raw=true" alt="" height="75%" width="75%" /></p>

<blockquote class="block-tip">
  <p>thrashing(è¼¾è½ç¾è±¡) æçæ¯ç¶èæ¬è¨æ¶é«è¢«ä½¿ç¨éåº¦ï¼å°è´å¤§é¨åçå·¥ä½å¨èç Page fault æé æç Page Replacementï¼éæ¨£å°±æé æ CPU æè½ä¸é</p>
</blockquote>

<h5 id="36-context-switchctx-sw">3.6 Context Switch(ctx-sw)</h5>

<ul>
  <li>ç®åä¸»æµç OS é½æ¯åªæ Task å·è¡å¨ Kernel Space ææè½é²è¡ Context switch</li>
  <li>Context switch ä¸»è¦æ¯åæ Register è Memory çå§å®¹</li>
  <li>Context switch ç overhead ä¸»è¦æ¯ç¼çå¨ Cache memory çæ´æ°</li>
</ul>

<ol>
  <li>é¦å TaskA Mode change å° Kernel mode</li>
  <li>ç¶å¾å° TaskA çè³è¨(TCB) å²å­èµ·ä¾</li>
  <li>è¼å¥ TaskB çè³è¨</li>
  <li>æå¾ TaskB Mode change å° User mode</li>
</ol>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/8.png?raw=true" alt="" height="75%" width="75%" /></p>

<blockquote class="block-tip">
  <p>Scheduler ä¹å°±æ¯ç­ç¥çé¨åä¸»è¦æ¯ç¨ C å¯«çï¼ä½åæçé¨åæ¯ç¨ Assembly å¯«çï¼å çºè¦ç´æ¥æä½ Register</p>
</blockquote>

<h5 id="37-processes-are-divided-into-io-and-cpu">3.7 Processes are divided into I/O and CPU</h5>

<ul>
  <li>I/O Bound process - I/O timeÂ Â» CPU time
    <ul>
      <li>ä¾å¦: ftp server</li>
    </ul>
  </li>
  <li>CPU Bound process - CPU timeÂ Â» I/O time
    <ul>
      <li>ä¾å¦: image processing</li>
    </ul>
  </li>
  <li>å¦æå¯ä»¥é¸æçè©±ï¼è®ç³»çµ±ä¸­åæå­å¨ I/O Bound process è CPU Bound processï¼å¯ä»¥è®ç³»çµ±çæçæå¤§å</li>
  <li>éå¸¸ I/O Bound çåªåæ¬æ¯è¼é«ï¼å çºè¶å¿«è® CPU ç¼åºå½ä»¤çµ¦ I/O deviceï¼ç¶å¾å°±å¯ä»¥å»å·è¡å¶ä»ç Task</li>
</ul>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/9.png?raw=true" alt="" height="50%" width="50%" /></p>

<blockquote>
  <p>I/O Bound éå¸¸åªéè¦ä¸å°é¨åç CPU è³æºï¼å¦æè¨­å®æ CPU Bound åªåæ¬è¼é«ï¼åèæé æ I/O Bound ç Task å¨çµæä¸æ®µ I/O å¾éè¦ç­å¾ CPU Bound ç Task çµæ
é æ CPU ä½¿ç¨çä¸é</p>
</blockquote>

<h5 id="38-process-creation">3.8 Process Creation</h5>

<ul>
  <li>Linux ä¸­å¯ä»¥éé fork, vfork, clone ä¾ç¢ç Process
    <ul>
      <li>å¯¦éä¸éä¸åå¨ Kernel ä¸­é½æ¯å¼å« do_fork() ä¾å®æ</li>
    </ul>
  </li>
  <li>Linux ä¸­ pid 0 æ¯ idle processï¼åªåæ¬æä½ï¼åªè² è²¬è® CPU é²å¥ç¡ç çæ
    <ul>
      <li>éå¸¸ä¹å«å swapperï¼æ¯é¡ core æä¸åèªå·±ç idle task</li>
    </ul>
  </li>
  <li>pid 1 æ¯ç³»çµ±ä¸­ç¬¬ä¸å user space çè¡ç¨ï¼è² è²¬ä½æ¥­ç³»çµ±çåå§å
    <ul>
      <li>ä¾å¦: ç¶é»è¦ååæç Daemon Process</li>
    </ul>
  </li>
  <li>fork åºç Process å¶ç¨å¼ç¢¼èç¶ Process å®å¨ç¸åï¼å¦æè¦è¼å¥æ°çç¨å¼ç¢¼å°è©² process ä¸­ï¼ä½¿ç¨ execve ç³»çµ±å¼å«
    <ul>
      <li>å¦æéè¦å¤§éçå·è¡ execveï¼é£ä½¿ç¨ vfork ææ¯è¼å¥½ï¼å çº vfork æ Block parent process</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>pid 0 Process(idle process) ä¹æ¯å¯ä¸æ²æä½¿ç¨ fork() ç¢çç Processï¼å çº pid 0 æ¯ç³»çµ±ååæå°±ç¢çç Process</p>
</blockquote>

<blockquote>
  <p>ä½¿ç¨ pstree -p å°±è½çå°ï¼ææç Process é½æ¯ç± systemd(pid 1) ç¢çç</p>
</blockquote>

<p>ä¾å¦: å¾ bash å»å·è¡ ls ææä»¥ä¸çæµç¨</p>
<ol>
  <li>bash fork åºä¸å child processï¼ç¶å¾ parent process wait()</li>
  <li>child process éé execve() å»å·è¡ ls</li>
  <li>ls å·è¡å®å¾ï¼éé exit() çµæï¼åå° parent process</li>
</ol>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/10.png?raw=true" alt="" height="50%" width="50%" /></p>

<h5 id="39-process-termination">3.9 Process Termination</h5>

<ul>
  <li>å¨ UNIX-Like OS ä¸­ï¼å¦æä¸å Process Terminateï¼æè®æ Zombie çæï¼Zombie Process æ¯ç¡æ³è¢« kill çï¼åªè½éé Parent Process ä½¿ç¨ wait() ä¾åæ¶
    <ul>
      <li>éé wait() Parent Process å¯ä»¥åå¾ Child Process ççµæçæï¼ä¾å¦: ä½¿ç¨äºå¤å°ç³»çµ±è³æº</li>
    </ul>
  </li>
  <li>åºæ¼ç¹å®çéæ±ï¼ä¹å¯ä»¥ç´æ¥å° Process kill æ
    <ul>
      <li>kill -9 pid æç´æ¥ç¼é SIGKILL(signal 9) çµ¦è©² Processï¼è®è©² Process ç«å³çµæ</li>
      <li>kill pid åæ¯ç¼é SIGTERM(signal 15) çµ¦è©² Processï¼è®è©² Process åªéççµæèªå·±</li>
    </ul>
  </li>
  <li>æäº OS è¨­è¨ Parent process kill æå¾ï¼Child process ä¹æè¢« kill æ
    <ul>
      <li>UNIX-Like OS ä¸­ï¼å¦æ Parent process è¢« kill æï¼Child process æè¢« init process(pid 1) æ¥ç®¡</li>
      <li>init å§é¨æä¸åç¡çª®è¿´åï¼æä¸æ·çå·è¡ wait()ï¼éæ¨£å°±å¯ä»¥åæ¶ææç Zombie Process</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>ä¾å¦æåå¯ä»¥éé nohup æ screen ä¾è® Process å¨èæ¯å·è¡ï¼éæ¨£å°±ä¸æå çº Terminal è¢«ééèè¢« kill æ</p>
</blockquote>

<h3 id="communication-model-between-process--process">Communication model between Process &amp; Process</h3>

<p>OS ä¿è­æ¯å Process ä¹éé½å¯ä»¥ç¨ç«çéè¡</p>
<ul>
  <li>ä½å¦æçç Process é½å®å¨ç¨ç«éè¡ï¼é£ç³»çµ±å°±æè®å¾å¾é£ä½¿ç¨
    <ul>
      <li>ä¾å¦: copy-paste</li>
    </ul>
  </li>
  <li>æä»¥ OS ææä¾ä¸äºæ¹æ³è® Process communication</li>
</ul>

<h5 id="310-interprocess-communicationipc">3.10 Interprocess Communication(IPC)</h5>

<p>IPC æ¯æå¯ä»¥è®å©åç¨ç«ç Process äºç¸å³éè¨æ¯ï¼å³éè¨æ¯çç®çå¤åæ¯</p>
<ul>
  <li>å³éè³è¨ï¼ä¾å¦: copy-pasteãinformation sharing</li>
  <li>åæ­¥ï¼ä¾å¦: Parallel computing</li>
  <li>æ¨¡çµåè¨­è¨ï¼ä¾å¦: å° Request è Worker åé</li>
</ul>

<p><strong>IPC Model</strong></p>

<p>éè£¡è«çä¸»è¦æ¯ IPC çåé¡ï¼èä¸æ¯ IPC çå¯¦ä½</p>

<ul>
  <li>å¦ä½å¨ Process ä¹éå»ºç« IPC</li>
  <li>å¯ä»¥å»ºç«å¤å°æ¢ IPC å¨ Process ä¹é</li>
  <li>å¯å¦å¤å Process åæä½¿ç¨åä¸å IPC</li>
  <li>IPC ææ²æå®¹ééå¶</li>
  <li>IPC ä¸­æ¯ä¸å Message çå¤§å°æ¯å¦æ¯åºå®ç</li>
  <li>
    <p>IPC æ¯å®åçéæ¯éåç</p>
  </li>
  <li>Direct communication(ç´æ¥å³é): æ¯åéè¦éè¨å¿é æç¢ºçæå®æ¥æ¶èæç¼éè
    <ul>
      <li>å¯ä»¥æ¯å®åä¹å¯ä»¥æ¯éåç</li>
      <li>ä¾å¦: Pipe</li>
    </ul>
  </li>
  <li>Indirect communication(éæ¥å³é): Message æ¯ç¼éå° Mailbox ä¸­ç¶å¾ç± Receiver èªè¡ååº
    <ul>
      <li>æ¯éåçï¼ä¸¦ä¸å¯ä»¥å»ºç«å¤æ¢ IPC æè®å¤å Process ä¸èµ·æ¥æ¶</li>
      <li>å çºæ Mailbox æä»¥å°±è¦èæ® Buffer çåé¡
        <ul>
          <li>æ²æ Buffer: é£å°±å¿é ç­å° Recv çµæï¼ç¼éèæè½ç¹¼çºå·è¡
            <ul>
              <li>åªé»æ¯éåº¦éå¸¸æ¯è¼å¿«ï¼éé Scheduler æè¨±æäºè³è¨å¯ä»¥æ¾å¨ Register ä¸­ç´æ¥å³é</li>
            </ul>
          </li>
          <li>åºå® Buffer: ç¼éèå°è³æ Send å° Buffer ä¸­å°±å¯ä»¥ç¹¼çºå·è¡</li>
          <li>å¤å Buffer: ç¼éèå¯ä»¥ä¸ç´éè³æï¼ä½éå¸¸æéå¶ç¼éçæ¸éé¿åæ¡æç¨å¼</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><strong>Direct communication</strong></p>

<p>éå¸¸ä½¿ç¨ Process id ä¾å°è¨æ¯ä¸çµ¦å°æ¹:</p>
<ul>
  <li>send(P, message)</li>
  <li>receive(Q, message), receive(&amp;Q, message)</li>
  <li>Receiver å¯ä»¥æå®æ¯è¦å¾åªè£¡æ¶ï¼æèæ¶ä»»ä½è¨æ¯ï¼ç± OS ä¾åç¥æ¯èª°éç</li>
</ul>

<p>Feature</p>
<ul>
  <li>ä¸éè¦ç¹å¥çå»ºç«é£æ¥</li>
  <li>ç±æ¼ä½¿ç¨ Process id ä¾å³éè¨æ¯ï¼å æ­¤åªè½æ¯ä»»å©å Process ä¹éå³éè¨æ¯
    <ul>
      <li>ç± P å Q å©åå®é å³éä¾çµåæä¸åéåå³é</li>
    </ul>
  </li>
</ul>

<p><strong>Indirect communication</strong></p>

<p>éè¦ç±ä½¿ç¨èä¾å»ºç«å³è¼¸éé</p>
<ul>
  <li>ä¾å¦: Linux ç mkfifo, pipe</li>
  <li>ä¾å¦: TCP/IP (å¦æå¨åä¸å°æ©å¨ä¸å³è¼¸è³æï¼ä¸æç¶é Network card)</li>
</ul>

<p>Feature</p>
<ul>
  <li>æºéçè¡ç¨å¯ä»¥å»ºç«å¤åééï¼å¯ä»¥ç°¡åè¨­è¨è¤éåº¦</li>
  <li>å¯ä»¥ãå¤åå³è¼¸è¡ç¨ãå°ãå¤åæ¥æ¶è¡ç¨ãï¼å¸¸è¦æ¼ Server çè¨­è¨</li>
  <li>éåï¼ä¾å¦: Shared memory</li>
  <li>å®åï¼ä¾å¦: pipe</li>
</ul>

<p><strong>Problems by many-to-many</strong></p>

<p>å¦ææãå¤åå³è¼¸è¡ç¨ãå°ãå¤åæ¥æ¶è¡ç¨ã</p>
<ul>
  <li>ç±èª°æ¥æ¶
    <ul>
      <li>æ¯å¦ç±ãééç®¡çç¨å¼ãæ±ºå®?</li>
      <li>èª°åç¼èµ·ï¼å°±ç±èª°æ¶</li>
    </ul>
  </li>
  <li>æ¶äºè¨æ¯ä¹å¾æéº¼èç
    <ul>
      <li>ç§»é¤è¨æ¯ï¼éå¸¸ç¨æ¼ Server å° Task äº¤çµ¦ä¸å Sub-Server</li>
      <li>ä¸ç´å­å¨ï¼é¡ä¼¼æ¼å»£æ­</li>
    </ul>
  </li>
</ul>

<p><strong>Blocking &amp; Non-Blocking</strong></p>

<ul>
  <li>å¦ææè¶³å¤ å¤ç Buffer çè©±ï¼Process éçéè¨å¯ä»¥æ¯ Non-blocking
    <ul>
      <li>éåº Message å¾ Process ç¹¼çºä¸ä¸åå·¥ä½</li>
      <li>ä¾å¦: signal</li>
    </ul>
  </li>
  <li>å¦æ Buffer ä¸è¶³ï¼æèæ ¹æ¬æ²æ Buffer çè©±ï¼å°±åªè½æ¯ Blocking
    <ul>
      <li>éåº Message å¾å¿é ç­å¾ Receiver æ¥æ¶å®ç¢ï¼æè½ç¹¼çºå·¥ä½</li>
      <li>éåçå¥½èæ¯å¯ä»¥ç¢ºèªå°æ¹å·²ç¶æ¶å° Message</li>
    </ul>
  </li>
</ul>

<h5 id="311-communication-method-direct-or-indirect">3.11 Communication method Direct or Indirect</h5>

<p><strong>Shared Memory</strong></p>

<p>å¨ Physical memory ä¸ Process A å Process B æ¯ä½¿ç¨ä¸åçåæ®µï¼ä½æ¯ Shared memory å°±ä½¿ç¨åä¸åæ®µ</p>
<ul>
  <li>è¦æ³¨æéè£¡æ¯ Physical memoryï¼ä½å¨ Process ä¸­æ¯ä¸åç Logical address</li>
  <li>å¨ Linux ä¸å¯ä»¥éé mmap() ä¾å»ºç« Shared memory</li>
</ul>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/11.png?raw=true" alt="" height="50%" width="50%" /></p>

<p><strong>Message Passing</strong></p>

<ul>
  <li>å¨ Process A æå¼å« Kernel copy è³æå° Kernel space</li>
  <li>Context switch å° Process B æï¼Kernel åå°è³æ copy å° Process B ç Memory</li>
</ul>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/12.png?raw=true" alt="" height="50%" width="50%" /></p>

<h3 id="producer-consumer-problem">Producer-Consumer problem</h3>

<p>éè£¡åç°¡å®è¨è« <a href="https://en.wikipedia.org/wiki/Producer%E2%80%93consumer_problem">Producer-Consumer Problem</a> çæ¦å¿µï¼å¾é¢æåè¨è«å¦ä½è§£æ±º</p>

<ul>
  <li>åå¦æå©å Process å±äº«ä¸ååºå®å¤§å°ç Bufferï¼Producer æä¸æ·çç¢çè³æï¼ç¶å¾æ¾å° Buffer ä¸­ç± Consumer ä¾ååº
    <ul>
      <li>å¦æ Buffer æ»¿äºï¼Producer å°±å¿é ç­å¾ Consumer ååºè³æ</li>
      <li>å¦æ Buffer ç©ºäºï¼Consumer å°±å¿é ç­å¾ Producer ç¢çè³æ</li>
      <li>éæ¨£å¦ææ²æè¨­è¨å¥½å°±å®¹æé æ <a href="https://en.wikipedia.org/wiki/Deadlock">Deadlock</a></li>
    </ul>
  </li>
</ul>

<p>å¦ææ¯å®å°å®ç Producer-Consumerï¼å¯ä»¥ééä¸åç°ç Linked list è§£æ±ºï¼è©³æè«ç <a href="https://www.youtube.com/watch?v=0XQAfLYfQkg&amp;list=PLMWkAn-aOA0bRR7n_A86Hs51B2WrAQA9i&amp;index=53">OS-CH03-éè¦ççç¢æ¶è²»åé¡</a></p>

<hr />

<h3 id="thread-concept">Thread concept</h3>

<h5 id="312-context-switch-main-overhead">3.12 Context switch main overhead</h5>

<p>The overhead of context-switch</p>
<ul>
  <li>Store/restore the register file (~1KB)</li>
  <li>TLB miss (~1KB)</li>
  <li>CPU cache miss (~1MB)</li>
</ul>

<p>å¨ Context ä¸­æä¸»è¦çæ¶èå°±æ¯ Cache missï¼éåæ±ºæ¼ç¡¬é«çæ¯æ´</p>
<ul>
  <li><strong>Virtual cache</strong>: å°±éè¦æ Flush Cacheï¼éé MMU å° Virtual address å°æå° Physical address</li>
  <li><strong>Physical cache</strong>: ä¸éè¦ Flush cache
    <ul>
      <li>éè¦ MMU è½æ Virtual address æ Physical addressï¼æè½æ¾å¥ Cacheï¼è½æçéç¨å°±ææ Latency</li>
      <li>ä¾å¦: CPU Cache miss å¨ç­å¾ L2 Cache æå°è³æï¼ææ¯ L1 miss ä¹å¾éè¦ MMU è½æ L2 ä¹å¾æè½åå­å</li>
      <li>ä¾å¦: Process A/Bï¼é²è¡äºä¸å A -&gt; B -&gt; A çåæï¼å®ååèªå·è¡çæåé½ææè³ææ¾å¥ Cacheï¼A åªè½ææ B æ²æè¦èæéè¦çè³æ</li>
    </ul>
  </li>
  <li>Cache æ¯å¦æ¯æ´ <strong>ASID</strong> (Address Space Identifier)
    <ul>
      <li>å¨ TLB ä¸­å å¥ä¸å Process IDï¼åªæç¶ ASID è Page number é½ç¸åæï¼ææ Hit</li>
    </ul>
  </li>
</ul>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/13.png?raw=true" alt="" height="40%" width="40%" /></p>

<h5 id="313-thread-memory">3.13 Thread memory</h5>

<ul>
  <li>Thread å¨åä¸å¡ Virtual memory ä¸­å·è¡ï¼ä½æ¯æåèªç Stack</li>
  <li>å çºå¨åä¸å¡ Virtual memory ä¸­å·è¡ï¼æä»¥ Thread1 å¯ä»¥å­å Thread2 ç Stack
    <ul>
      <li>è¦åéæ¨£çå­åè¦æéï¼å çº Stack æé¨è Function call èè®å</li>
    </ul>
  </li>
</ul>

<p><strong>Thread Local Storage</strong></p>

<p>åæ¨£ç Thread ä¹éä¹ææåèªç Local variableï¼éäº Local variable ææ¾å¨ Thread Local Storage ä¸­ï¼
éæ¯ç± Compiler ä¾è¨­è¨çï¼è®æ¯å TLS åç§»éé½ä¸ä¸æ¨£ï¼éæ¨£å°±è½è® Thread å­åèªå·±ç Local variableã</p>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/14.png?raw=true" alt="" height="75%" width="75%" /></p>

<h5 id="314-thread-history">3.14 Thread history</h5>

<ul>
  <li>Many to One</li>
  <li>One to One</li>
  <li>Many to Many</li>
</ul>

<p><strong>Many to One</strong></p>

<p>å¤å°ä¸å°±æ¯å©å Thread å±ç¨ä¸å PCBï¼éæ¨£çè©±å¦æå¶ä¸­ä¸å Thread è·å»å I/O çè©±ï¼é£æ´å Process å°±æè¢« Blockï¼éæ¨£å°±æé ææ´å Process é½è¢« Blockã
åæç±æ¼ OS ä¸æç¥é PCB ä¸çæ¯å©å Threadï¼æä»¥ç¡æ³åå¤æ ¸å¿ä¸å·è¡ï¼éæ¨£å°±æé ææè½çä¸éã</p>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/15.png?raw=true" alt="" height="100%" width="100%" /></p>

<blockquote>
  <p><strong>Green thread</strong>
Green thread æ¯çºäºå¨åºå±¤ç OS ä¸æ¯æ´ Thread çææ³ä¸ï¼éé Library ä¾æ¨¡æ¬ Thread çè¡çºï¼ä½éæ¨£å°±åªè½ä½¿ç¨ Many to One çæ¨¡åï¼ä¾å¦: Java ç Thread</p>
</blockquote>

<p>éå¸¸åªæå¨ OS Kernel ä¸æ¯æ´ Multi-thread çææ³ä¸ï¼ææä½¿ç¨ Many to Oneï¼ç±æ¼ææç User thread å¨ Kernel é½åªæä¸å PCBï¼
æä»¥å¦æ Thread è·å»å Block çæä½æå°è´å¶ä» Thread ä¹è¢« Blockãä¸¦ä¸å°±ç®æå¾å¤ Processor éå¸¸ä¹åªæä¸å Thread å¨å·è¡ï¼å¶ä» Thread é½å¨ç­å¾ã</p>

<p><strong>One to One</strong></p>

<p>éå¸¸æ¯æå¤ OS ä½¿ç¨ç Modelï¼æ¯å Thread é½æèªå·±ç PCBï¼è¦éé Memory control block ä¾å¤æ·æ¯ Thread éæ¯ Processï¼
å¦æå±ç¨ Memory control block çè©±ï¼é£å°±å¤å®ä»æ¯ä¸å Threadã</p>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/16.png?raw=true" alt="" height="100%" width="100%" /></p>

<ul>
  <li>ç±æ¼æ¯å Thread é½æèªå·±ç PCBï¼æä»¥å¯ä»¥å¨å¤æ ¸å¿ä¸å·è¡</li>
  <li>å¤§é¨åé½æ¯ Non-blockingï¼æä»¥å¨èç Block çä»»åä¸æå¾æå½æ§</li>
</ul>

<p><strong>Many to Many</strong></p>

<p>ä¸é¢çç¨±ä½ User threadï¼ä¸é¢ç¨±ä½ Kernel threadï¼å°æçæ¹å¼æå¾å¤ç¨®ï¼ä¾å¦ä¸åä»£è¡¨ä¸é¢ç User thread å¯ä»¥åæç¼åºåç­ Kernel thread æ¸éç System callï¼
ä½ç¼ºé»æ¯éå¸¸è¤éä¸¦å¯«ä¸å¥½å¯«ï¼ä¸¦ä¸ä¸æçè§£ï¼è®ç¨å¼è¨­è¨èå¾é£é²è¡åªåã</p>

<p><img src="https://github.com/Hotshot824/Hotshot824.github.io/blob/master/_image/2023-10-18-process_thread/17.png?raw=true" alt="" height="100%" width="100%" /></p>

<ul>
  <li>çèµ·ä¾æ¯ææå½æ§ç Thread</li>
  <li>Sun Solaris 9 ä¹åæ¯æ´ Many to Many Model</li>
  <li>Sun Solaris 10 ä¹å¾æ¹çºä¸»è¦æ¯æ´ One to One Model</li>
</ul>

<blockquote class="block-warning">
  <h5 id="last-edit">Last Edit</h5>
  <p>10-21-2023 18:52</p>
</blockquote>


                </section>
            </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div></div>
        <div class="normal">
            <section class="normal">
                
                <i class="fa fa-tags"></i>
                
                OS
                
                
            </section>
        </div>
    </div>
</div>

<script>
MathJax = {
  tex: {
    inlineMath: [ ['$', '$'], ['\\(', '\\)'] ]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script
  type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script><!-- customize line 38-50 swap next previous-->
                    
                        <a href="/jekyll/2023-10-19-cpu_scheduler.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Note | Linux Kernel Macro container_of & offsetof">
                            <i class="fa fa-angle-left"></i>
                        </a>
                    

                    
                        <a href="/jekyll/2023-10-17-container_of.html" class="navigation navigation-next navigation-unique" aria-label="Next page: OS | CPU Scheduler (Unfinished)">
                            <i class="fa fa-angle-right"></i>
                        </a>
                    
                </div>
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "next": {
            "title": "OS | CPU Scheduler (Unfinished)",
            "level": "1.2",
            "depth": 1,
            "path": "_posts/2023-10-19-cpu_scheduler.md",
            "ref": "_posts/2023-10-19-cpu_scheduler.md",
            "articles": []
        },
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 1,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},            "sharing": {
                // "all": ["facebook", "google", "twitter", "weibo", "instapaper", "github", "telegram"],
                "facebook": false,
                "google": false,
                "github": true,
                "github_link": "https://github.com/Hotshot824",
                "telegram": false,
                "telegram_link": "https://t.me",
                "instapaper": false,
                "twitter": false,
                "vk": false,
                "weibo": false
            },
"theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "Home.md",
        },
        "variables": {},
        "title": "Home",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "_posts/2023-10-18-process_thread.md",
        "mtime": "2023-10-18 00:00:00 +0800",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2023-11-26 15:42:15 +0800"
    },
    "basePath": "",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/assets/gitbook/gitbook.js"></script>
<script src="/assets/gitbook/theme.js"></script>

<script src="/assets/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
<script src="/assets/gitbook/gitbook-plugin-sharing/buttons.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> -->

<script src="/assets/gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
<script src="/assets/gitbook/gitbook-plugin-search-pro/search.js"></script>
<script src="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>

</body>
</html>