<!DOCTYPE HTML>
<html lang="en" >
    <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="google-site-verification" content="MrJpPCJ8htzZlGpC1wo97QA1_XWns05Ez0LBsW3wj3I" /><title>OS | CPU Scheduler Â· Home</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="Build Jekyll site with the GitBook style.
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><meta name="author" content="Benson Hsu"><link rel="stylesheet" href="/assets/gitbook/style.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-expandable-chapters-small2/expandable-chapters-small.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-fontsettings/website.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-search-pro/search.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-splitter/splitter.css">

<link rel="stylesheet" href="/assets/gitbook/rouge/colorful.css">

<link rel="stylesheet" href="/assets/gitbook/custom.css">
<link rel="stylesheet" href="/assets/gitbook/custom-local.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/assets/gitbook/images/favicon.ico" type="image/x-icon">




            <link rel="prev" href="/jekyll/2023-10-18-process_thread.html" />
        

        
            <link rel="next" href="/jekylls/2023-10-26-syntax_analysis.html" />
        
    </head>
    <body>
        <div class="book"><div class="book-summary">
    <script type="text/javascript">
        // Fixes the page links scroll problem on both desktop and mobile browsers
        function pageScrollToTop(element) {
            // both mobile and non-mobile
            $('div.body-inner').animate({scrollTop: 0});
            $(element).parent().find('li>ul>li').removeClass('active');
            return true;  // propagate
        }
        // Fixes the anchor links scroll problem on mobile browsers
        function mobilePageScrollToAnchor(element) {
            $(element).closest('li.chapter').find('ul>li').removeClass('active');
            $(element).parent().addClass('active');
            if ($(document).width() <= 1240) {
                $('div.body-inner').animate({scrollTop: $($(element).attr('href')).get(0).offsetTop});
            }
            return true;
        }
    </script>

    <nav role="navigation">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search" />
        </div>
        <div id="book-search-input-link" role="search">
            <a href="/assets/search.html">Click to Search</a>
        </div>
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="">
            
                <a href="/" onclick="pageScrollToTop(this)">
                    Home
                </a>
            </li>

            <li class="divider"></li>

            
                <!-- <p>pages</p> -->
                
                    

                    

                    
                
            
                <!-- <p>posts</p> -->
                
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2025-09-13-Big_Number_Multiplication.html">
                        
                            <a href="/jekyll/2025-09-13-Big_Number_Multiplication.html" onclick="pageScrollToTop(this)">
                                Algorithm | Big Number Multiplication
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2025-09-12-Binary_Search_Tricks_and_Hacks.html">
                        
                            <a href="/jekyll/2025-09-12-Binary_Search_Tricks_and_Hacks.html" onclick="pageScrollToTop(this)">
                                Algorithm | Binary Search Tricks and Hacks
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2024-10-17-KLEE_symbolic_execution.html">
                        
                            <a href="/jekyll/2024-10-17-KLEE_symbolic_execution.html" onclick="pageScrollToTop(this)">
                                Paper | KLEE: Introducing Symbolic Execution
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2024-07-28-parallel_and_distributed_systems_introduction.html">
                        
                            <a href="/jekyll/2024-07-28-parallel_and_distributed_systems_introduction.html" onclick="pageScrollToTop(this)">
                                PDS | Introduction of Parallel and Distributed Systems
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-06-21-competitive_paging_algorithm.html">
                        
                            <a href="/jekylls/2024-06-21-competitive_paging_algorithm.html" onclick="pageScrollToTop(this)">
                                Algorithm | Competitive Paging Algorithm
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-06-09-arch_user_repository.html">
                        
                            <a href="/jekylls/2024-06-09-arch_user_repository.html" onclick="pageScrollToTop(this)">
                                Note | Arch User Repository
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-04-09-hirschbergs_algorithm.html">
                        
                            <a href="/jekylls/2024-04-09-hirschbergs_algorithm.html" onclick="pageScrollToTop(this)">
                                Algorithm | Hirschberg&#39;s Algorithm
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-03-08-ANTLR_guide.html">
                        
                            <a href="/jekylls/2024-03-08-ANTLR_guide.html" onclick="pageScrollToTop(this)">
                                Compiler | ANTLR Guide
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-03-06-arch_linux_installation.html">
                        
                            <a href="/jekylls/2024-03-06-arch_linux_installation.html" onclick="pageScrollToTop(this)">
                                Note | Arch Linux Installation
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-03-01-maven_multi_module_project.html">
                        
                            <a href="/jekylls/2024-03-01-maven_multi_module_project.html" onclick="pageScrollToTop(this)">
                                Note | Apache Maven Multi-Module Project Guide
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2024-02-03-storage_and_file_system.html">
                        
                            <a href="/jekyll/2024-02-03-storage_and_file_system.html" onclick="pageScrollToTop(this)">
                                OS | Storage and File System
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-01-05-debian_btrfs.html">
                        
                            <a href="/jekylls/2024-01-05-debian_btrfs.html" onclick="pageScrollToTop(this)">
                                Note | Using btrfs on Debian
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2023-12-26-code_generation.html">
                        
                            <a href="/jekylls/2023-12-26-code_generation.html" onclick="pageScrollToTop(this)">
                                Compiler | Code Generation (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-12-23-virtual_memory.html">
                        
                            <a href="/jekyll/2023-12-23-virtual_memory.html" onclick="pageScrollToTop(this)">
                                OS | Virtual Memory
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-12-20-system_testing.html">
                        
                            <a href="/jekyll/2023-12-20-system_testing.html" onclick="pageScrollToTop(this)">
                                Testing | System Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-12-12-mutation_testing.html">
                        
                            <a href="/jekyll/2023-12-12-mutation_testing.html" onclick="pageScrollToTop(this)">
                                Testing | Mutation Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-12-10-main_memory.html">
                        
                            <a href="/jekyll/2023-12-10-main_memory.html" onclick="pageScrollToTop(this)">
                                OS | Main Memory
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-12-09-class_level_testing.html">
                        
                            <a href="/jekyll/2023-12-09-class_level_testing.html" onclick="pageScrollToTop(this)">
                                Testing | Class-Level Unit Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2023-11-29-semantic_analysis.html">
                        
                            <a href="/jekylls/2023-11-29-semantic_analysis.html" onclick="pageScrollToTop(this)">
                                Compiler | Semantic Analysis Notes
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-28-test_coverage_criteria.html">
                        
                            <a href="/jekyll/2023-11-28-test_coverage_criteria.html" onclick="pageScrollToTop(this)">
                                Note | Test Coverage Criteria
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-25-method_level_structural_unit_testing.html">
                        
                            <a href="/jekyll/2023-11-25-method_level_structural_unit_testing.html" onclick="pageScrollToTop(this)">
                                Testing | Method-Level Structural Unit Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-24-deadlock.html">
                        
                            <a href="/jekyll/2023-11-24-deadlock.html" onclick="pageScrollToTop(this)">
                                OS | Deadlock
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-23-based_on_clp_testcases.html">
                        
                            <a href="/jekyll/2023-11-23-based_on_clp_testcases.html" onclick="pageScrollToTop(this)">
                                Testing | Based on CLP Testcases
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-09-synchronization.html">
                        
                            <a href="/jekyll/2023-11-09-synchronization.html" onclick="pageScrollToTop(this)">
                                OS | Synchronization (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-28-method_level_function_unit_testing.html">
                        
                            <a href="/jekyll/2023-10-28-method_level_function_unit_testing.html" onclick="pageScrollToTop(this)">
                                Testing | Method-Level Functional Unit Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2023-10-26-syntax_analysis.html">
                        
                            <a href="/jekylls/2023-10-26-syntax_analysis.html" onclick="pageScrollToTop(this)">
                                Compiler | Syntax Analysis Notes
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter active" data-level="1.2" data-path="/jekyll/2023-10-19-cpu_scheduler.html">
                        
                            <a href="/jekyll/2023-10-19-cpu_scheduler.html" onclick="pageScrollToTop(this)">
                                OS | CPU Scheduler
                            </a>
                            
                                
                                    <ul><li><a href="#noun-concept-definition" onclick="mobilePageScrollToAnchor(this)" >Noun, Concept definition</a></li><li><a href="#scheduler-concepts" onclick="mobilePageScrollToAnchor(this)" >Scheduler Concepts</a></li><li><a href="#linux-scheduler" onclick="mobilePageScrollToAnchor(this)" >Linux Scheduler</a></li><li><a href="#o1--cfs-scheduler" onclick="mobilePageScrollToAnchor(this)" >O(1) &amp; CFS scheduler</a></li><li><a href="#scheduler-problem" onclick="mobilePageScrollToAnchor(this)" >Scheduler Problem</a></li></ul>

                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-18-process_thread.html">
                        
                            <a href="/jekyll/2023-10-18-process_thread.html" onclick="pageScrollToTop(this)">
                                OS | Process and Thread
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-17-container_of.html">
                        
                            <a href="/jekyll/2023-10-17-container_of.html" onclick="pageScrollToTop(this)">
                                Note | Linux Kernel Macro container_of &amp; offsetof
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-10-test_case_generation.html">
                        
                            <a href="/jekyll/2023-10-10-test_case_generation.html" onclick="pageScrollToTop(this)">
                                Testing | Test Case Generation
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-09-operating_system_structure.html">
                        
                            <a href="/jekyll/2023-10-09-operating_system_structure.html" onclick="pageScrollToTop(this)">
                                OS | Operating System Structure
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-23-software_testing_introduction.html">
                        
                            <a href="/jekyll/2023-09-23-software_testing_introduction.html" onclick="pageScrollToTop(this)">
                                Testing | Software Testing Introduction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2023-09-21-lexical_analysis.html">
                        
                            <a href="/jekylls/2023-09-21-lexical_analysis.html" onclick="pageScrollToTop(this)">
                                Compiler | Lexical Analysis Notes
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-20-compiler_introduction.html">
                        
                            <a href="/jekyll/2023-09-20-compiler_introduction.html" onclick="pageScrollToTop(this)">
                                Compiler | Compilers Introduction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-12-operating_system_introduction.html">
                        
                            <a href="/jekyll/2023-09-12-operating_system_introduction.html" onclick="pageScrollToTop(this)">
                                OS | Operating System Introduction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-07-test_case_generation_based_on_constraint_logic_graph.html">
                        
                            <a href="/jekyll/2023-09-07-test_case_generation_based_on_constraint_logic_graph.html" onclick="pageScrollToTop(this)">
                                Paper | Test Case Generation Based on Constraint Logic Graph
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-07-Introduction_OCL.html">
                        
                            <a href="/jekyll/2023-09-07-Introduction_OCL.html" onclick="pageScrollToTop(this)">
                                Note | Object Constraint Language Concepts (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-08-06-gdb_introduction.html">
                        
                            <a href="/jekyll/2023-08-06-gdb_introduction.html" onclick="pageScrollToTop(this)">
                                Note | GNU Debugger Quick Notes
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-08-05-linux_kernel_complie.html">
                        
                            <a href="/jekyll/2023-08-05-linux_kernel_complie.html" onclick="pageScrollToTop(this)">
                                OS | Linux Kernel Compilation
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-28-UML_structure_diagrams.html">
                        
                            <a href="/jekyll/2023-07-28-UML_structure_diagrams.html" onclick="pageScrollToTop(this)">
                                Note | UML Structure Diagrams Introduction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-28-UML_behavior_diagrams.html">
                        
                            <a href="/jekyll/2023-07-28-UML_behavior_diagrams.html" onclick="pageScrollToTop(this)">
                                Note | UML Behavior Diagrams Introduction (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-26-unified_modeling_language.html">
                        
                            <a href="/jekyll/2023-07-26-unified_modeling_language.html" onclick="pageScrollToTop(this)">
                                Note | Unified Modeling Language Concepts
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-22-property_based_testing_entropy_guided_backbox_REST_API-_fuzzer.html">
                        
                            <a href="/jekyll/2023-07-22-property_based_testing_entropy_guided_backbox_REST_API-_fuzzer.html" onclick="pageScrollToTop(this)">
                                Paper | BenFuzz: A Property Based Testing and Entropy Guided Blackbox REST API Fuzzer
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-19-MVVM_modeling_methodology_user_interface.html">
                        
                            <a href="/jekyll/2023-07-19-MVVM_modeling_methodology_user_interface.html" onclick="pageScrollToTop(this)">
                                Paper | A MVVM Modeling Methodology for Information Systems User Interface Design
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-18-software_arch_pattern.html">
                        
                            <a href="/jekyll/2023-07-18-software_arch_pattern.html" onclick="pageScrollToTop(this)">
                                Note | Architectural Patterns Compare MVP, MVC, MVVM
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-18-automated_gen_test_case_using_UML.html">
                        
                            <a href="/jekyll/2023-07-18-automated_gen_test_case_using_UML.html" onclick="pageScrollToTop(this)">
                                Paper | Automated-generating test case using UML statechart diagrams (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-06-23-Intergrated_environment_sdd.html">
                        
                            <a href="/jekyll/2023-06-23-Intergrated_environment_sdd.html" onclick="pageScrollToTop(this)">
                                Paper | An Integrated Environment for Specification Driven Development (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-05-28-characteristics_of_bdd.html">
                        
                            <a href="/jekyll/2023-05-28-characteristics_of_bdd.html" onclick="pageScrollToTop(this)">
                                Paper | A Study of the Characteristics of Behaviour Driven Development
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-05-20-analysis_mutation_testing.html">
                        
                            <a href="/jekyll/2023-05-20-analysis_mutation_testing.html" onclick="pageScrollToTop(this)">
                                Paper | An Analysis and Survey of the Development of Mutation Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-04-21-tdd_concepts.html">
                        
                            <a href="/jekyll/2023-04-21-tdd_concepts.html" onclick="pageScrollToTop(this)">
                                Paper | Test-driven development concepts, taxonomy, and future direction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-04-18-applying_isoiec25010.html">
                        
                            <a href="/jekyll/2023-04-18-applying_isoiec25010.html" onclick="pageScrollToTop(this)">
                                Paper | Applying the ISO/IEC 25010 Quality Models to Software Product
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-04-13-software_standard.html">
                        
                            <a href="/jekyll/2023-04-13-software_standard.html" onclick="pageScrollToTop(this)">
                                Note | Standard - ISO/IEC
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-02-04-algorithm_kmp.html">
                        
                            <a href="/jekyll/2023-02-04-algorithm_kmp.html" onclick="pageScrollToTop(this)">
                                Leetcode | Algorithm - KMP
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-01-12-gomoku_ai.html">
                        
                            <a href="/jekyll/2023-01-12-gomoku_ai.html" onclick="pageScrollToTop(this)">
                                Note | Gomoku AI - Game Tree
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-24-git_commit.html">
                        
                            <a href="/jekyll/2022-11-24-git_commit.html" onclick="pageScrollToTop(this)">
                                Note | Commit Message Format
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-08-ai_csp.html">
                        
                            <a href="/jekyll/2022-11-08-ai_csp.html" onclick="pageScrollToTop(this)">
                                Note | Constraint Satisfaction Problem
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-07-network_urat.html">
                        
                            <a href="/jekyll/2022-11-07-network_urat.html" onclick="pageScrollToTop(this)">
                                Note | Basic UART Concept
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-05-docker_jekyll.html">
                        
                            <a href="/jekyll/2022-11-05-docker_jekyll.html" onclick="pageScrollToTop(this)">
                                Note | Docker Build Github Pages
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/1970-01-01-virtual_machine_tool.html">
                        
                            <a href="/jekyll/1970-01-01-virtual_machine_tool.html" onclick="pageScrollToTop(this)">
                                Tool | Virtual Machine
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/1970-01-01-linux_config.html">
                        
                            <a href="/jekyll/1970-01-01-linux_config.html" onclick="pageScrollToTop(this)">
                                Tool | Linux Config
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/1970-01-01-leetcode_guide.html">
                        
                            <a href="/jekyll/1970-01-01-leetcode_guide.html" onclick="pageScrollToTop(this)">
                                Leetcode | Master Guide
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/1970-01-01-editor_envirmnment.html">
                        
                            <a href="/jekyll/1970-01-01-editor_envirmnment.html" onclick="pageScrollToTop(this)">
                                Tool | Edirot Guide
                            </a>
                            
                                
                            
                        </li>
                    

                    
                        <li class="divider"></li>
                    
                
            
        </ul>
    </nav>
</div>
<div class="book-body">
                <div class="book-header" role="navigation">
                    <!-- Title -->
                    <h1>
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        
                            <a href="." >OS | CPU Scheduler</a>
                        
                    </h1>
                </div>

                <div class="body-inner"><div class="page-wrapper" tabindex="-1" role="main">
    

    <div class="page-inner">
        <div class="normal">
            
            
            <section class="normal">October 19, 2023 </section>
            
        </div>
        <div id="book-search-results">
            <div class="search-noresults">
                <section class="normal markdown-section">
                    
                        <h1 id="/jekyll/cpu_scheduler">OS | CPU Scheduler</h1>
                    

                    <blockquote class="block-tip">
  <p>Operating System: Design and Implementation course notes from CCU, lecturer Shiwu-Lo.</p>
</blockquote>

<p>æ¬ç« ç¯æä¸»è¦ä»ç´¹ Linux Schedulerï¼Linux Scheduler ç¾å¨ççç®æ¨æ¯: å¦ä½å¾ãå¥½è®çºæ´å¥½ã</p>

<ul>
  <li>Noun, Concept definition</li>
  <li>2.4 Scheduler</li>
  <li>2.6 O(1) Scheduler</li>
  <li>2.6 - 5.3 Complete fair scheduler(CFS)</li>
</ul>

<blockquote>
  <p>Linux Kernel 2.4 æ¯ä¸åéå¸¸é·å£½ççæ¬ï¼æçºäºå¤§ç´ 10 å¹´å·¦å³ï¼ä½å³ä¾¿éæ¨£ä¸åééº¼é·å£½ãç©©å®ç Schedulerï¼
Linux Kernel è¨­è¨èä»ç¶å¨èæ®å¦ä½è®å¥¹è®å¾æ´å¥½ã</p>
</blockquote>

<h3 id="noun-concept-definition">Noun, Concept definition</h3>

<p><a href="./2023-10-19-cpu_scheduler.html#41-task">4.1 Task</a><br />
<a href="./2023-10-19-cpu_scheduler.html#42-scheduler-types">4.2 Scheduler Types</a><br />
<a href="./2023-10-19-cpu_scheduler.html#43-cooperative-multitasking---novell-netware">4.3 Cooperative multitasking - Novell-Netware</a><br />
<a href="./2023-10-19-cpu_scheduler.html#44-preemptable-os">4.4 Preemptable OS</a><br />
<a href="./2023-10-19-cpu_scheduler.html#45-scheduler--context-switch">4.5 Scheduler &amp; Context switch</a><br />
<a href="./2023-10-19-cpu_scheduler.html#46-scheduling-criteria">4.6 Scheduling Criteria</a></p>

<h5 id="41-task">4.1 Task</h5>

<ul>
  <li>å¨ Linux ä¸­ï¼Process å Thread é½æ¯ Task</li>
  <li>Process ä¹éä¸æå±ç¨ä»»ä½è³æºï¼<strong>å°¤å¶æ¯ Memory</strong></li>
  <li>Thread åæ¯å¹¾ä¹å±ç¨ææè³æºï¼<strong>å°¤å¶æ¯ Memory</strong></li>
  <li>Task ççå½é±æä¸­åçºå©ç¨®ææ³
    <ul>
      <li>Using CPU</li>
      <li>Waitingï¼ä¾å¦: Waiting mutex, I/O â¦</li>
    </ul>
  </li>
  <li>Task å¨ä½¿ç¨ CPU æåçº: å·è¡æ¼ User mode/Kernel mode</li>
</ul>

<blockquote class="block-tip">
  <p>å¨ Linux Task å¯ä»¥å·è¡å¨ User/Kernel modeï¼æ¹è®æ¨¡å¼ç¨±ä½ Mode changeï¼è Kernel Thread å°æåªæ Kernel mode ç Taskï¼ä¾å¦: Device Driver</p>
</blockquote>

<p><strong>Task &amp; Scheduling</strong></p>

<p>ä»¥ä¸æ¯ä¸å Task ççå½é±æï¼éè£¡å¾ Scheduler è§åº¦ä¾ççè©±ä¸»è¦å½±é¿çæ¯å©åé¨å:</p>
<ul>
  <li>Waining(semaphore): æéº¼å¨ Waiting æï¼è® Task çä½¿ç¨çæå¤§å</li>
  <li>OS å¯ä»¥åæå©å¤§é¡:
    <ul>
      <li><strong><a href="https://en.wikipedia.org/wiki/Cooperative_multitasking">Cooperative multitasking</a></strong>(Non-preemptive, ååéä½å¼å¤å·¥)</li>
      <li><strong><a href="https://en.wikipedia.org/wiki/Preemption_%28computing%29">Preemptable OS</a></strong>(Preemptive, æ¶å å¼å¤ä»»åèç)</li>
    </ul>
  </li>
</ul>

<p><img src="/image/2023/10-19-cpu_scheduler/1.png" alt="" height="100%" width="100%" /></p>

<h5 id="42-scheduler-types">4.2 Scheduler Types</h5>

<p><img src="/image/2023/10-19-cpu_scheduler/2.png" alt="" height="100%" width="100%" /></p>

<ul>
  <li><strong>Non-preemptive OS</strong>(â³): å°±æ¯æåªæ Task èªå·±æ¾æ£ CPU ä½¿ç¨æ¬ï¼ææäº¤åº CPU ä½¿ç¨æ¬
    <ol>
      <li>Task å·è¡çµæï¼éæ¨£ç¶ç¶å°±äº¤åº CPU ä½¿ç¨æ¬</li>
      <li>Task ç¼åº Blocking I/O request å çºè¦ç­å¾ I/O å®æï¼å æ­¤ä¹æäº¤åº CPU ä½¿ç¨æ¬
        <ul>
          <li>ç¶ç¶ä¹æ Async I/Oï¼Vectored I/O ç­æ¹æ³ï¼éè£¡åä¸è¨è«</li>
        </ul>
      </li>
    </ol>
  </li>
  <li><strong>Preemptive OS</strong>(ââ³):
    <ol>
      <li>æ¯å Task ææä¸å Time slice å·è¡ï¼ä¾å¦: 1/1000 Secï¼å·è¡çµæå°±è¦ååæ</li>
      <li>å¾ Wating ç­å¾å®ç¢ I/O å¾ï¼è¿å Runtable æè¦ä¸è¦é¦¬ä¸ååè©² Task</li>
      <li>æ°ç Task ä¹å¯ä»¥çµ¦äºé«åªåæ¬ï¼è®ä»é¦¬ä¸å·è¡
        <ul>
          <li>Preemptive OS ååçº:</li>
        </ul>
        <ul>
          <li><strong>Preemptable Kernel</strong>, <strong>Non-preemptable Kernel</strong></li>
        </ul>
      </li>
    </ol>
  </li>
</ul>

<h5 id="43-cooperative-multitasking---novell-netware">4.3 Cooperative multitasking - Novell-Netware</h5>

<p><a href="https://en.wikipedia.org/wiki/NetWare">Netware</a>:</p>
<ul>
  <li>Netware ææçç¨å¼é½å¨ ring 0 å·è¡ï¼ä½æ¯éæ¨£å°±è¦ç¢ºä¿ææçç¨å¼é½æ¯ç± Novell ä¾æ§å¶ï¼
éæ¨£æè½ç¢ºä¿ææçç¨å¼é½æ¯å¯ä¿¡ä»»çï¼æ²ææ¡æç¨å¼</li>
  <li>ä½æ¯ç¶ CPU æè½è®å¼·ä¹å¾ï¼éæ¨£çè¨­è¨å°±ä¸å¤ªå¥½ï¼å çºææçç¨å¼é½è¦ç± Novell ä¾æä¾ï¼éä¸å¤ªå¯è½ï¼å æ­¤æå¾ç± Windows NT ååº</li>
</ul>

<h5 id="44-preemptable-os">4.4 Preemptable OS</h5>

<p><strong>Preemptive OS:</strong></p>
<ul>
  <li>å¦æä¸å Task å·è¡éä¹ï¼OS æä¸»åå° CPU æ§å¶æ¬äº¤çµ¦ä¸ä¸å Task</li>
  <li>å¦æè¦è¨­è¨ Preemptive OS å¿é è¦æ Hardware supportï¼ä¾å¦: Timer, Interrupt
    <ul>
      <li>Timer: ç¨ä¾è¨ç® Task å·è¡çæé</li>
      <li>Interrupt: ä½¿ OS è½ç²å¾ CPU æ§å¶æ¬</li>
    </ul>
  </li>
  <li>ææçæ¬ç Linux é½æ¯ Preemptive OS</li>
</ul>

<p><strong>Preemptive Kernel</strong></p>

<ul>
  <li>Non-preemptive Kernel(throughput):
    <ul>
      <li>å¨ 2.6 Kernel ä¹åï¼Linux æ¯ Non-preemptable Kernel</li>
      <li>ç¶ Task å·è¡å¨ Kernel mode æï¼å¶åªåæ¬ç¡éå¤§
        <ul>
          <li>Context switch åªæç¼çå¨ Task ç± Kernel mode åæå° User mode æ</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Preemptive Kernel(latency):
    <ul>
      <li>å¨ 2.6 Kernel ä¹å¾ï¼Linux å¯ä»¥è¨­å®çº Preemptable Kernel</li>
      <li>ç¶ Task å·è¡å¨ Kernel mode æå¦ææ²æä»»ä½ç Lock å°±å¯è½ç¼ç Context switch</li>
    </ul>
  </li>
</ul>

<p><img src="/image/2023/10-19-cpu_scheduler/3.png" alt="" height="100%" width="100%" /></p>

<p><img src="/image/2023/10-19-cpu_scheduler/4.png" alt="" height="100%" width="100%" /></p>

<blockquote class="block-tip">
  <p>æ³¨æå¦æå¨ Kernel ä¸­ç¼ç Interruptï¼ä¸æ¬¡ Task A å·è¡ææç´æ¥å¾ Kernel mode ä¸­ç¹¼çºå·è¡ï¼
å æ­¤å¨ 2.6 Kernel å¾ç·¨è­¯æå¯ä»¥é¸æ Kernel æ³¨é throughput éæ¯ latencyï¼</p>
</blockquote>

<p><strong>Form Non-preemprive kernel to Preemprive kernel</strong></p>

<ul>
  <li>å¨ Non-Preemprive kernel ä¸­ï¼ææé²å¥ Kernel ç Task å¯ä»¥åè¨­èªå·±ä¸æè¢« Preemptï¼å æ­¤å­åå¾å¤å±ç¨è³æï¼ä¸éè¦ä½¿ç¨ Lock</li>
  <li>å¨ Preemprive kernel ä¸­ï¼ç¨å¼è¨­è¨å¸«éè¦ä»ç´°æèãæ¹å¯«ç¨å¼ç¢¼ï¼ææå­åå°å±ç¨è³æçç¨å¼ç¢¼é½éè¦ä½¿ç¨ Lock-UnLock ä¾ä¿è­·
    <ul>
      <li>éæ¯ä¸ä»¶éå¸¸èè²»äººåçå·¥ä½</li>
    </ul>
  </li>
</ul>

<h5 id="45-scheduler--context-switch">4.5 Scheduler &amp; Context switch</h5>

<ul>
  <li><strong>Scheduler</strong> æ±ºå®æ¥ä¸ä¾è¦å·è¡åªä¸å Task
    <ul>
      <li>ä½¿ç¨ C language æ°å¯«</li>
    </ul>
  </li>
  <li><strong>Context switch</strong>
    <ul>
      <li>è² è²¬å¾ä¸å Task åæå°å¦ä¸å Task</li>
      <li>ä¸»è¦åæçæ¯æ®é Register</li>
      <li>å¦æ Task ä½¿ç¨å°ä¸äºç¹å¥ç Registerï¼ä¾å¦: æµ®é»æ¸éç®å¨(Floating Point Unit, FPU)ï¼åéè¦é¡å¤èç(Lazy)
        <ul>
          <li>Lazy: åªææ°ç Task éè¦ä½¿ç¨å° FPU æï¼ææåæ FPU ç¸éç Register</li>
        </ul>
      </li>
      <li>Context switch é±å«çåæ
        <ul>
          <li>ä¾ç§éæ±åæ Page Table(TLB)</li>
          <li>åæ Cache çå§å®¹</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="46-scheduling-criteria">4.6 Scheduling Criteria</h5>

<p>éè£¡ä»ç´¹å¦ä½åæä¸å Scheduler çå¥½å£</p>

<ul>
  <li><strong>CPU Utilization</strong>(ä½¿ç¨ç): CPU ç¶­æå¨é«ä½¿ç¨çï¼Task ä¹éäºç¸æç­å¾çéä¿ï¼è¦å¦ä½ Schedule?</li>
  <li><strong>Throughput</strong>(ååé): å¨å®ä½æéå§ï¼CPU å¯ä»¥å·è¡å¤å° Task
    <ul>
      <li>ä¾å¦: è® I/O Task åªåå·è¡</li>
    </ul>
  </li>
  <li><strong>Turnaround time</strong>(å¾è¿æé): Task å¾éå§å°çµæçæéï¼è Scheduler åç¨å¼æ¬èº«çå·è¡ç¨åº¦ç¸é</li>
  <li><strong>Waiting time</strong>(ç­å¾æé): Task å¨ Ready Queue ä¸­ç­å¾çæéï¼éå¸¸é«åªåæ¬ç Task æç­å¾è¼ç­çæé
    <ul>
      <li>åªè¦ä¸å Task è½å·è¡ï¼ä½ OS ä½¿å¶ç­å¾å°±è¦ç®å¥ Waiting time</li>
    </ul>
  </li>
  <li><strong>Response time</strong>(åææé): Task å¾ç¼åº Request å°ç¬¬ä¸æ¬¡åæçæé
    <ul>
      <li>ä¾å¦: ç¨å¼éè¦è¼¸åºåæå°è¢å¹ï¼å¥½ç Scheduler å¯ä»¥è® Progress bar éå¸¸å³æçåæ</li>
    </ul>
  </li>
</ul>

<p><strong>CPU Utilization</strong></p>

<p>å¯¦éç CPU ä½¿ç¨çæåå° Task çé«ä½åªåæ¬å½±é¿ï¼å æ­¤ CPU ä½¿ç¨çææå©ç¨®ææ³:</p>

<p><img src="/image/2023/10-19-cpu_scheduler/5.png" alt="" height="100%" width="100%" /></p>

<p><img src="/image/2023/10-19-cpu_scheduler/6.png" alt="" height="100%" width="100%" /></p>

<blockquote>
  <p>å¯ä»¥ééè»é«çæ¹å¼å° Lock-Unlock åæä½³åï¼ä¾å¦: Intel vtune, kernelshark ä¹é¡çè¦è¦ºåå·¥å·</p>
</blockquote>

<p><strong>Response time</strong></p>

<p>åå¦ç³»çµ±ä¸­æ 10 å Taskï¼é 10 å Task é£æ¥å° 10 å Userï¼å¦æè¦è®å·è¡æè¦ºæµæ¢çè©±ï¼æä»¥ä¸åæ³:</p>

<ol>
  <li>å®åäºå:
    <ul>
      <li>åå¦ Task æ¯æ­æ¾å½±çï¼é£å°±å®æé©ç¶ç Bufferï¼è§£ç¢¼å¾çå½±çæ¾å¥ Buffer ä¾ User task æ¿å</li>
      <li>åªè¦ Buffer å¤ å¤§ï¼å³ä½¿æ¯ 10 ç§æè¼ªå°ä¸æ¬¡å·è¡ï¼ä½¿ç¨èä¹ä¸æè¦ºå¾ Lag</li>
    </ul>
  </li>
  <li>éåäºå:
    <ul>
      <li>åå¦ Task æ¯èªé³éè©±ï¼å¿é å¨ 150ms ä¸­è¼ªå°å·è¡ä¸æ¬¡ï¼å¦åæè¦ºå¾éè©±åè³ªä¸å¥½</li>
      <li>é£æ¯å Task ä¸åååªè½å·è¡ 15ms</li>
    </ul>
  </li>
</ol>

<hr />

<h3 id="scheduler-concepts">Scheduler Concepts</h3>

<h5 id="47-simple-scheduler">4.7 Simple Scheduler</h5>

<ul>
  <li><strong>FCFS(Fisrt Come First Serve)</strong>
    <ul>
      <li>ä¾ç§ Task çæµéé åºï¼ä¾ç§é åºå·è¡</li>
    </ul>
  </li>
  <li><strong>SJF(Shortest Job First)</strong>
    <ul>
      <li>ä¾ç§ Task çå·è¡æéï¼å·è¡æéç­ç Task åªåå·è¡</li>
    </ul>
  </li>
  <li><strong>RR(Round Robin)</strong>
    <ul>
      <li>å¨ä¸ç¾¤ Task ä¸­è¼ªæµå·è¡ï¼æ¯ä¸å Task æå¤å·è¡ X å Time slice</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>å¨ Linux ä¸­å¯ä»¥çå°ä¸é¢ä¸ç¨®æ¹æ³çå½±å­</p>
</blockquote>

<p><strong>FCFS</strong></p>

<p><img src="/image/2023/10-19-cpu_scheduler/7.png" alt="" height="100%" width="100%" /></p>

<ul>
  <li>Wating time: P1 = 0, P2 = 100, P3 = 150</li>
  <li>Average waiting time: (0 + 100 + 150) / 3 = 83.3</li>
  <li>å¦æåæµéç Task å·è¡æéå¾é·ï¼Average waiting time å°±æè®å¾æ¯è¼é·</li>
</ul>

<p><strong>SJF</strong></p>

<p><img src="/image/2023/10-19-cpu_scheduler/8.png" alt="" height="100%" width="100%" /></p>

<ul>
  <li>å¨ P1 å·è¡ä¸­ï¼P2ãP3 æµéï¼æ¾å¥ Ready Queueï¼ç¶å¾ä¾ç§å·è¡æéæåº</li>
  <li>Wating time: P1 = 0, P2 = 110, P3 = 100</li>
  <li>Average waiting time: (0 + 110 + 100) / 3 = 70</li>
</ul>

<p><strong>Preemptive SJF</strong></p>

<p><img src="/image/2023/10-19-cpu_scheduler/9.png" alt="" height="100%" width="100%" /></p>

<ul>
  <li>åªè¦æå·¥ä½é²å¥ Ready Queueï¼ææå·¥ä½çµæå°±è¦æ±ºå®å·è¡ç Task</li>
  <li>Wating time: P1 = 60, P2 = 10, P3 = 0</li>
  <li>Average waiting time: (60 + 10 + 0) / 3 = 23.3</li>
</ul>

<blockquote>
  <p>ç´è§ä¸æè¦ºå¾ Preemptive SJF æ¯æ¯è¼å¥½çæ¼ç®æ³ï¼ä½æ³¨æ Preemptive SJF æ Context switch overhead</p>
</blockquote>

<ul>
  <li>å¦æåªæ¯å¯« SJF éå¸¸æ Non-preemptive SJF</li>
  <li>Preemptive SJF åç¨±ä½ SRTF(Shortest Remaining Time First)</li>
  <li>å¨ Average waiting time æ¹é¢ï¼SJF &amp; SRTF åå¥æ¯ Preemptable scheduling &amp; Non-preemptable scheduling çæä½³æ¼ç®æ³</li>
</ul>

<p><strong>Estimate Execution Time</strong></p>

<p>åé¢æå°ç Scheduler é½æ¯åè¨­ Task çå·è¡æéæ¯å·²ç¥çï¼ä½å¯¦éä¸ Task çå·è¡æéæ¯ä¸ç¥éçï¼å æ­¤éè¦ä¼°è¨ Task çå·è¡æé</p>

<ul>
  <li>ä¸å Task ççå½é±æåçºå©ç¨®ææ³
    <ul>
      <li>Using CPU, Waiting</li>
    </ul>
  </li>
  <li>ä¾ç§ Task ä»¥åä½¿ç¨ CPU ä½¿ç¨æéçå¤å¯¡ï¼ä¾é æ¸¬éæ¬¡ä½¿ç¨ CPU æéçå¤å¯¡ï¼ä¾å¦ä»¥ä¸å¬å¼
    <ul>
      <li>t<sub>n</sub>: ä¸ä¸æ¬¡ç CPU time</li>
      <li>ð<sub>x</sub>: é æ¸¬çç¬¬ x æ¬¡ç CPU time</li>
      <li>Linux Kernel 2.4 ä½¿ç¨ä»¥ä¸çæ¹æ³ï¼ä¸¦ä¸ ð¼ å 1/2 å çºå¯ä»¥é¿åæµ®é»æ¸éç®
        <ul>
          <li>t<sub>n+1</sub> = ð¼ * t<sub>n</sub> + (1 - ð¼) * ð<sub>n</sub></li>
          <li>ð¼ æ¯ä¸åæ¬éå å­çæ¼ 0 ~ 1 ä¹é
            <ul>
              <li>è¶é è¿ 1ï¼è¡¨ç¤ºè¶éè¦éå»ç CPU time</li>
              <li>è¶é è¿ 0ï¼è¡¨ç¤ºè¶éè¦é æ¸¬ç CPU time</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><strong>Round Robin</strong></p>

<p>å¦æä½¿ç¨ RR é£éº¼ Time slice è¦è¨­å®çºå¤å°?</p>
<ul>
  <li>å¤ªé·: æè® Task ç­å¾çæéè®é·</li>
  <li>å¤ªç­: æè® Context switch overhead è®å¤§</li>
  <li>éå¸¸ Time slice æè¨­å®çºä¸å Task å¯ä»¥å¨ Time slice å§å·è¡å®ç¢ï¼è®æ Waiting çæ
    <ul>
      <li>ä¹å°±æ¯å¨ Time slice ä¸­æåæ I/O request ç¼åºå»</li>
    </ul>
  </li>
</ul>

<blockquote class="block-warning">
  <p>ç®å Linux çè¨­å®çºä½¿ç¨èéè¦å¤å°ç Time sliceï¼å¯ä»¥åæçèª¿æ´ Time slice çå¤§å°</p>
</blockquote>

<h3 id="linux-scheduler">Linux Scheduler</h3>

<p><a href="./2023-10-19-cpu_scheduler.html#48-linux-24-scheduler">4.8 Linux 2.4 Scheduler</a><br />
<a href="./2023-10-19-cpu_scheduler.html#49-linux-26-scheduler">4.9 Linux 2.6 Scheduler</a></p>

<ul>
  <li>Linux å±æ 140 ååªåæ¬ç­ç´
    <ul>
      <li>0 ~ 99: Real-time priority
        <ul>
          <li>éå¸¸æ¯ä¸äºéè¦ Real-time ç Taskï¼ä¾å¦: å½±çæ­æ¾ï¼è²é³æ­æ¾</li>
        </ul>
      </li>
      <li>100 ~ 139: Normal priority
        <ul>
          <li>å°ä½¿ç¨èèè¨æ¯ -20 ~ +19ï¼é è¨­å¼çº 0ï¼ç¨±ä½ Nice value</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Nice value æ¯ç± User æå®ï¼Linux ç¶ä½åèç¨ä»¥è¨ç® Dynamic priorityï¼Dynamic priority æå ä»¥ä¸å ç´ å½±é¿:
    <ul>
      <li>è©² Task æ¯ I/O bound éæ¯ CPU bound</li>
      <li>èæ® Core çç¹æ§</li>
      <li>èæ® Multi-thread çç¹æ§</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>ä½¿ç¨èå¨åå Task æå¯ä»¥æå® Nice valueï¼æå¨ Task å·è¡æä½¿ç¨ renice æä»¤ä¾èª¿æ´ Nice value</p>
</blockquote>

<h5 id="48-linux-24-scheduler">4.8 Linux 2.4 Scheduler</h5>

<ol>
  <li>å¨ 2.4 Scheduler ä¸­å¦ä½å° I/O é²è¡åªå</li>
  <li>æèå¨ 2.4 å¨ Multi-processor çç°å¢ä¸æ¬ ç¼ºä»éº¼?</li>
</ol>

<ul>
  <li>Non-preemptible kernel
    <ul>
      <li>Set p-&gt;need_resched if schedule() should be invoked at the ânext opportunityâ(kernel -&gt; user mode).</li>
      <li>æä»¥ä¸åæ­£å¨ Kernel ä¸­éè¡ç Task è¦é²è¡ Context switch æå°±æå° need_resched è¨­çº 1</li>
    </ul>
  </li>
  <li>Round-Robin
    <ul>
      <li>task_struct-&gt;counter: number of clock ticks left to run in this scheduling slice, decremented by a timer.</li>
      <li>éæ¯ä¸å Task å·è¡ç counterï¼æ¯å time tick å°± -1ï¼ç¨å®äºå°±ä¸è½å¨éåååå§ä½¿ç¨ CPU</li>
    </ul>
  </li>
</ul>

<p><strong>2.4 Scheduler - SMP:</strong></p>

<p>ç¶æ CPU é²å¥ Idle æï¼2.4 Scheduler æå¾ Ready Queue ä¸­ Search &amp; Estimateï¼æ¾åºæä½³ç Task ä¾å·è¡</p>
<ul>
  <li>Search: æä¾ç§éå Task å°éå CPU æå¤é©å</li>
</ul>

<div style="display: flex; justify-content: center;">
    <img src="/image/2023/10-19-cpu_scheduler/10.png" width="50%" height="50%" />
    <img src="/image/2023/10-19-cpu_scheduler/11.png" width="50%" height="50%" />
</div>

<p><strong>2.4 Scheduler - Run-Queue:</strong></p>

<p>å¨ 2.4 ä¸­ææäººé½æ¯ä½¿ç¨åä¸å Run-Queue:</p>
<ol>
  <li>Use spin_lock_irq() to lock ârunqueue_lockâ
    <ul>
      <li>å çº 2.4 Scheduler åæä¸å Run-Queueï¼è¦å¨éç®æ Lock ç¶å¾éç®å® Unlockï¼èªç¶æé ææè½ç¶é ¸</li>
    </ul>
  </li>
  <li>Check if a task is ârunnableâ
    <ul>
      <li>in TASK_RUNNING state</li>
      <li>in TASK_INTERRUPTIBLE state and a signal is pending</li>
    </ul>
  </li>
  <li>Examine the âgoodnessâ of each process
    <ul>
      <li>æª¢æ¥ææ Task ç Goodnessï¼ä¸¦ä¸é¸åºæå¥½ç Task</li>
    </ul>
  </li>
  <li>Context switch</li>
</ol>

<p><strong>2.4 Scheduler - Goodness:</strong></p>

<ul>
  <li>âgoodnessâ: identifying the best candidate among all processes in the runqueue list.</li>
  <li>âgoodnessâ = 0: the entity has exhausted its quantum.</li>
  <li>0 &lt; âgoodnessâ &lt; 1000: the entity is a conventional process/thread that has not exhausted its quantum; a higher value denotes a higher level of goodness.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if (p-&gt;mm == prev-&gt;mm)
return p-&gt;counter + p-&gt;priority + 1;
else
return p-&gt;counter + p-&gt;priority;
</code></pre></div></div>

<p>A small bonus is given to the task p if it shares the address space with the previous task.</p>

<p>Examine the processor field of the processes and gives a consistent bonus (that is PROC_CHANGE_PENALTY, usually 15) 
to the process that was last executed on the âthis_cpuâ CPU.</p>

<p>ä¾å¦: ä¸å Multi-thread ç¨å¼ç Taskï¼å¦ææä¸å Thread å·è¡å¨ä¸å CPU ä¸ï¼é£éº¼å¶ä»ç Thread å°±ææä¸åå åï¼è®ä»åå¯ä»¥å¨åä¸å CPU ä¸å·è¡ã
åæ¨£çå¦æä¸å Process æå¾æ¯å¨é this_cpu ä¸éè¡ï¼é£éº¼ä»å¨éé¡ CPU ä¸è¨ç®åæ¸æä¹ææçåµå åã</p>

<blockquote class="block-danger">
  <p>2.4 Scheduler çåé¡æ¯ Scheduler è¦å°ææç Task è¨ç® goodnessï¼æ¯æ¬¡é½è¦éç®ãä½å¶å¯¦å¤§å¤æ¸æéæ¯æ¬¡è¨ç®åºç goodness é½æ¯å·®ä¸å¤çï¼
ççæéè¦æ¯æ¬¡é½éç®å?</p>
</blockquote>

<p><strong>Linux 2.4 Scheduler - Improve I/O performance</strong></p>

<p>Defintion:</p>
<ul>
  <li>I/O-bound processes: spends much of its time submitting and waiting on I/O requests</li>
  <li>Processor-bound processes: spend much of their time executing code</li>
</ul>

<p>Linux å¾åæ¼æ¯æ´ I/O-bound processesï¼éæ¨£ææä¾å¥½ç Process response timeï¼ä½æ¯æéº¼å° Process é²è¡åé¡?</p>

<ul>
  <li>å° <strong>Run time</strong> åçºç¡æ¸å <strong>epoch</strong></li>
  <li>ç¶æ²æ task å¯ä»¥å·è¡æå°±æå°ä¸ä¸å epoch
    <ul>
      <li>æ­¤æå¯è½æäº task ç <strong>time slice</strong> éæ²ç¨å®ï¼ä½éäº task æ­£å¨ waiting</li>
      <li>2.4 Scheduler åè¨­ææç waiting å°±æ¯å¨ <strong>waiting I/O</strong></li>
    </ul>
  </li>
  <li>é²å¥ä¸ä¸å epoch çæåï¼è£åææ task ç time slice
    <ul>
      <li>å¦ææ¯ I/O-bound taskï¼å çºå¨ä¸ä¸å epoch å¨ waiting I/Oï¼éæä¸äº time slice æ²ç¨å®ï¼
å æ­¤è£åå¾éäº task ææè¼å¤ç time slice</li>
    </ul>
  </li>
  <li>å¨ Linux 2.4 ä¸­ï¼time slice å°±æ¯ dynamic priority
    <ul>
      <li>å æ­¤ I/O-bound task ææè¼é«ç dynamic priority</li>
    </ul>
  </li>
</ul>

<p><img src="/image/2023/10-19-cpu_scheduler/9.png" alt="" height="100%" width="100%" /></p>

<p>å¾ä¸é¢çåä¾ç:</p>
<ul>
  <li>Epoch1: CPU bound é½å·²ç¶ç¨å® time sliceï¼æ­¤æå©ä¸ I/O bound sliceï¼å¿é é²å¥ä¸ä¸å epoch å¦åæé²å¥ idle</li>
  <li>Epoch2: ä½¿ç¨ timeSlice<sub>new</sub> = timeSlice<sub>old</sub> / 2 + baseTimeSlicep[nice] çå¬å¼ä¾è£å time slice</li>
  <li>ä¾ç§éæ¨£çéç® Epoch2 ç I/O bound task ä¸å®ææ¯ CPU bound ææ´é«ç Priority</li>
</ul>

<blockquote>
  <p>æ³¨æ Kernel ä¸­ä¸æä½¿ç¨ FPUï¼å æ­¤ä¸ææ float point</p>
</blockquote>

<p><strong>Cauclate time Slice</strong></p>

<p>timeSlice<sub>new</sub> = timeSlice<sub>old</sub> / 2 + baseTimeSlicep[nice]</p>

<p>çºä»éº¼è¦é¤ä»¥ 2ï¼åå¦æä¸åæ¡æçç¨å¼å¦ä¸:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">65535</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ¯æ¬¡æ¿å° CPU time å°±å» sleepï¼å æ­¤å¨ sleep ä¸­æè¢«è¦çºä¸å I/O bound taskï¼å æ­¤æ¿å°å¾é«ç time sliceï¼
éæ¨£éä¾æå°±æ¯ä¸å CPU bound task åæä¹æå¾é«ç time sliceï¼å¯ä»¥æ¶ä½ CPU é æå¶ä»ç I/O bound task ä¹ç¡æ³ç²å CPU timeã</p>

<p><strong>Main disadvantages of 2.4 Scheduler</strong></p>

<ul>
  <li>è¨ç® goodness å¤ªèè²»æéï¼å°±ç®æå Task goodness ä¸ç´æ²è®ï¼æ¯æ¬¡éæ¯è¦éæ°è¨ç®</li>
  <li>ææ CPU å±ç¨åä¸å Run queueï¼éå Run queue æè®æç³»çµ±çæè½ç¶é ¸ï¼å çºæ¯æ¬¡é½è¦ Lock &amp; Unlock</li>
  <li>Wating ä¸ä¸å®æ¯ I/Oï¼ä¾å¦: sleep()
    <ul>
      <li>å¨ 2.4 Scheduler ä¸­åªéå° I/O åæé«åªåæ¬</li>
      <li>ä¾å¦ waiting child process ä¹æ¯ä¸ç¨® waitingï¼ä¹å¯ä»¥è¢«èæ®å¨å§</li>
    </ul>
  </li>
</ul>

<hr />

<h5 id="49-linux-26-scheduler">4.9 Linux 2.6 Scheduler</h5>

<ul>
  <li>O(1) Scheduler</li>
  <li>CFS(Complete Fair Scheduler)</li>
</ul>

<p><strong>2.6 Scheduler Architecture</strong></p>

<p>2.6 Scheduler é¦åå¨æ¶æ§çæ¹åå°±æ¯ä½¿æ¯ä¸é¡ CPU æèªå·±ç Run queue</p>
<ul>
  <li>å³ä½¿éæ¨£ CPU è¦å» Run queue æ¿è³ææä¹è¦å Lock &amp; Unlock</li>
  <li>å çºæ¯ Lock èªå·±ç Run queueï¼å æ­¤ Lock &amp; Unlock éå¸¸é½ææåï¼ä¸ææç«¶ç­çææ³ç¼ç</li>
</ul>

<p><img src="/image/2023/10-19-cpu_scheduler/13.png" alt="" height="100%" width="100%" /></p>

<p>ç¶èªå·±æèªå·±ç Run queue å¾è¦èæ®çå°±æ¯ Load balancing(è² è¼å¹³è¡¡)</p>
<ul>
  <li>ç³»çµ±å»æª¢æ¥ Run queue æ¯å¦ Loading ééï¼å¦ææ¯å°±æå° Task æ¬ç§»å°å¦ä¸å Run queue</li>
  <li>å æ­¤æéè¦ Lock &amp; Unlockï¼æ¯çºäºé¿å CPU å¨æ¬ç§» Task æåºç¾é¯èª¤
    <ul>
      <li>Put: ç¶ CPU è¦ºå¾èªå·±ç loading å¤ªéï¼å° task å¡çµ¦å¦ä¸é¡ CPU</li>
      <li>Pull: è¦ºå¾èªå·±ç loading å¤ªè¼ï¼å¾å¥ç CPU æ task éä¾</li>
    </ul>
  </li>
  <li>å¦ä½è©ä¼° Loading è¼é
    <ul>
      <li>æ¯è¼ç°¡å®çæ¹å¼ï¼æ¥çæ¯å CPU ç Task æ¸éè· runnable task æ¸é</li>
    </ul>
  </li>
</ul>

<p>æ¯ä¸é¡ CPU ä¸é½ææä¸å thread ä¾è§å¯æ¯å¦è¦å Load balancingï¼éå thread ç¨±ä½ Balance thread</p>

<blockquote class="block-warning">
  <p>ä½åå¦ A, B å©é¡ CPU åæè¦æ¬ç§» Task è¦çµ¦äºå°æ¹ï¼åæéå®å°æ¹ç Run queueï¼å°±æé æäºç¸ç­å¾ï¼é æ Deadlockï¼éé¨åå¾é¢æèªªæ</p>
</blockquote>

<p><strong>CPU Affinity</strong></p>

<ul>
  <li>ç±æ¼æ¯ä¸é¡ CPU é½æèªå·±ç Run queueï¼éå¸¸é¤é Loading unbalanceï¼å¦åä¸æå»è§¸ç¼ Task migration
    <ul>
      <li>å æ­¤ 2.6 Scheduler å¯ä»¥æ´ææçä½¿ç¨ Cache</li>
    </ul>
  </li>
</ul>

<p><strong>Fully Preemptible Kernel</strong></p>

<p>2.6 Kernel ä¹å¾ï¼Linux ä¸­æ¯ä¸å Task å·è¡æ¼ Kernel mode æææä¸åè®æ¸ <code class="language-plaintext highlighter-rouge">preempt_count</code>ï¼ç¨æ¼è¨éè©² Task æ¯å¦å¯ä»¥è¢« Preempt</p>
<ul>
  <li>æ¯ç¶ Lock ä¸å Resource æï¼<code class="language-plaintext highlighter-rouge">preempt_count++</code></li>
  <li>æ¯ç¶ Unlock ä¸å Resource æï¼<code class="language-plaintext highlighter-rouge">preempt_count--</code></li>
  <li>å¦æ <code class="language-plaintext highlighter-rouge">preempt_count == 0</code>ï¼Kernel å¯ä»¥å Context switch
    <ul>
      <li>Kernel è¦å Context switch éå¸¸æ¯å çº interruptï¼ä¾å¦: ä¸åé«åªåæ¬ç task æ­£å¨ç­éå interrupt</li>
      <li>æ¯æ¬¡ <code class="language-plaintext highlighter-rouge">preempt_count</code> å¾ 1 è®çº 0ï¼Kernel é½ææª¢æ¥ä¸ä¸æ¯å¦è¦ Context switch</li>
    </ul>
  </li>
  <li>å¦æ Kernel ç´æ¥å·è¡ schedule()ï¼ç¡è« <code class="language-plaintext highlighter-rouge">preempt_count</code> æ¯å¤å°ï¼é½æå Context switch</li>
</ul>

<blockquote>
  <p>schedule() æ¯å¨ Linux kernel ä¸­çéè¦å½æ¸ï¼æç´æ¥é²è¡ scheduler èª¿åº¦ï¼ä¸¦ä¸åæå°ä¸ä¸å Task å·è¡</p>
</blockquote>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="https://stackoverflow.com/questions/20679228/linux-kernel-schedule-function">Linux kernel: schedule() function</a></p>
</blockquote>

<hr />

<h3 id="o1--cfs-scheduler">O(1) &amp; CFS scheduler</h3>

<p><a href="./2023-10-19-cpu_scheduler.html#410-o1-scheduler">4.10 O(1) Scheduler</a><br />
<a href="./2023-10-19-cpu_scheduler.html#411-cfs-scheduler">4.11 CFS Scheduler</a></p>

<ul>
  <li>2.5 ~ 2.6.22: <strong>O(1) Scheduler</strong>
    <ul>
      <li>Time complexity: O(1)</li>
      <li>Using Run queue(an active Q and an expired Q) to realize the ready queue</li>
    </ul>
  </li>
  <li>2.6.23 ~ : <strong>CFS Scheduler</strong>
    <ul>
      <li>Time complexity: O(log N)</li>
      <li>the ready queue is implemented as a red-black tree</li>
    </ul>
  </li>
</ul>

<h5 id="410-o1-scheduler">4.10 O(1) Scheduler</h5>

<ul>
  <li>æ¯é¡ CPU æèªå·±ç Run queueï¼æ¯å Run queue ç±å©å Array çµæ
    <ul>
      <li>active array: time quantum éæ²ç¨å®ç task</li>
      <li>expired array: time quantum ç¨å®ç task</li>
    </ul>
  </li>
  <li>Time complexity: O(1)
    <ul>
      <li>è½å¨ O(1) çæéå§ access, search, insert, delete</li>
      <li>æ¯æ¬¡ç¨å® time quantum ç task è¢«ç§»å° expired array ä¸¦å¨<strong>æ­¤æè¨ç®ä¸ä¸ååç Dynamic priority</strong></li>
    </ul>
  </li>
  <li>é¸åºæé« Priority ç Taskï¼å°±ä½¿ç¨æ± min çæ¼ç®æ³</li>
</ul>

<blockquote class="block-warning">
  <p>å°ä¸å array æ± min çæ¼ç®æ³æä½³ time complexity çºä½¿ç¨ heap å»ºç«è³æçµæ§ï¼time complexity çº O(log N)ï¼
ä½æ¯å çº Linux çåªåæ¬åªæ 140 ç¨®ï¼å æ­¤å¯ä»¥ä½¿ç¨ä¸äºæ¹æ³ä¾åªåå° O(1)</p>
</blockquote>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">prio_array</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nr_active</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bitmap</span><span class="p">[</span><span class="n">BITMAP_SIZE</span><span class="p">];</span>  <span class="c1">// BITMAP_SIZE = 140</span>
    <span class="k">struct</span> <span class="n">list_head</span> <span class="n">queue</span><span class="p">[</span><span class="n">MAX_PRIO</span><span class="p">];</span>   <span class="c1">// MAX_PRIO = 140</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">prio_array</span> <span class="n">prio_array_t</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">runqueue</span> <span class="p">{</span>
    <span class="cm">/* ... */</span>
    <span class="k">struct</span> <span class="n">mm_struct</span> <span class="o">*</span><span class="n">prev_mm</span><span class="p">;</span>          <span class="c1">// prev task's mm_struct</span>
    <span class="n">prio_array_t</span> <span class="o">*</span><span class="n">active</span><span class="p">,</span> <span class="o">*</span><span class="n">expired</span><span class="p">;</span>
    <span class="n">prio_array_t</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="cm">/* ... */</span>
<span class="p">};</span>
</code></pre></div></div>

<ul>
  <li><strong>prio_array</strong>
    <ul>
      <li>nr_active: ç´é active array ä¸­æå¤å° task</li>
      <li>bitmap: ç¨ä¾å¿«éæ¥è©¢è³å°æä¸å task ç priority</li>
      <li>queue: ç¨ä¾å­æ¾ç¸å priority ç task</li>
    </ul>
  </li>
  <li><strong>runqueue</strong> ä¸­ç¶­è­·äºå©å prio_arrayï¼åå¥æ¯ active, expired
    <ul>
      <li>*prev_mm: å¦æ task æ¯åä¸åç¨å¼ç thread é£éº¼ mm_struct æåçä½ç½®ææ¯ä¸æ¨£ï¼éæ¨£å°±å¯ä»¥ä¸ç¨å Memory context switch</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="https://hackmd.io/@RinHizakura/S1opp7-mP">Linux æ ¸å¿è¨­è¨: O(1) Scheduler</a>, <a href="https://hackmd.io/@sysprog/linux-scheduler#%E7%AC%A6%E5%90%88-O1-%E6%93%8D%E4%BD%9C%E7%9A%84%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B">Linux æ ¸å¿è¨­è¨: ä¸åªæé¸ä»»åçæç¨å¨: O(1) Scheduler</a></p>
</blockquote>

<p><img src="/image/2023/10-19-cpu_scheduler/14.png" alt="" height="100%" width="100%" /></p>

<ul>
  <li>å¨éå©å Queue ä¸­æ¯å Task å¯ä»¥æ¿å°ç Time quantum å¤§ç´ç­æ¼ 1 / priority</li>
  <li>å¨ Linux ä¸­ Priority é«æå©åå¥½è:
    <ol>
      <li>æè¼é«ç Time quantum(Time slice)</li>
      <li>å¯ä»¥æ´å¿«çæ¶å° CPU</li>
    </ol>
  </li>
  <li>å¨ Active queue ä¸­è¼é«åªåæ¬ç task é¤éæ¾æ£ææ¯ time quantum ç¨å®ï¼å¦åå¾é¢ç task é½ä¸æå·è¡
    <ul>
      <li>å¨åä¸å priority ä¸­ï¼æä¾ç§ Round-Robin çæ¹å¼ä¾è¼ªæµå·è¡</li>
      <li>å¦æé²è¡ I/O bound ä¹å°±æ¯æ¾æ£ï¼é£éº¼å°±æè¢«ç§»å° expired queueï¼ä¸¦ä¸å¨æ­¤æè¨ç®ä¸ä¸ååç Dynamic priority</li>
      <li>å¦ææ¯ I/O bound é£å°±æç²å¾æ¯è¼é«ç Priority</li>
    </ul>
  </li>
  <li>ç­å° Active queue ä¸­çææç task é½è¢«ç§»å° expired queue å¾ï¼å°±æå°å©å queue äº¤æ</li>
</ul>

<p><strong>4.10 O(1) Scheduler - bitmap</strong></p>

<p><img src="https://imgur-backup.hackmd.io/nM1OlJA.png" alt="" height="100%" width="100%" /></p>

<ul>
  <li>å¨ bitmap ä¸­æ¯å bit ä»£è¡¨ä¸å priorityï¼å¦æçº 1 è¡¨ç¤ºè³å°æä¸å task</li>
  <li>Insert, Delete çæ¼ç®æ³å¦ä¸:
    <ul>
      <li>Y = priority / 32, X = priority % 32</li>
      <li>ä¾å¦: ç·¨è 9 ç Priorityï¼9 / 32 = 0, 9 % 32 = 9, å³å¯å­å bitmap[0][9] è¨­å®çº 0 æ 1</li>
    </ul>
  </li>
  <li>Min(å°æ¾æé«åªåæ¬ç Task):
    <ul>
      <li>å¾ 0 éå§æ¾é¡¯ç¶è¦ O(N) çæéï¼ä¸æ¯ O(1)</li>
      <li>æç¡¬é«æ¯æ´çè©±å°±è½ç´æ¥ä½¿ç¨ä¸å Function <a href="https://en.wikipedia.org/wiki/Find_first_set">ffs()</a> å°±è½åå° O(1)</li>
      <li>å¨ <a href="https://github.com/torvalds/linux/blob/master/tools/include/linux/bitops.h">include/asm-generic/bitops</a> ä¸­æä¸ç³»å ffs() çå¯¦ä½</li>
    </ul>
  </li>
</ul>

<p><strong>Disadvantages of O(1) Scheduler</strong></p>

<ul>
  <li>è· 2.4 Scheduler ä¸æ¨£ï¼ä½¿ç¨ Epoch ä¾åå I/O bound &amp; CPU bound</li>
  <li>å æ­¤æ¯å Task é½è¦åä½¿ç¨å® Time slice ä»¥å¾ï¼ç¶éä¸å Epoch æè½ç²å¾æ´å¤ç Time slice</li>
  <li>å°æ¼æäºéè¦æ´é »ç¹çç²å CPU time ç Task ä¾èªªï¼ç¡è« Priority å¤é«é½è¦ç­å¾ä¸å Epoch æè½ç²å¾æ´å¤ç Time slice
    <ul>
      <li>ä¾å¦: éæ²ãå¤åªé«</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="https://zhuanlan.zhihu.com/p/33461281">è°è°è°åº¦ - Linux O(1)</a></p>
</blockquote>

<h5 id="411-cfs-scheduler">4.11 CFS Scheduler</h5>

<blockquote class="block-warning">
  <p>CFS source code ç®åå­å¨æ¼: <a href="https://github.com/torvalds/linux/blob/master/kernel/sched/fair.c">linux/kernel/sched/fair.c</a></p>
</blockquote>

<p>CFS (Completely Fair Scheduler) å¨ 2.6.23 ä¹å¾åä»£ O(1) Schedulerï¼ä½æ¯ O(1) Scheduler ç¨ç¹çè¨­è¨èç°¡å®çç®æ³ï¼
å½±é¿äºå¾å¤ç³»çµ±çè¨­è¨ãCFS éç¶å¨æ§è½ä¸æ¯ O(1) Scheduler å·®ï¼ä½æ¯å¨å¬å¹³æ§ä¸æ¯ O(1) Scheduler å¥½ã</p>

<ul>
  <li>CFS ç¨ç¹çå°æ¹å¨æ¼åå¡« Time quantum</li>
  <li>ç¸è¼æ¼åé¢å©ç¨® Schedulerï¼Priority é«ç Task åå¡«éåº¦ææ´å¿«
    <ul>
      <li>å æ­¤é« Priority ç Task æææ´å¤ç Time sliceï¼æ´å¥½ç Response time</li>
    </ul>
  </li>
</ul>

<p><strong>Design Concept</strong></p>

<ul>
  <li>å°ä¸é¡ Physical CPU ä¾ç§ç®åæ­£å¨å·è¡ç Task åæå¤å Virtual CPU</li>
  <li>åå¦éäº Task ç Priority é½ä¸æ¨£ï¼é£éº¼æ¯å Virtual CPU çæè½çº Physical CPU æè½ç 1 / N
    <ul>
      <li>éè¡¨ç¤ºå¦æ Task çåªåæ¬è¶ä½ï¼é£éº¼ä»ç Time slice å°±æè¶å°</li>
    </ul>
  </li>
  <li>ä½æ¯æ¯æ¬¡çå·è¡æéä¹æä¸éï¼ä¸å¯è½ä¾ç§ Task çæ¸éç¡éå¶çåå² 1 / Nï¼æä»¥ææä¸åè¨çå¼ Î»
    <ul>
      <li>Î» = ãå¸æéå°çåææéã/ã# of taskã</li>
      <li>éå Î» æ¯å¯ä»¥ç±ä½¿ç¨èè¨­å®ç</li>
    </ul>
  </li>
</ul>

<p>åå©å Scheduler é½æ¯ç­å°ææ Ready queue è£¡é¢ç Task é½ç¨å® Time sliceï¼Scheduler ææå»è¨ç®ä¸ä¸ååç Time sliceï¼
ç¨±ä½ <strong>Epoch</strong>ã</p>
<ul>
  <li>èç± Epoch å¯ä»¥ç Task å¨ä¸ä¸å Epoch çè¡çºä¾å¤æ·ä»æ¯ I/O bound éæ¯ CPU bound</li>
  <li>ä½æ¯å¨ CFS ä¸­ï¼æ¯ä¾ç§ waiting time ä¾æ±ºå®å·è¡é åºï¼waiting time è¶é·ç Task åªåå·è¡</li>
</ul>

<p><strong>CFS Architecture</strong></p>

<ul>
  <li>éè£¡ä½¿ç¨ rbtree ä¾å¯¦ä½ Ready queueï¼ä¾ç§ Task ç vruntime ä¾æåº
    <ul>
      <li>vruntime è¡¨ç¤ºçæ¯ä¸å task çæ­£å¨ CPU ä¸çå·è¡æé</li>
      <li>vruntime è¶å°è¡¨ç¤º Task å¨ CPU ä¸å·è¡çæéè¶å°ï¼å æ­¤å¾å¬å¹³çè§åº¦ä¾çåªåæ¬è¶é«</li>
    </ul>
  </li>
  <li>æ¯æ¬¡å·è¡å°±ååº rbtree ä¸­æå·¦éç Task å·è¡
    <ul>
      <li>å·è¡å®ç¢å¾å°±è¨å ä¸ delta_execï¼ç¶å¾éæ°æ¾åç´é»æ¨¹ä¸­å æ­¤ <strong>Time Complexity çº Î(log N)</strong></li>
      <li>éæ¨£å¯ä»¥ç¢ºä¿æ¯å Task é½ææ©æå¨ rbtree çæå·¦éï¼ä¹å°±æ¯æåªåå·è¡çä½ç½®</li>
    </ul>
  </li>
</ul>

<p><img src="/image/2023/10-19-cpu_scheduler/15.png" alt="" height="100%" width="100%" /></p>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="https://arthurchiao.art/blog/linux-cfs-design-and-implementation-zh/#22-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">Linux CFS è°åº¦å¨ï¼åçãè®¾è®¡ä¸åæ ¸å®ç°ï¼2023ï¼</a></p>
</blockquote>

<blockquote class="block-warning">
  <p>delta_exec å¦ä½è¨ç®ç source code ç®åå­å¨æ¼: <a href="https://github.com/torvalds/linux/blob/master/kernel/sched/fair.c">linux/kernel/sched/fair.c</a> ä¸­ç <code class="language-plaintext highlighter-rouge">__calc_delta()</code></p>
</blockquote>

<p><strong>Virtual Time</strong></p>

<p>å¨ä¹åç Schedulerï¼Time slice æ¯ä¸åºå®çï¼åªåæ¬è¶é«ç Task Time slice è¶é·ï¼ä½æ¯å¨ CFS ä¸­ï¼Time slice æ¯åºå®çï¼
éå Time slice æ¯ä¾ç§ç³»çµ±å¸æç Response time ä¾è¨ç®çã</p>

<p>ä¾å¦ä¸é¢çä¾å­ï¼å¦æå° CPU æ¨¡æ¬çº 3 å CPUï¼åå¥çº 1/2(èè²), 1/4, 1/4 çæè½ï¼é£éº¼æ¯æ¬¡ç¶èè²ç Task å·è¡å®ç¢å¾ï¼
è¨ç®åºç vrutime ææ¯ 1/4 çéè¦å°ï¼å æ­¤å¨åä¸åæéå®ä½å§ï¼èè²ç Task æå·è¡æ´å¤æ¬¡ã</p>

<p><img src="/image/2023/10-19-cpu_scheduler/16.png" alt="" height="100%" width="100%" /></p>

<p><strong>CFS - I/O</strong></p>

<ul>
  <li>å¦ææå¾ Waiting queue åä¾ç I/O Task æéº¼æä»æ¾å° rbtree æå·¦é</li>
  <li>å°ä»è¨­å®çºæå°ç vruntime éæ¨£å°±è½å¼·å¶ Scheduler é¦¬ä¸é²è¡ Context switch å·è¡ I/O Task
    <ul>
      <li>min_vruntime: CFS æå»ç¶­è­·ä¸å min_vruntimeï¼è¡¨ç¤ºç®å rbtree ä¸­æå°ç vruntime</li>
      <li>min_vruntime - Î è¨­å®çºå¾ waiting queue åä¾ç Task ç vruntime éæ¨£å°±è½é¦¬ä¸å·è¡</li>
    </ul>
  </li>
</ul>

<p>ä¹å çºéæ¨£çè¨­è¨ï¼åå¦æä¸å CPU bound Task å¨éæ¨£çè¨­è¨ä¸å³ä½¿ Priority æé« -19ï¼ä¹æè¢«æ¶èµ° CPU timeã</p>

<p><strong>CFS - New Task</strong></p>

<p>å°æ°é²å¥ç³»çµ±ç Task é½è¨­çº min_vruntime æå¥å° rbtree çæå·¦éï¼ä½æ¯å¦ææä¸åéæ¨£çç¨å¼:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fork</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>
<p>å¨ Linux çè§£æ±ºæ¹æ³æ¯å°å©é¤ç CPU time å¹³ååéçµ¦ child, parentï¼å¦å¤ä¹å¯ä»¥è¨­å® ulimit ä¾éå¶ä¸å process å¯ä»¥ fork çæ¬¡æ¸ï¼
è¶ééåæ¬¡æ¸å°±å¯ä»¥èªçºä»æ¯ä¸åæ¡æçç¨å¼ã</p>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="https://en.wikipedia.org/wiki/Fork_bomb">Fork bomb</a></p>
</blockquote>

<hr />

<h3 id="scheduler-problem">Scheduler Problem</h3>

<p>å°æ¼ç¾å¨ç Linux Scheduler ä¾èªªéæä»éº¼éæ±æ²æè¢«æ»¿è¶³:</p>

<ul>
  <li>å°æ¼ Real-time çæ¯æ´
    <ul>
      <li>ç®åæä¸»æµçæ´åå¥ä»¶æ¯ <a href="Real-Time Application Interface">RTAI</a></li>
      <li>å·²ç¶å¯ä»¥è¢«ä½¿ç¨å¨å å·¥ä¸ <a href="https://linuxcnc.org/">LinuxCNC</a></li>
    </ul>
  </li>
  <li>å°æ¼ Power management çæ¯æ´(Power saving)
    <ul>
      <li>åæèª¿æ´ CPU clock rate, voltage</li>
      <li>è® CPU è½é²å¥çé»æ¨¡å¼ï¼ä¾å¦: ACPI å®ç¾©ç C0, C1, C2 â¦ï¼Advanced Configuration and Power Interface</li>
    </ul>
  </li>
  <li>å°æ¼ BigLittle ç­æ°ç CPU Architecture çæ¯æ´</li>
  <li>åªåæ¬æ¯å¦å¯ä»¥å Time slice æéï¼ä»¥å¯¦ç¾æ´å¥½ç QoS(Quality of Service)
    <ul>
      <li>ä¾å¦: å¯¦ç¾ä¸å system call å«å balanceï¼å¯ä»¥èª¿æ´ time slice å priority çæ¯ä¾</li>
    </ul>
  </li>
</ul>

<blockquote class="block-warning">
  <h5 id="last-edit">Last Edit</h5>
  <p>12-02-2023 16:03</p>
</blockquote>

</section>
            </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div></div>
        <div class="normal">
            <section class="normal">
                
                <i class="fa fa-eye"></i>
                <span id="page-hit-tracker"></span>, 
                <i class="fa fa-archive"></i>
                
                OS
                
                
            </section>
        </div>
    </div>
<script async src="https://www2.cs.ccu.edu.tw/~xbs112m/tracker.php"></script>
</div>

<!-- introduce mathjax support -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ['$', '$'], ['\\(', '\\)'] ]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script
  type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>


<!-- introduce per-page mermaid support -->


<!-- introduce mathjax support -->
<script>
    function fixes_chrome_anchors() {
        let chrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
        if (window.location.hash && chrome) {
            setTimeout(function () {
                var hash = window.location.hash;
                window.location.hash = "";
                window.location.hash = hash;
            }, 300);
        }
    }

    if (document.readyState === "loading") {
        // Loading hasn't finished yet
        document.addEventListener("DOMContentLoaded", fixes_chrome_anchors);
    } else {
        // `DOMContentLoaded` has already fired
        fixes_chrome_anchors();
    }
</script>

<!-- customize line 38-50 swap next previous-->
                    
                        <a href="/jekylls/2023-10-26-syntax_analysis.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: OS | Process and Thread">
                            <i class="fa fa-angle-left"></i>
                        </a>
                    

                    
                        <a href="/jekyll/2023-10-18-process_thread.html" class="navigation navigation-next navigation-unique" aria-label="Next page: Compiler | Syntax Analysis Notes">
                            <i class="fa fa-angle-right"></i>
                        </a>
                    
                </div>
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "next": {
            "title": "Compiler | Syntax Analysis Notes",
            "level": "1.2",
            "depth": 1,
            "path": "_posts/2023/2023-10-26-syntax_analysis.md",
            "ref": "_posts/2023/2023-10-26-syntax_analysis.md",
            "articles": []
        },
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "expandable-chapter-small2": {
                "articlesExpand": true,
            },
            "fontsettings": {
                "family": "sans",
                "size": 1,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},            "sharing": {
                "facebook": false,

                "google": false,

                "github": true,
              
                "github_link": "https://github.com",
              

                "telegram": false,
                "telegram_link": "https://t.me",

                "instapaper": false,

                "twitter": false,
              

                "vk": false,

                "weibo": false,

                // "all": ["facebook", "google", "twitter", "weibo", "instapaper", "github", "telegram"]
            },
"theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            },
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "Home.md",
        },
        "variables": {},
        "title": "Home",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "_posts/2023/2023-10-19-cpu_scheduler.md",
        "mtime": "2023-10-19 00:00:00 +0000",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2025-09-16 12:46:29 +0000"
    },
    "basePath": "",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/assets/gitbook/gitbook.js"></script>
<script src="/assets/gitbook/theme.js"></script>

<script src="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
<script src="/assets/gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
<script src="/assets/gitbook/gitbook-plugin-expandable-chapters-small2/expandable-chapters-small.js"></script>
<script src="/assets/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
<script src="/assets/gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
<script src="/assets/gitbook/gitbook-plugin-search-pro/search.js"></script>
<script src="/assets/gitbook/gitbook-plugin-sharing/buttons.js"></script>
<script src="/assets/gitbook/gitbook-plugin-splitter/splitter.js"></script>

<!--
<script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script>
-->

</body>
</html>