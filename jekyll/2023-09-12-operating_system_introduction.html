<!DOCTYPE HTML>
<html lang="en" >
    <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="google-site-verification" content="MrJpPCJ8htzZlGpC1wo97QA1_XWns05Ez0LBsW3wj3I" /><title>OS | Operating System Introduction Â· Home</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="Build Jekyll site with the GitBook style.
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><meta name="author" content="Benson Hsu"><link rel="stylesheet" href="/assets/gitbook/style.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-expandable-chapters-small2/expandable-chapters-small.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-fontsettings/website.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-search-pro/search.css">
<link rel="stylesheet" href="/assets/gitbook/gitbook-plugin-splitter/splitter.css">

<link rel="stylesheet" href="/assets/gitbook/rouge/colorful.css">

<link rel="stylesheet" href="/assets/gitbook/custom.css">
<link rel="stylesheet" href="/assets/gitbook/custom-local.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/assets/gitbook/images/favicon.ico" type="image/x-icon">




            <link rel="prev" href="/jekyll/2023-09-07-test_case_generation_based_on_constraint_logic_graph.html" />
        

        
            <link rel="next" href="/jekyll/2023-09-20-compiler_introduction.html" />
        
    </head>
    <body>
        <div class="book"><div class="book-summary">
    <script type="text/javascript">
        // Fixes the page links scroll problem on both desktop and mobile browsers
        function pageScrollToTop(element) {
            // both mobile and non-mobile
            $('div.body-inner').animate({scrollTop: 0});
            $(element).parent().find('li>ul>li').removeClass('active');
            return true;  // propagate
        }
        // Fixes the anchor links scroll problem on mobile browsers
        function mobilePageScrollToAnchor(element) {
            $(element).closest('li.chapter').find('ul>li').removeClass('active');
            $(element).parent().addClass('active');
            if ($(document).width() <= 1240) {
                $('div.body-inner').animate({scrollTop: $($(element).attr('href')).get(0).offsetTop});
            }
            return true;
        }
    </script>

    <nav role="navigation">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search" />
        </div>
        <div id="book-search-input-link" role="search">
            <a href="/assets/search.html">Click to Search</a>
        </div>
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="">
            
                <a href="/" onclick="pageScrollToTop(this)">
                    Home
                </a>
            </li>

            <li class="divider"></li>

            
                <!-- <p>pages</p> -->
                
                    

                    

                    
                
            
                <!-- <p>posts</p> -->
                
                    

                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2025-09-13-Big_Number_Multiplication.html">
                        
                            <a href="/jekyll/2025-09-13-Big_Number_Multiplication.html" onclick="pageScrollToTop(this)">
                                Algorithm | Big Number Multiplication
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2025-09-12-Binary_Search_Tricks_and_Hacks.html">
                        
                            <a href="/jekyll/2025-09-12-Binary_Search_Tricks_and_Hacks.html" onclick="pageScrollToTop(this)">
                                Algorithm | Binary Search Tricks and Hacks
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2024-10-17-KLEE_symbolic_execution.html">
                        
                            <a href="/jekyll/2024-10-17-KLEE_symbolic_execution.html" onclick="pageScrollToTop(this)">
                                Paper | KLEE: Introducing Symbolic Execution
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2024-07-28-parallel_and_distributed_systems_introduction.html">
                        
                            <a href="/jekyll/2024-07-28-parallel_and_distributed_systems_introduction.html" onclick="pageScrollToTop(this)">
                                PDS | Introduction of Parallel and Distributed Systems
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-06-21-competitive_paging_algorithm.html">
                        
                            <a href="/jekylls/2024-06-21-competitive_paging_algorithm.html" onclick="pageScrollToTop(this)">
                                Algorithm | Competitive Paging Algorithm
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-06-09-arch_user_repository.html">
                        
                            <a href="/jekylls/2024-06-09-arch_user_repository.html" onclick="pageScrollToTop(this)">
                                Note | Arch User Repository
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-04-09-hirschbergs_algorithm.html">
                        
                            <a href="/jekylls/2024-04-09-hirschbergs_algorithm.html" onclick="pageScrollToTop(this)">
                                Algorithm | Hirschberg&#39;s Algorithm
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-03-08-ANTLR_guide.html">
                        
                            <a href="/jekylls/2024-03-08-ANTLR_guide.html" onclick="pageScrollToTop(this)">
                                Compiler | ANTLR Guide
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-03-06-arch_linux_installation.html">
                        
                            <a href="/jekylls/2024-03-06-arch_linux_installation.html" onclick="pageScrollToTop(this)">
                                Note | Arch Linux Installation
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-03-01-maven_multi_module_project.html">
                        
                            <a href="/jekylls/2024-03-01-maven_multi_module_project.html" onclick="pageScrollToTop(this)">
                                Note | Apache Maven Multi-Module Project Guide
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2024-02-03-storage_and_file_system.html">
                        
                            <a href="/jekyll/2024-02-03-storage_and_file_system.html" onclick="pageScrollToTop(this)">
                                OS | Storage and File System
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2024-01-05-debian_btrfs.html">
                        
                            <a href="/jekylls/2024-01-05-debian_btrfs.html" onclick="pageScrollToTop(this)">
                                Note | Using btrfs on Debian
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2023-12-26-code_generation.html">
                        
                            <a href="/jekylls/2023-12-26-code_generation.html" onclick="pageScrollToTop(this)">
                                Compiler | Code Generation (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-12-23-virtual_memory.html">
                        
                            <a href="/jekyll/2023-12-23-virtual_memory.html" onclick="pageScrollToTop(this)">
                                OS | Virtual Memory
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-12-20-system_testing.html">
                        
                            <a href="/jekyll/2023-12-20-system_testing.html" onclick="pageScrollToTop(this)">
                                Testing | System Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-12-12-mutation_testing.html">
                        
                            <a href="/jekyll/2023-12-12-mutation_testing.html" onclick="pageScrollToTop(this)">
                                Testing | Mutation Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-12-10-main_memory.html">
                        
                            <a href="/jekyll/2023-12-10-main_memory.html" onclick="pageScrollToTop(this)">
                                OS | Main Memory
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-12-09-class_level_testing.html">
                        
                            <a href="/jekyll/2023-12-09-class_level_testing.html" onclick="pageScrollToTop(this)">
                                Testing | Class-Level Unit Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2023-11-29-semantic_analysis.html">
                        
                            <a href="/jekylls/2023-11-29-semantic_analysis.html" onclick="pageScrollToTop(this)">
                                Compiler | Semantic Analysis Notes
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-28-test_coverage_criteria.html">
                        
                            <a href="/jekyll/2023-11-28-test_coverage_criteria.html" onclick="pageScrollToTop(this)">
                                Note | Test Coverage Criteria
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-25-method_level_structural_unit_testing.html">
                        
                            <a href="/jekyll/2023-11-25-method_level_structural_unit_testing.html" onclick="pageScrollToTop(this)">
                                Testing | Method-Level Structural Unit Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-24-deadlock.html">
                        
                            <a href="/jekyll/2023-11-24-deadlock.html" onclick="pageScrollToTop(this)">
                                OS | Deadlock
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-23-based_on_clp_testcases.html">
                        
                            <a href="/jekyll/2023-11-23-based_on_clp_testcases.html" onclick="pageScrollToTop(this)">
                                Testing | Based on CLP Testcases
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-11-09-synchronization.html">
                        
                            <a href="/jekyll/2023-11-09-synchronization.html" onclick="pageScrollToTop(this)">
                                OS | Synchronization (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-28-method_level_function_unit_testing.html">
                        
                            <a href="/jekyll/2023-10-28-method_level_function_unit_testing.html" onclick="pageScrollToTop(this)">
                                Testing | Method-Level Functional Unit Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2023-10-26-syntax_analysis.html">
                        
                            <a href="/jekylls/2023-10-26-syntax_analysis.html" onclick="pageScrollToTop(this)">
                                Compiler | Syntax Analysis Notes
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-19-cpu_scheduler.html">
                        
                            <a href="/jekyll/2023-10-19-cpu_scheduler.html" onclick="pageScrollToTop(this)">
                                OS | CPU Scheduler
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-18-process_thread.html">
                        
                            <a href="/jekyll/2023-10-18-process_thread.html" onclick="pageScrollToTop(this)">
                                OS | Process and Thread
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-17-container_of.html">
                        
                            <a href="/jekyll/2023-10-17-container_of.html" onclick="pageScrollToTop(this)">
                                Note | Linux Kernel Macro container_of &amp; offsetof
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-10-test_case_generation.html">
                        
                            <a href="/jekyll/2023-10-10-test_case_generation.html" onclick="pageScrollToTop(this)">
                                Testing | Test Case Generation
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-10-09-operating_system_structure.html">
                        
                            <a href="/jekyll/2023-10-09-operating_system_structure.html" onclick="pageScrollToTop(this)">
                                OS | Operating System Structure
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-23-software_testing_introduction.html">
                        
                            <a href="/jekyll/2023-09-23-software_testing_introduction.html" onclick="pageScrollToTop(this)">
                                Testing | Software Testing Introduction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekylls/2023-09-21-lexical_analysis.html">
                        
                            <a href="/jekylls/2023-09-21-lexical_analysis.html" onclick="pageScrollToTop(this)">
                                Compiler | Lexical Analysis Notes
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-20-compiler_introduction.html">
                        
                            <a href="/jekyll/2023-09-20-compiler_introduction.html" onclick="pageScrollToTop(this)">
                                Compiler | Compilers Introduction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter active" data-level="1.2" data-path="/jekyll/2023-09-12-operating_system_introduction.html">
                        
                            <a href="/jekyll/2023-09-12-operating_system_introduction.html" onclick="pageScrollToTop(this)">
                                OS | Operating System Introduction
                            </a>
                            
                                
                                    <ul><li><a href="#introduction" onclick="mobilePageScrollToAnchor(this)" >Introduction</a></li><li><a href="#main-memory" onclick="mobilePageScrollToAnchor(this)" >Main Memory</a></li><li><a href="#io-subsystem" onclick="mobilePageScrollToAnchor(this)" >I/O Subsystem</a></li><li><a href="#io-subsystem-notify-the-cpu" onclick="mobilePageScrollToAnchor(this)" >I/O Subsystem notify the CPU</a></li><li><a href="#scheduler-and-file-system" onclick="mobilePageScrollToAnchor(this)" >Scheduler and File System</a></li><li><a href="#hardware-progress" onclick="mobilePageScrollToAnchor(this)" >Hardware progress</a></li><li><a href="#driver-architecture" onclick="mobilePageScrollToAnchor(this)" >Driver Architecture</a></li><li><a href="#start-the-os" onclick="mobilePageScrollToAnchor(this)" >Start the OS</a></li></ul>

                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-07-test_case_generation_based_on_constraint_logic_graph.html">
                        
                            <a href="/jekyll/2023-09-07-test_case_generation_based_on_constraint_logic_graph.html" onclick="pageScrollToTop(this)">
                                Paper | Test Case Generation Based on Constraint Logic Graph
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-09-07-Introduction_OCL.html">
                        
                            <a href="/jekyll/2023-09-07-Introduction_OCL.html" onclick="pageScrollToTop(this)">
                                Note | Object Constraint Language Concepts (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-08-06-gdb_introduction.html">
                        
                            <a href="/jekyll/2023-08-06-gdb_introduction.html" onclick="pageScrollToTop(this)">
                                Note | GNU Debugger Quick Notes
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-08-05-linux_kernel_complie.html">
                        
                            <a href="/jekyll/2023-08-05-linux_kernel_complie.html" onclick="pageScrollToTop(this)">
                                OS | Linux Kernel Compilation
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-28-UML_structure_diagrams.html">
                        
                            <a href="/jekyll/2023-07-28-UML_structure_diagrams.html" onclick="pageScrollToTop(this)">
                                Note | UML Structure Diagrams Introduction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-28-UML_behavior_diagrams.html">
                        
                            <a href="/jekyll/2023-07-28-UML_behavior_diagrams.html" onclick="pageScrollToTop(this)">
                                Note | UML Behavior Diagrams Introduction (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-26-unified_modeling_language.html">
                        
                            <a href="/jekyll/2023-07-26-unified_modeling_language.html" onclick="pageScrollToTop(this)">
                                Note | Unified Modeling Language Concepts
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-22-property_based_testing_entropy_guided_backbox_REST_API-_fuzzer.html">
                        
                            <a href="/jekyll/2023-07-22-property_based_testing_entropy_guided_backbox_REST_API-_fuzzer.html" onclick="pageScrollToTop(this)">
                                Paper | BenFuzz: A Property Based Testing and Entropy Guided Blackbox REST API Fuzzer
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-19-MVVM_modeling_methodology_user_interface.html">
                        
                            <a href="/jekyll/2023-07-19-MVVM_modeling_methodology_user_interface.html" onclick="pageScrollToTop(this)">
                                Paper | A MVVM Modeling Methodology for Information Systems User Interface Design
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-18-software_arch_pattern.html">
                        
                            <a href="/jekyll/2023-07-18-software_arch_pattern.html" onclick="pageScrollToTop(this)">
                                Note | Architectural Patterns Compare MVP, MVC, MVVM
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-07-18-automated_gen_test_case_using_UML.html">
                        
                            <a href="/jekyll/2023-07-18-automated_gen_test_case_using_UML.html" onclick="pageScrollToTop(this)">
                                Paper | Automated-generating test case using UML statechart diagrams (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-06-23-Intergrated_environment_sdd.html">
                        
                            <a href="/jekyll/2023-06-23-Intergrated_environment_sdd.html" onclick="pageScrollToTop(this)">
                                Paper | An Integrated Environment for Specification Driven Development (Unfinished)
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-05-28-characteristics_of_bdd.html">
                        
                            <a href="/jekyll/2023-05-28-characteristics_of_bdd.html" onclick="pageScrollToTop(this)">
                                Paper | A Study of the Characteristics of Behaviour Driven Development
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-05-20-analysis_mutation_testing.html">
                        
                            <a href="/jekyll/2023-05-20-analysis_mutation_testing.html" onclick="pageScrollToTop(this)">
                                Paper | An Analysis and Survey of the Development of Mutation Testing
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-04-21-tdd_concepts.html">
                        
                            <a href="/jekyll/2023-04-21-tdd_concepts.html" onclick="pageScrollToTop(this)">
                                Paper | Test-driven development concepts, taxonomy, and future direction
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-04-18-applying_isoiec25010.html">
                        
                            <a href="/jekyll/2023-04-18-applying_isoiec25010.html" onclick="pageScrollToTop(this)">
                                Paper | Applying the ISO/IEC 25010 Quality Models to Software Product
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-04-13-software_standard.html">
                        
                            <a href="/jekyll/2023-04-13-software_standard.html" onclick="pageScrollToTop(this)">
                                Note | Standard - ISO/IEC
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-02-04-algorithm_kmp.html">
                        
                            <a href="/jekyll/2023-02-04-algorithm_kmp.html" onclick="pageScrollToTop(this)">
                                Leetcode | Algorithm - KMP
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2023-01-12-gomoku_ai.html">
                        
                            <a href="/jekyll/2023-01-12-gomoku_ai.html" onclick="pageScrollToTop(this)">
                                Note | Gomoku AI - Game Tree
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-24-git_commit.html">
                        
                            <a href="/jekyll/2022-11-24-git_commit.html" onclick="pageScrollToTop(this)">
                                Note | Commit Message Format
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-08-ai_csp.html">
                        
                            <a href="/jekyll/2022-11-08-ai_csp.html" onclick="pageScrollToTop(this)">
                                Note | Constraint Satisfaction Problem
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-07-network_urat.html">
                        
                            <a href="/jekyll/2022-11-07-network_urat.html" onclick="pageScrollToTop(this)">
                                Note | Basic UART Concept
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/2022-11-05-docker_jekyll.html">
                        
                            <a href="/jekyll/2022-11-05-docker_jekyll.html" onclick="pageScrollToTop(this)">
                                Note | Docker Build Github Pages
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/1970-01-01-virtual_machine_tool.html">
                        
                            <a href="/jekyll/1970-01-01-virtual_machine_tool.html" onclick="pageScrollToTop(this)">
                                Tool | Virtual Machine
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/1970-01-01-linux_config.html">
                        
                            <a href="/jekyll/1970-01-01-linux_config.html" onclick="pageScrollToTop(this)">
                                Tool | Linux Config
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/1970-01-01-leetcode_guide.html">
                        
                            <a href="/jekyll/1970-01-01-leetcode_guide.html" onclick="pageScrollToTop(this)">
                                Leetcode | Master Guide
                            </a>
                            
                                
                            
                        </li>
                    
                        
                        <li class="chapter" data-level="1.1" data-path="/jekyll/1970-01-01-editor_envirmnment.html">
                        
                            <a href="/jekyll/1970-01-01-editor_envirmnment.html" onclick="pageScrollToTop(this)">
                                Tool | Edirot Guide
                            </a>
                            
                                
                            
                        </li>
                    

                    
                        <li class="divider"></li>
                    
                
            
        </ul>
    </nav>
</div>
<div class="book-body">
                <div class="book-header" role="navigation">
                    <!-- Title -->
                    <h1>
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        
                            <a href="." >OS | Operating System Introduction</a>
                        
                    </h1>
                </div>

                <div class="body-inner"><div class="page-wrapper" tabindex="-1" role="main">
    

    <div class="page-inner">
        <div class="normal">
            
            
            <section class="normal">September 12, 2023 </section>
            
        </div>
        <div id="book-search-results">
            <div class="search-noresults">
                <section class="normal markdown-section">
                    
                        <h1 id="/jekyll/operating_system_introduction">OS | Operating System Introduction</h1>
                    

                    <blockquote class="block-tip">
  <p>Operating System: Design and Implementation course notes from CCU, lecturer Shiwu-Lo.</p>
</blockquote>

<h3 id="introduction">Introduction</h3>

<p><a href="./2023-09-12-operating_system_introduction.html#11-why-need-os">1.1 Why need OS</a><br />
<a href="./2023-09-12-operating_system_introduction.html#13-user-modekernel-mode">1.3 User mode/Kernel mode</a><br />
<a href="./2023-09-12-operating_system_introduction.html#15-user-spacekernel-space">1.5 User space/Kernel space</a><br />
<a href="./2023-09-12-operating_system_introduction.html#16-memory-management">1.6 Memory management</a><br />
<a href="./2023-09-12-operating_system_introduction.html#17-change-mode--system-call">1.7 Change mode &amp; System call</a><br />
<a href="./2023-09-12-operating_system_introduction.html#18-signal--systemcall">1.8 Signal &amp; Systemcall</a><br />
<a href="./2023-09-12-operating_system_introduction.html#19-monolithic-kernel">1.9 Monolithic kernel</a><br />
<a href="./2023-09-12-operating_system_introduction.html#110-kernel-module">1.10 Kernel module</a></p>

<h5 id="11-why-need-os">1.1 Why need OS</h5>

<ol>
  <li>ä½æ¥­ç³»çµ±ä½¿é»è¦æ´ææ¼ä½¿ç¨
    <ul>
      <li>ç£ç¢æ¯ç± Block(éå¸¸çº4K) æçµæï¼OS å°ç£ç¢ååçº Fileï¼åå°æªæ¡æ­¸é¡çº Folder æææ¼ä½¿ç¨ã</li>
      <li>å¯ç¨å¼å(Programmable) è®å¾æ´å®¹æï¼OS è½å·è¡å·è¡æªï¼CPU å·è¡ä¸åç¨å¼ç¢¼å°±ææä¸ååè½ã
 OS ä½¿ç¨å¼ç¢¼æ½è±¡çºå·è¡æªï¼è½å¤ å¾ååå°æ¹è¼å¥å¯å·è¡çç¨å¼ç¢¼ï¼ä¸¦ä¸è³¦äºéè¼¯ä¸çæ¯æ´ã</li>
      <li>ç¡¬é«æ½è±¡å(Hardware abstraction) å¦æ»é¼ ãè§¸æ§æ¿è¢« OS æ½è±¡åçºä¸åææ¨è£ç½®ï¼ä½¿ä½¿ç¨èè½çµ±ä¸æä½ã</li>
      <li>OS ä¸ä¸æåªéè¡ä¸åç¨å¼ï¼å æ­¤å¿é ææç¨ç¨å¼ä¹éçéè¨ï¼å¦: Copy &amp; Pasteã</li>
    </ul>
  </li>
  <li>ä½¿é»è¦çç¡¬é«ä½¿ç¨æ´ææç(è³æºåé)
    <ul>
      <li>ä¸å°é»è¦å¯è½æå¤åç¡¬é«å­å¨ï¼OS å¯ä»¥ä½¿éäºç¡¬é«ä¸èµ·å·¥ä½ã</li>
      <li>ä¾å¦å¨è¶³å¤ è¨æ¶é«çææ³ä¸å¯ä»¥åæè¼å¥å¤åå·è¡æªä¸¦å·è¡ï¼ä¸¦ä½¿ç¨ç¡¬ç¢å æ¾æ«æç¨ä¸å°çè¨æ¶é«ï¼ä»¥ç©ºåºè¨æ¶é«çµ¦çæ­£éè¦çç¨å¼ã</li>
      <li>éé CPU Schedulerï¼ä½¿ I/OãCPU é½è½ç¶­æå¨é«ä½¿ç¨çã</li>
    </ul>
  </li>
</ol>

<h5 id="13-user-modekernel-mode">1.3 User mode/Kernel mode</h5>

<p>å¤§é¨åçä½æ¥­ç³»çµ±ä»¥éç³»çµ±(Dual-Mode)(Linux, Windows)ï¼å¯åçº User mode è Kernel mode:</p>

<ul>
  <li><strong>Dual mode operation</strong></li>
  <li><strong>User mode</strong>: CPU ææä¾çå·è¡æ¨¡å¼ï¼åªè½å­åæéçç¡¬é«è³æºï¼å¦:<br />
æ®ééç®æéçæ«å­å¨ãé¨åè¨æ¶é«å§å®¹
    <ul>
      <li>Various applications: libreoffice, gnuplot, pdf viewer</li>
      <li>GUI: X11, Gnome, KDE</li>
      <li>System manager: bash, vi, ls, mount, passwd</li>
      <li>Development tools: gcc, gdb</li>
      <li>System service: sftpd, sshd</li>
      <li>Basic inetrnet communication software: Browser, ftp</li>
      <li>Other library: courses, math</li>
      <li>Standard function library: Parts defined in POSIX like, libC, pthread</li>
    </ul>
  </li>
  <li><strong>Kernel mode</strong>: CPU ææä¾çå·è¡æ¨¡å¼ï¼å¯ä»¥å°ç¡¬é«åä»»ä½çè®æ´ï¼å¨ Kernel mode è½é¡å¤æ§å¶çé¨åå¦ä¸:<br />
æ§å¶æ«å­å¨(Control register)ï¼ä¾å¦æ§å¶ MMU(Memory management unit) çç¸éæ«å­å¨ãææè¨æ¶é«
    <ul>
      <li>Memory management</li>
      <li>Schedule and thread management</li>
      <li>Inter-Process communication</li>
      <li>Virtual memory</li>
      <li>Network communication</li>
      <li>Scheduler</li>
      <li>File system</li>
      <li>Safety, Authority management</li>
      <li>I/O Subsystem</li>
    </ul>
  </li>
</ul>

<p>éç¨®æ¨¡å¼ä¸ Kernel mode æè½å®å¨çææ§ç¡¬é«ï¼ä»å¤©å¦æ User mode ä¸çç¨å¼æ³è¦å­åç¡¬ç¢åéè¦éé System call ä¾é²è¡æä½ãå¨ Linux çè¨­è¨ååæ¯éåº¦ç¬¬ä¸ï¼ç¶ç¶ç¨å¼è¶é è¿ç¡¬é«å°±ææ´å¿«ã
ä½å¦æ User mode æ³è¦æä½ç¡¬é«è¦éé System call ä¾é²è¡ä¹å°±æ¯æ¹è®æ¨¡å¼(Change mode)ï¼ä½éæ¨£æç¢çä¸å®ç<strong>æ¶è</strong>ãèå¨ Kernel mode ä¸­é²è¡æä½ç¡¬é«å°±åªç­æ¼ Function call çæ¶èèå·²ã</p>

<ul>
  <li>User mode æ³è¦é²è¡åæå°±å¯è½éè¦<strong>ä¿å­ç¶åçæä»¥åå¾©</strong>ã<strong>æ¸é¤ Pipeline</strong>ã<strong>æ¸é¤ TLB å Cache</strong> éäºé¡å¤æ¶èã</li>
  <li>Dual mode éå¸¸éè¦ç¡¬é«é¡å¤æ¯æ´ï¼ä¾å¦æä¾ä¸å <strong>Mode bit</strong> çæ«å­å¨ä¾æ±ºå®ç¾å¨æ¯åªä¸ç¨® Modeã</li>
</ul>

<blockquote>
  <p>ä¾å¦ä¸åç¶²é ï¼å¯ä»¥å°éæé é¢æ¾å¨ Kernel modeï¼åæé é¢å¨ User modeã</p>
</blockquote>

<p>ä½ä¸æ¯å°ææç¨å¼é½æ¾å¨ Kernel modeï¼å çºåªè¦æ¯ç¨å¼å°±ææ Bugï¼å¨ Kernel mode ä¸­ç¼çäº Bug å¾å¯è½å°è´æ´åç³»çµ±çå´©æ½°ã</p>

<p><img src="/image/2023/09-12-operating_system_introduction/1.png" alt="" height="75%" width="75%" /></p>

<h5 id="15-user-spacekernel-space">1.5 User space/Kernel space</h5>

<p>èæ¬è¨æ¶é«(<a href="https://en.wikipedia.org/wiki/Virtual_memory">Virtual memory</a>)ä¹åçº User/Kernel spaceï¼éä¸»è¦æ¯çºäºä¿è­· Memory è Hardwareã
CPU å¨ååè¨æ¶é«ææ¯åå®ä½æéå ä¸äºå±¬æ§ï¼å¶ä¸­ä¸åéè¦çå±¬æ§å°±æ¯æåºè©²å®ä½çº User/Kernel spaceã</p>

<ul>
  <li>Task ä¹éä¸è½è®ååèªç User spaceã</li>
  <li>Kernel æè½æ¹è®æ¬éï¼I/Oï¼ä¸¦ä¸ææææçå­åæ¬ã</li>
</ul>

<table>
  <tbody>
    <tr>
      <td>å¯å¦å­å</td>
      <td>Kernel space</td>
      <td>User space</td>
      <td>Privilege instructions</td>
    </tr>
    <tr>
      <td>Kernel mode</td>
      <td>â</td>
      <td>â</td>
      <td>â</td>
    </tr>
    <tr>
      <td>User mode</td>
      <td>Â </td>
      <td>â</td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<h5 id="16-memory-management">1.6 Memory management</h5>

<p>Virtual memory çç®¡çå®ä½å¯ä»¥åçºå©ç¨®ï¼åé (Paging)ï¼åæ®µ(Segmentation):</p>

<ul>
  <li>Paging: å°é£çºçè¨æ¶é«å¨éè¼¯ä¸è®æ 4K å¤§å°ç Page æ¹ä¾¿è»ãç¡¬é«å°è¨æ¶é«é²è¡ç®¡ç
    <ul>
      <li>éæ¯ç®åæå¸¸è¦çåæ³ï¼å¨ç®¡çä¸å¯ä»¥è¼å¥½çåéè¨æ¶é«</li>
      <li>ä½æ¥­ç³»çµ±æç¡éä½¿ç¨ Huge page(å¤§åé )ï¼ä¸å Huge page å¯ä»¥æ 2M å° 1G çå¤§å°ï¼å çºéæ¨£éè¦ç Page æ¸éè¼å°ï¼
å¨ç¡¬é«ç®¡çä¸æå¸æ Page ç¡éå¤§ä¸é»ã</li>
      <li>ä½æ¯ Linux å¨ User space å¹¾ä¹æ²æä½¿ç¨å¤§åé ï¼é¤éç¹å¥å»è¨­å®è¦ä½¿ç¨ Huge pageï¼å çºå¨è»é«ä¸ç®¡ç Page åè 4K å¯ä»¥æ¸å°è¨æ¶é«æµªè²»ã</li>
    </ul>
  </li>
  <li>Segmentation: å°é£çºçè¨æ¶é«å¨éè¼¯ä¸è®æååå¤§å°ä¸ä¸ç Segmentï¼æ¯å Segment å°æå°ç¨å¼çç¹å®ç¨é
    <ul>
      <li>x86 å¨ 32 ä½åæ¨¡å¼æ¯æ´ segmentation</li>
      <li>Segment å¨éç½®ä¸æ¯è¼å°é£ï¼ä½å¨åµå¥å¼ç³»çµ±ä¸­å çºæ²æä»éº¼åæéç½®çéæ±å æ­¤è¼å¸¸ç¨</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>ä»¥ä¸çæ¹æ³é½éè¦ç¡¬é«æ¯æ´ï¼æ¯å çº CPU èç¡¬é«çèçéåº¦å æ­¤éè¦ç¡¬é«æ¯æ´æè½ä½¿éåº¦æåã</p>
</blockquote>

<h5 id="17-change-mode--system-call">1.7 Change mode &amp; System call</h5>

<p><strong>å¾ User mode åæå° Kernel mode</strong>ï¼æ¯éé <code class="language-plaintext highlighter-rouge">syscall</code> éåçµèªä¾é²è¡:<br />
OS init ææåè¨´ CPU ç¶ä½¿ç¨èå¼å« <code class="language-plaintext highlighter-rouge">syscall</code> çæåï¼æä»¤ææ¨(%RIP Register)æè©²è¨­å®çºä½(system call çé²å¥é»)<code class="language-plaintext highlighter-rouge">ï¼syscall</code> åå©ä»¶äº:</p>
<ol>
  <li>ä¿å­ç¶åçç¨å¼çæï¼ä»¥ä¾¿ä¹å¾è¿å</li>
  <li>å°æ¨¡å¼åæçº Kernel modeï¼ä¾å¦å° Mode bit è¨­çº 0</li>
  <li>æºåè¦è¢«å¼å«ç System callï¼ä¾å¦å¨x86-64æ¶æ§ä¸­ç %RAX Register æ¾å¥è¦è¢«å¼å«ç System call ç·¨è</li>
</ol>

<p><strong>åæ Stack</strong>:</p>
<ul>
  <li>User space stack ä¸éå§åªéç½® 16Kï¼ä¸å¤ åé Signal çµ¦ Kernel ä¸æ¬¡å¤è¦ 4K Page æå¤æé·å° 8M</li>
  <li>Kernel space stack çå¤§å°ä¸¦ä¸æå¾å¤§ï¼ä¸¦ä¸ System call ä¹ä¸æä½¿ç¨ç¢çå ççå¯«æ³</li>
  <li>User/Kernel mode çå çæ¯åéçï¼Kernel ä¸è½ç¢ç faultï¼æä»¥å¨ Kernel mode ä½¿ç¨çæ¯ Kernel space stack
    <ul>
      <li>ç©©å®æ§: ä¾å¦ User mode å·²ç¶ææå·è¡äºä¸å 7.8M å ççç¨å¼ï¼æ­¤æ Change mode ä½æ²æä½¿ç¨ Kernel space éæ¨£å°±æéå° Segmentation fault</li>
      <li>ä¿å¯æ§: åæ User space stack å¦æå·è¡å®æ²æé²è¡æ¸ç©ºä¹æå¯è½æ´©æ¼ Kernel çè³æ</li>
    </ul>
  </li>
  <li>å¨ syscall æºå system call çæååæéè¦æºåå·è¡ç°å¢ï¼ä¾å¦å·è¡ write(clang) å°±è¦æºåå¥½è¦ä½¿ç¨ç stack ä¾å¼å« C å½æ¸</li>
  <li>å¦æå¨æ²è¾¦æ³åæå ççç³»çµ±ä¸ï¼ä¹è¦ç¡éè¡¨çä¸åçµ¦ Kernel mode ä½¿ç¨çå çå¤§å° 16K</li>
</ul>

<p><strong>å¾ Kernel mode åå° User mode</strong>ï¼éè¦ç¨å° <code class="language-plaintext highlighter-rouge">sysret</code> æä»¤ä¾é²è¡ï¼æ­¤æ OS æè¿åå°å(æ¥ä¸ä¾å·è¡ç User mode ç¨å¼ç¢¼)<code class="language-plaintext highlighter-rouge">ï¼sysret</code> åå©ä»¶äº:</p>
<ol>
  <li>è¿å user mode çç¨å¼ç¢¼ä½ç½®ï¼ä¾å¦ x64 æ¾å¨ %RCX Register</li>
  <li>åæçº user modeï¼ä¾å¦å° Mode bit è¨­çº 1</li>
</ol>

<blockquote class="block-tip">
  <p>ä¸æ¯ææç System call é½æé²è¡å®æ´ç Context switchï¼ä¾å¦ <code class="language-plaintext highlighter-rouge">getpid()</code>ï¼å°±ä¸éè¦æç¶åçç¨å¼çæä¿å­å®æ´ã</p>
</blockquote>

<ul>
  <li><strong>System call handler</strong> å¿é ç¢ºä¿å¾ Kernel è¿å User mode æï¼ç¨å¼<strong>å°ä¾</strong>å¯ä»¥<strong>ç¹¼çº</strong>å·è¡</li>
</ul>

<p>Super user ä¹æ¯ä½¿ç¨ç¸åç System call é²å¥é»ï¼å¤§é¨åç System call æå¤æ·æ¬éä½ <code class="language-plaintext highlighter-rouge">uid=0</code> çæåå°±ç´æ¥ééï¼General user ç <code class="language-plaintext highlighter-rouge">uid &gt; 1000</code>ã
Linux å®ç¾©äºç´ 400 System call(Function)ï¼å¤§é¨åé½éé syscall é²å¥ Kernelã</p>

<h5 id="18-signal--systemcall">1.8 Signal &amp; Systemcall</h5>

<p>ç¶ Kernel æç¹å¥äºä»¶éè¦ä¸»åéç¥ Processï¼å°±ä½¿ç¨ Signal æ©å¶ï¼Signal æ¥åå©åéè¦åæ¸: äºä»¶ç·¨èãç¼çè©²äºä»¶æå¼å«è©²ç¨å¼æå®ç¾©çç¹å®å½æ¸</p>
<ol>
  <li>äºä»¶ç·¨è: ä¾å¦ SIGINT çç·¨èæ¯ 2ï¼è¡¨ç¤ºéµç¤ä¸­æ·(ä¾å¦ Ctrl + C)ï¼æ¯ç¨® Signal é½æå¯ä¸çç·¨èï¼OS ä¸­å·²è¢«å®ç¾©</li>
  <li>è©²äºä»¶ç¼çææèççå½æ¸ï¼å¯ä»¥æ¯ç¨å¼èªå·±å®ç¾©çå½æ¸ææ¯ç³»çµ±é»èªçå½æ¸å¼å«</li>
</ol>

<p>Linux kernel åªåè¨±ä¸å Process åæéç¼åºä¸å Blocking system callï¼éè¦ç­å¾ Kernel å®æè©²å·¥ä½(System call)æåå³çç³»çµ±å¼å«ã
ç¶ Process ç¼åº Blocking system call å¾ï¼è©² System call éæªçµæåå¦æç¼ç signal(ä¾å¦ Ctrl + C)ï¼Kernel è©²å¦ä½èç?</p>

<ol>
  <li>ä¸çæè©² Signalï¼ç¹¼çºå®æ System call</li>
  <li>èçè©² Signalï¼è©² System call è®æå¤±æï¼éå¸¸ä½æ¥­ç³»çµ±æéæ°èµ·å§(Redo)è©² System call</li>
</ol>

<blockquote>
  <p>å»¶ä¼¸é±è® <a href="https://devopedia.org/linux-signals">Linux Signals</a>ã<a href="https://unix.stackexchange.com/questions/16455/interruption-of-system-calls-when-a-signal-is-caught">Interruption of system calls when a signal is caught</a></p>
</blockquote>

<h5 id="19-monolithic-kernel">1.9 Monolithic Kernel</h5>

<blockquote>
  <p>åå¦ä¸åäººä¸å¤©å¯ä»¥è® 1000 è¡ç¨å¼ç¢¼ï¼Linux kernel çæé·éåº¦å¯è½æ¯ä¸å¤©è¶é 3000 è¡ã</p>
</blockquote>

<ul>
  <li>Monolithic kernel å¤§é¨åçç³»çµ±åè½é½è¨­è¨å¨ Kernel mode ä¸­ï¼éæ¨£çå¥½èæ¯å·è¡æçï¼ååæ¨¡çµéçæºéåçº Function callï¼
ä½åæ¨£ç Kernel ä¹è®å¾è¶ä¾è¶è¤éï¼ä¹å®¹æç¢çé¯èª¤ã</li>
  <li>Micro kernel ç¡å¯è½çå° OS çç³»çµ±æåå·è¡æ¼ User modeï¼è®ç³»çµ±è®çè¼çºç©©å®ï¼
ä½æ¯ User mode ç Process éè¨éè¦è§¸ç¼ Context switch è Mode changeï¼æè½è¼çºä½è½ã</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: center">è¨­è¨æ¨¡å¼</th>
      <th style="text-align: center">ç³»çµ±ç¨å¼</th>
      <th style="text-align: center">æè½</th>
      <th style="text-align: center">æ ¸å¿å¤§å°</th>
      <th style="text-align: center">éè¨æ¶è</th>
      <th style="text-align: center">OS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Monolithic</td>
      <td style="text-align: center">å¤§é¨åå¨ Kernel mode</td>
      <td style="text-align: center">é«</td>
      <td style="text-align: center">å¤§</td>
      <td style="text-align: center">Function call çæ¶è</td>
      <td style="text-align: center">Linux, BSD</td>
    </tr>
    <tr>
      <td style="text-align: center">Micro</td>
      <td style="text-align: center">å¤§é¨åå¨ User mode</td>
      <td style="text-align: center">ä½</td>
      <td style="text-align: center">å°</td>
      <td style="text-align: center">Context switch çæ¶è</td>
      <td style="text-align: center">Minix, L4, Android</td>
    </tr>
  </tbody>
</table>

<p>Linux å¨å®å¨æ§æèä¸å¯ä»¥æè root çæ¬éæ¯å¦å¤ªå¤§äºï¼root ææ¬çå°ææçè³è¨ï¼å¨å®å¨æ§ä¸å¯ä»¥ééå å¯ä¾åå°ã</p>

<blockquote class="block-tip">
  <p>Context switch &amp; Mode change éå©åè¦åæ¸æ¥:</p>
  <ol>
    <li><strong>Context switch</strong>: åæ¬å¨å·è¡ Process Aï¼ç¾å¨è¦ææ Process B</li>
    <li><strong>Mode change</strong>: Process A åæ¬å·è¡å¨ User modeï¼å çºè¦å·è¡ System call ç¾å¨è¦åæå° Kernel mode</li>
  </ol>
</blockquote>

<h5 id="110-kernel-module">1.10 Kernel Module</h5>

<p>Kernel moduel å¨æç¾©ä¸å°±æ¯<strong>æ ¸å¿çæä»¶</strong>ï¼å¯ä»¥æ´åæ ¸å¿çåè½ï¼æç´è§çæä»¶å°±æ¯é©åç¨å¼ã
Monolithic è¨­è¨ä¸ç Kernel module éè¡å¨ Kernel modeï¼Micro kernel åç¸åã</p>

<ul>
  <li>Kernel module å¨éè¦çæååè¼å¥ï¼ä¾å¦ USB å¦ææ¯æ¯ä¸å ext4 file systemï¼
æå¥é»è¦å¾ Linux Kernel èªåºå¾å°±è½è¼å¥ ext4 module ä¾è®åè©² USB</li>
  <li><code class="language-plaintext highlighter-rouge">lsmod</code> ååºç®åç Kernel moduleï¼ä¸¦ä¸ Kernel module ä¹éææç¸ä¾æ§ï¼ä¾å¦å¦æ Network æ¯ä¸åå¯«å¥½ç Kernel Moduleï¼
é£å®å°±æä¾è³´æ¼ Network card ç Kernel moduleã</li>
</ul>

<h3 id="main-memory">Main Memory</h3>

<p><a href="./2023-09-12-operating_system_introduction.html#111-main-memory-usage">1.11 Main memory usage</a><br />
<a href="./2023-09-12-operating_system_introduction.html#112-memory-and-storage-consistency">1.12 Memory and storage consistency</a><br />
<a href="./2023-09-12-operating_system_introduction.html#113-linux-base-file-system-management">1.13 Linux base file system management</a></p>

<h5 id="111-main-memory-usage">1.11 Main memory usage</h5>

<p>Linux å°ä¸»è¨æ¶é«åçºä¸ç¨®ä¸»è¦ç¨é:</p>

<ol>
  <li>Cache memory(Page cache):
    <ul>
      <li>å° Disk æ SSD ç­å²å­è£ç½®ä¸çå§å®¹æ«å­æ¼è¨æ¶é«ä¸­ï¼ä»¥æé«å­åéåº¦</li>
      <li>æªæ¡ç³»çµ±ç Metadata!?</li>
    </ul>
  </li>
  <li>Buffer memory:
    <ul>
      <li>è I/O ä¹éççè³æäº¤æï¼DMA</li>
      <li>ä¸»è¦æ¯ CPU çéåº¦é«æ¼å¨ééåº¦ï¼æ ¼å¼çè½æç­ç­(å¦ç¶²è·¯å¡)</li>
    </ul>
  </li>
  <li>Program memory:
    <ul>
      <li>å°è¨æ¶é«åéçµ¦ç¨å¼ä½¿ç¨ï¼å¦: ç¨å¼å¯ä»¥éé malloc(èå¾ç System call å¸¸å¸¸æ¯ brk)ãnmap ç­å½æ¸ç´¢åè¨æ¶é«</li>
      <li>å·è¡æªå¿é è¼å¥ä¸»è¨æ¶é«å¾æè½å·è¡</li>
    </ul>
  </li>
</ol>

<p>Linux ååä¸æç¡å¯è½çä½¿ç¨æææè¨æ¶é«ä»¥å é I/Oï¼ç¶è¨æ¶é«ä¸è¶³æ Linux æéæ¾ Cache memory å Buffer memoryã</p>

<p><img src="/image/2023/09-12-operating_system_introduction/2.png" alt="" height="75%" width="75%" /></p>

<h5 id="112-memory-and-storage-consistency">1.12 Memory and storage consistency</h5>

<p>ä¸»è¨æ¶é«æ¡ç¨ DRAM æ·é»å¾å¤±å»å§å®¹ï¼å æ­¤éè¦éæ®ç¼æ§çç¬¬äºå±¤å²å­è£ç½®(Secondary storageï¼Disk, SSD)ã</p>

<ul>
  <li>èé»è¦å¿é å°ç¬¬äºå±¤å²å­è£ç½®çå§å®¹è¼å¥è¨æ¶é«å¾æå¯ä»¥ä¾ CPU éç®
    <ul>
      <li>å¯ä»¥ééæç¢ºçç¨å¼ç¢¼å­åè³æï¼å¦: open, read, write</li>
      <li>ä¹å¯ä»¥éé mmap çæ¹å¼å°æªæ¡ Maping å°æç¨ç¨å¼çè¨æ¶é«ç©ºéå ä»¥èç</li>
    </ul>
  </li>
  <li>ç¨å¼è OS é½å¿é å®æçå°è³æåå­å°ä¸å±¤è£ç½®
    <ul>
      <li>OS è I/O å½æ¸åº«é½å¯è½éé Buffering çæ©å¶ï¼ä»¥æ¹æ¬¡çæ¹å¼å¯«åºè³æä»¥å¢å æç</li>
      <li>æç¨ç¨å¼å¯ä»¥å¼å«å½æ¸å¼·å¶å°è³æå¯«åºï¼å¦: sync, fsync, fdatasyc</li>
    </ul>
  </li>
</ul>

<p>æè½ä¸çèé read &gt; writeï¼read ä¸è½å»¶é²ï¼å»¶é²å°å°è´ç¨å¼ç¡æ³å·è¡ã<br />
çµæä¸çèé write &gt; readï¼ç¶ä½¿ç¨èä½¿ç¨ Ctrl+S é²è¡å²å­æï¼è¥å¨ä¸­éç¶æ©è³æä¸¦æ²æççå¯«å¥ Diskï¼ä½¿ç¨èå°ç¡æ³æ¥åã<br />
write å¾ä¸å¯«å¥æä¸ä¸å®é¦¬ä¸æè³æå¯«å¥ Diskï¼æå¯è½åªæ¯åæ«æå­å¨ Memory/Buffer ä¸­ï¼åæè£ç½®ä¸å¯è½ä¹ææ Buffer ä¾å¦ SSDã
éè£¡æä¾å¦ Write-throughï¼Write-back ç­ä¸åæ¹å¼çå¯«å¥æ¯ OS è½é²è¡æä½çã</p>

<ul>
  <li><strong>Write-through</strong>: å¯«å¥ Main memory æåæå¯«å¥ Cache éæ¨£å¯ä»¥ä¿è­è³æçä¸è´æ§</li>
  <li><strong>Write-back</strong>: å¯«å¥æ¸ææåå¯«å¥ Cacheï¼ä¸¦å°è³ææ¨è¨çº <code class="language-plaintext highlighter-rouge">dirty</code>(å·²ä¿®æ¹ä½æªå¯«åä¸»è¨æ¶é«)ï¼ç¶å¾å¨ç¨å¾çæéé»å°è³æå¯«åè¨æ¶é«ï¼ä¾å¦: Cache éè¦æ°çç©ºéä¾å²å­æ°çæ¸æ</li>
</ul>

<blockquote>
  <p>æ·±å¥æèï¼å¦æè£ç½®ä¸è½æé»æ± çè©±å°±è½ä¿è­å¯«å¥æé¨ä»½çå®å¨æ§ï¼å¦æå·²ç¶å¯«å¥è£ç½®ä¸ç Buffer æ­¤æé»æºåºç¾æå¤ä¹è½ç­æéå§é²è¡å²å­</p>
</blockquote>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="http://thebeardsage.com/write-through-vs-write-back/">Write-through vs Write-back</a></p>
</blockquote>

<h5 id="113-linux-base-file-system-management">1.13 Linux base file system management</h5>

<ul>
  <li>ä¹å­æªæ¡æ¬éç®¡çï¼åçºæªæ¡èè³æå¤¾ï¼è©³æå¯çé³¥å¥çä»ç´¹ <a href="https://linux.vbird.org/linux_basic/centos7/0230filesystem.php">ç¬¬ä¸ç« ãLinux ç£ç¢èæªæ¡ç³»çµ±ç®¡ç</a></li>
  <li>Linux çæªæ¡ç³»çµ±æ¯æ´ ACL(Access control list)
    <ul>
      <li>ACL å¯ä»¥å°ååä½¿ç¨èæååç¾¤çµåå¥è¨­å®æ¬é</li>
      <li>ACL ä¾è³´åºå±¤çæªæ¡ç³»çµ±æ¯æ´ï¼å¦: EXT4, BTRFS ç­é½æ¯æ´ ACL</li>
      <li>å¯ä»¥ä½¿ç¨æä»¤ <code class="language-plaintext highlighter-rouge">setfval</code> è <code class="language-plaintext highlighter-rouge">getfacl</code> åå¥è¨­å®åè®åæªæ¡æç®éçæ¬é</li>
    </ul>
  </li>
</ul>

<blockquote class="block-tip">
  <p>ä½æ¯ææå¾ Normal user ä¹éè¦æ´æ¹æ¬éä¾å·è¡æäºç¨å¼ï¼ä¾å¦: <strong>passwd</strong>, ä»æå¨å·è¡ä¸­ä½¿ç¨ <strong>setuid</strong> ä¾æ«ææ¹è®ä½¿ç¨èæ¬éï¼
ç´å° <strong>passwd</strong> å·è¡çµæ(æèæ¯è©²ç¨å¼æ¾æ£ root æ¬é)</p>
</blockquote>

<p>Computer world ä¸­çæ¬éå¾å¾èç¾å¯¦ä¸ççæ¬éä¸ç¸ç­</p>

<ul>
  <li>Linux ä¸­ root æææé«æ¬éï¼root å¯ä»¥å°æªæ¡ç³»çµ±ãæç¨ç¨å¼(è¨æ¶é«)é²è¡åå¼æ¨£çæä½</li>
  <li>root å¯ä»¥å­åææä½¿ç¨èçæªæ¡(çè³æ¯æ©å¯æªæ¡)ï¼éèçå¯¦çæ¬éä¸ç¬¦å(èé = Normalï¼ç³»çµ±ç®¡çè = Super)</li>
  <li>ç®åå¤§é¨åç Linux æä¾è³æå¤¾å å¯çåè½ï¼å¯ä»¥é¨åæ¹ååé¡</li>
</ul>

<h3 id="io-subsystem">I/O Subsystem</h3>

<p><a href="./2023-09-12-operating_system_introduction.html#114-io-subsystem--control">1.14 I/O Subsystem &amp; Control</a><br />
<a href="./2023-09-12-operating_system_introduction.html#115-io-subsystem-transfers-data">1.15 I/O Subsystem transfers data</a><br />
<a href="./2023-09-12-operating_system_introduction.html#116-cpu-and-dma-compete-for-memory-access">1.16 CPU and DMA compete for memory access</a></p>

<h5 id="114-io-subsystem--control">1.14 I/O Subsystem &amp; Control</h5>

<p>å¨éè£ç½®å¯è½æä¸åå²å­è³æçæ¹å¼ï¼ä¾å¦æ»é¼ éµç¤å¯è½åéè¦å§å»ºæ«å­å¨ï¼èç¶²è·¯å¡ãç¡¬ç¢å¯è½æèªå·±çå§é¨è¨æ¶é«ï¼å²å­çè³æèå¨éçæ¶çä¾éä½è£ç½®ã
<strong>I/O Subsystem</strong> æ¯ OS çä¸åéè¦é¨åï¼è² è²¬ç®¡çç¨å¼ç I/O è«æ±ã</p>

<p><strong>I/O Subsystem</strong> çæ§å¶æµç¨éå¸¸å¦ä¸:</p>
<ol>
  <li>åå¨éä¸éå½ä»¤</li>
  <li>æ¼è¨æ¶é«åå¨éä¹éåè³æå³è¼¸</li>
  <li>éç¥èçå¨ãå·¥ä½å·²å®æã</li>
</ol>

<p><strong><a href="MMIO">Memory mapped I/O</a></strong><br />
ç®åä¸»æµä½¿ç¨ç I/O æ¹å¼</p>
<ul>
  <li>å°å¨éçæ§å¶ãæ«å­å¨ãè¨æ¶é«ãæ å°å° CPU çãè¨æ¶é«æ å°ç©ºé(Memory space)ã</li>
  <li>ä¾å¦ä½¿ç¨æä»¤: <code class="language-plaintext highlighter-rouge">MOV CX, 0xFFFFFFFF;</code> åè¨­ <code class="language-plaintext highlighter-rouge">0xFFFFFFFF</code> æ¯è£ç½®è¨æ¶é«ï¼å° CX register çå¼æ¾å°ä½ç½® <code class="language-plaintext highlighter-rouge">0xFFFFFFFF</code> å°±ç­æ¼åä¸å²å­è³æ</li>
</ul>

<p><img src="/image/2023/09-12-operating_system_introduction/3.png" alt="" height="75%" width="75%" /></p>

<blockquote>
  <p>ä¸åæ¨¡æ¬ä¸åå¯è½ç MMIOï¼DRAM èä¸åç Device åå¥è¢«æ å°å°ä¸åçè¨æ¶é«åæ®µãè£ç½®æèªå·±çæ§å¶æ«å­å¨ã
å»è¨­å®è®åçæä»¤ä¾å¨è£ç½®çæ¶çä¸å·è¡ï¼å¨è£ç½®æ«å­å¨è®å¯«çç¨å¼å°±è¢«ç¨±ä½<strong>(Device driver)é©åç¨å¼</strong></p>
</blockquote>

<p><strong><a href="PMIO">Port mapped I/O</a></strong><br />
ç®åå¨ä¸äºåµå¥å¼èçå¨ä¸ä½¿ç¨ï¼å çº x86 æ¯è¼å¤èçæ¶æ§å æ­¤ä¹ææ¯æ´ PMIO</p>
<ul>
  <li>ä½¿ç¨ç¹å¥çæä»¤ï¼å°è³æå³è¼¸å°ç¹å®çãPortãï¼æ³¨æ: Port å Memory space æ¯åéçå®åç©ºé
    <ul>
      <li>x86-32 ç I/O Port çå®åç©ºéåªæ 0~65535</li>
      <li>x86-32 çè¨æ¶é«å®åç©ºéåªæ 0~4G</li>
    </ul>
  </li>
  <li>ä½¿ç¨çæä»¤å½¢å¼å¦ä¸:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">out 0x255, AX;</code> å° AX register å¯«å° 0x255 Portï¼å°è£ç½®å¯«å¥è³æ</li>
      <li><code class="language-plaintext highlighter-rouge">in AX, 0x100</code> å¾ 0x100 Port å°è³æå¯«å° AX registerï¼å°è£ç½®è³æåå</li>
    </ul>
  </li>
</ul>

<p><img src="/image/2023/09-12-operating_system_introduction/4.png" alt="" height="75%" width="75%" /></p>

<blockquote>
  <p>DeviceãMemory åå¥ç¨ä¸åçå®åæ¹å¼ï¼I/O Bus çº 64K å³æå¤ 65536ï¼Memory åå¯ä»¥å°æå¤§ 4Gï¼éç¨®æ¶æ§ä¸æå®çéåº¦éå¸¸æ¯è¼æ¢ï¼å çº MMIO å¯ä»¥æ´ç°¡å®èç´æ¥çé²è¡ I/Oã</p>
</blockquote>

<blockquote>
  <p>å»¶ä¼¸é±è® <a href="https://stenlyho.blogspot.com/2008/08/io.html">I/Oå°æçæ¹å¼</a></p>
</blockquote>

<h5 id="115-io-subsystem-transfers-data">1.15 I/O Subsystem transfers data</h5>

<p>å³è¼¸è³æä¸ï¼ä¸è¬ä¾èªªä¸æä½¿ç¨ CPU é²è¡ï¼å çº CPU è¦åæ´éè¦çäºã<strong>DMA(Direct memory access)</strong> æ¯ç¸å°ç°¡å®çç¡¬é«ï¼
å°éç¨ä¾å<strong>ä¸»è¨æ¶é«å°ä¸»è¨æ¶é«çå³è¼¸</strong>æ<strong>è£ç½®è¨æ¶é«å°ä¸»è¨æ¶é«çå³è¼¸</strong>ã</p>
<ul>
  <li>ç°¡å®ç DMA åªè¦è¨æ¸å¨ï¼è¢«æ¬ç§»è³æçéå§ä½ç½®ï¼è¦æ¬å¥è³æçéå§ä½ç½®ï¼éæ¨£ä¸å Register å°±å®æä¸åè½æ¬ç§»é£çºè³æç DMA</li>
  <li>DMA å¯ä»¥å±¬æ¼ Bus çä¸é¨åï¼å¦: ISAï¼æèæ¯è£ç½®çä¸é¨åï¼å¦: PCI</li>
</ul>

<p><strong>(DMA and Cache)Coherency problem</strong></p>

<p>åªè¦æå©ç¨®ä»é¢å­ååä¸åå²å­è£ç½®å°±ä¸å®ææå¦ä½åæ­¥çåé¡</p>

<ul>
  <li>DMA ç´æ¥å­åè¨æ¶é«ï¼ä½ CPU éé Cache å­åè¨æ¶é«ï¼éé æè³æä¸ä¸è´(Cache çè³æä¸å®æ¯ Main memory æ°)
    <ul>
      <li>å¾è¨æ¶é«å¯«åºè³æå°è£ç½®æï¼å¿é å° cache çè³æ flush å°è¨æ¶é«(å¯«å¥ä¸»è¨æ¶é«)</li>
      <li>å¾è£ç½®è®åè³æå°è¨æ¶é«æï¼å¿é å invalid ç¸å°æç cache line</li>
    </ul>
  </li>
  <li>Alignment
    <ul>
      <li>DMA å³è¼¸çè³æçéå§åçµæä½ç½®ï¼éå¸¸è¦å Cache(Cache line) å Memory çå¯¬åº¦é²è¡å°é½</li>
      <li>éé¨åçéå¶å¯è½ä¾èªæ¼ DMA Controller ç´æ¥å°è³æä»¥ãåºå®çå¤§å°ãæ´æ°å° Cacheãä¾å¦: x86 æ¯ 64 å Byteï¼é£å³è¼¸è³æå°±è· 64 Byte å°é½ã<em>ç¡¬é«å¨éè£¡æ²æç¹å¥åèçï¼ä½¿å¾éå°é½çè³æä¹å¯ä»¥é¨ä»½æ´æ°</em></li>
    </ul>
  </li>
</ul>

<p><img src="/image/2023/09-12-operating_system_introduction/5.png" alt="" height="100%" width="100%" /></p>

<blockquote>
  <p>Disk è DRAM ä¹éçäº¤æä¹è¦ä½¿ç¨ buffer ä¾é²è¡äº¤æï¼æè½é¿åä½éè®å¯«å»å ç¨å¯¶è²´ç Bus è³æºãç¶ bufdisk å°è³æå³çµ¦ bufRAM å¾æ­¤æè¦èççå°±æ¯ bufcache è bufRAM ä¹éçä¸è´æ§</p>
</blockquote>

<p><strong>Cache è DMA çè³æä¸ä¸è´æ§è§£æ±ºä¹é</strong></p>

<ul>
  <li>(DEV =&gt; CPU) ä½¿ç¨ç¡¬é«è§£æ±ºï¼ç¡¬é«èªåæå° DMA çå³è¼¸æ´æ°å° Cache å§(Cache coherence algorithm)
    <ul>
      <li>æäºèçå¨ï¼ä¾å¦æ©æç ARM èçå¨ï¼éé¨åéè¦ç¹å¥çæä»¤è¨­å®è©²æ®µè¨æ¶é«çãå±¬æ§ã</li>
      <li>ä¾å¦ç´æ¥å°è©²æ®µè³æç´æ¥å¾ cache ä¸å®æ´ç§»é¤(flush)ï¼éæ¨£å°±è½ç¢ºä¿ CPU è®åè¨æ¶é«æå¾ Main memory è®å</li>
      <li>ç¨ç¡¬é«ä¾é²è¡èççè©±å¯ä»¥åæ®µå»èçï¼éæ¨£å°±è½å¨åæ®µä¸­å·å·å³è¼¸è³æï¼ç¸½æä¸äº Cycle æ²æè¢«ä½¿ç¨</li>
    </ul>
  </li>
  <li>(CPU =&gt; DEV) è¨­å®è® CPU å¨è©²è¨æ¶é«åæ®µé²è¡å¯«å¥æï¼ä½¿ç¨ Write through æ Noncacheableï¼ç´éè£ç½®ä¸çè¨æ¶é«
    <ul>
      <li><strong>Noncacheable</strong>: ç´æ¥å°è³æå¯«å¥è©²æ®µè¨æ¶é«èä¸éé Bufferï¼éæ¨£è½ç¢ºä¿ DMA çè³ææ¯ææ°çï¼ä½æéä½æè½ã</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>å»¶ä¼¸é±è® <a href="https://zhuanlan.zhihu.com/p/109919756">CacheåDMAä¸è´æ§</a></p>
</blockquote>

<h5 id="116-cpu-and-dma-compete-for-memory-access">1.16 CPU and DMA compete for memory access</h5>

<ul>
  <li>å¦æ CPU ç¼ç <strong>Last-level-cache(LLC) miss</strong> æï¼CPU å¯è½æå DMA ç­å¥ªå­åæ¬:
    <ul>
      <li>å¦æ CPU è¨ªå LLC æï¼å¦æç¼ç¾æ²ææéè¦çæ¸æï¼CPU å¯è½æåè©¦ç´æ¥å­å Main memoryï¼è¥æ­¤æ DMA ä¹æ­£å¨é²è¡å­åï¼
å°±æç¢çç­å¥ªå­åæ¬ã</li>
      <li>DMA æ¯æ¬¡é½åªå³è¼¸å°éè³æï¼é£å°±å¯ä»¥å¾å¿«çç¦®è®æ§å¶æ¬çµ¦ CPUï¼ä½éæ¨£çå³è¼¸æ¨¡å¼å¾æ²æç</li>
      <li>DMA åå¤§éå³è¼¸å¯ä»¥æå I/O çæè½ï¼ä½å¯è½æé æ CPU ç­å¾ DMA å®æå³è¼¸èéç½®</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>å»¶ä¼¸é±è® <a href="https://en.wikipedia.org/wiki/Burst_mode_(computing)">Burst mode</a></p>
</blockquote>

<p><img src="/image/2023/09-12-operating_system_introduction/6.png" alt="" height="100%" width="100%" /></p>

<ul>
  <li>ç®åå¨ PCI ä¸æ¯å Device é½æèªå·±ç DMA</li>
  <li><a href="https://en.wikipedia.org/wiki/Arbiter_(electronics)">Arbiter</a> ç¨ä¾åéä¸åç Device çå­åæ¬ï¼éå¸¸æ¯éåº¦è¶å¿«çè£ç½®åªåæ¬è¶é«</li>
</ul>

<p><strong>DMA çå¶ä»è­°é¡</strong></p>

<ul>
  <li>DMA çå®åç©ºé
    <ul>
      <li>é¨å DMA çå®åç©ºéå¯è½åªæ 32bitï¼OS å¿é ç¡å¯è½çå° DMA è½ä½¿ç¨çè¨æ¶é«ä¿ççµ¦ DMA ä½¿ç¨</li>
    </ul>
  </li>
  <li>I/O MMU
    <ul>
      <li>ä¸»è¦è® DMA å­åå¯¦é«ä½ç½®ä¸é£çºçè¨æ¶é«</li>
      <li>é¿åæ¡æçè£ç½®æé©åç¨å¼</li>
    </ul>
  </li>
  <li>DDIO (Data Direct I/O)
    <ul>
      <li>å¨æäº Intel å¹³å°ä¸ï¼DMA çå³è¼¸å¯ä»¥è·³é DRAM ç´æ¥å³è¼¸å° cacheï¼ä¾å¦: Xeon, DDIO</li>
      <li>ä¾å¦ ARM ä¸ç ACP(Access to Shared Caches)ï¼å³ä½¿ç¨ DMA å°éåè£ç½®é²è¡æä½ï¼
å¶å§å®¹ä¹æè¢«åæ­¥å° cache memory è£¡é¢ï¼åæ¬ L1 å L2 cache</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>Access to Shared Caches vs. Traditional methods</p>
</blockquote>

<p><img src="/image/2023/09-12-operating_system_introduction/7.png" alt="" height="100%" width="100%" /></p>

<h3 id="io-subsystem-notify-the-cpu">I/O Subsystem notify the CPU</h3>

<p><a href="./2023-09-12-operating_system_introduction.html#117-interrupt-hardware-concept">1.17 Interrupt hardware concept</a><br />
<a href="./2023-09-12-operating_system_introduction.html#120-interrupt-vector-table">1.20 Interrupt vector table</a><br />
<a href="./2023-09-12-operating_system_introduction.html#121-interrupt-service-routine">1.21 Interrupt Service Routine</a><br />
<a href="./2023-09-12-operating_system_introduction.html#122-bottom-half">1.22 Bottom half</a><br />
<a href="./2023-09-12-operating_system_introduction.html#123-bottom-half-and-top-half">1.23 Bottom half and Top half</a><br />
<a href="./2023-09-12-operating_system_introduction.html#124-polling">1.24 Polling</a><br />
<a href="./2023-09-12-operating_system_introduction.html#125-buffering">1.25 Buffering</a></p>

<p>OS äº¤ä»å·¥ä½çµ¦å¨éè£ç½®å¾ï¼æ¼å·¥ä½å®æå¾éç¥ CPU çæ¹æ³å¯ä»¥ä½¿ç¨:</p>
<ul>
  <li>Interrupt</li>
  <li>Polling</li>
  <li>Interrupt + Polling</li>
</ul>

<h5 id="117-interrupt-hardware-concept">1.17 Interrupt hardware concept</h5>

<p>Interrupt æ¯ä¸ç¨®æ¹è®ç¨å¼æ­£å¸¸å·è¡æµç¨çæ©å¶ï¼å¯ä»¥ç± Device æè CPU æ¬èº«ç¢ç</p>

<ul>
  <li>Legacy Interrupt
    <ul>
      <li>ç±å¯¦é«ç·è·¯æ§æï¼æ¯åè£ç½®é£æ¥å°å¯¦é«çä¸­æ·ç·ï¼ä¸­æ·ç·é£æ¥å° Programmable interrupt controller(PIC, å¯ç¨å¼åä¸­æ·æ§å¶å¨)ï¼PCI åå CPU ç INT è³ä½ç¼åºä¸­æ·è¨è</li>
      <li>PC ä¸­æ·ç·ä¹å°±å± 15 æ¢ï¼ä½æ¯ Device éå¸¸ä¸åª 15 åï¼å æ­¤å¿é æ¸åè£ç½®å±ç¨ä¸æ¢ä¸­æ·ç·</li>
    </ul>
  </li>
  <li>Message Signaled Interrupts
    <ul>
      <li>ææ Devices å±ç¨ä¸çµä¸­æ·ç·è·¯ï¼è£ç½®å¨ä¸­æ·ç·è·¯ä¸å¯«å¥èªå·±çä¸­æ·ç·¨èï¼å°±æè§¸ç¼ CPU ä¸­æ·</li>
      <li>éæ¨£å°±é¡ä¼¼å¨ä¸æ¢ç·ä¸å³è¼¸ç·¨ç¢¼ï¼ç¶éè§£ç¢¼å¨å¾æ¨å CPUï¼è® CPU å°èªå·±éåºä¸­æ·ï¼ä¾å¦: PCI ç MSI-X æ¯æ´ 2048 åä¸­æ·ç·¨è</li>
    </ul>
  </li>
</ul>

<p><img src="/image/2023/09-12-operating_system_introduction/8.png" alt="" height="100%" width="100%" /></p>

<blockquote>
  <p>CPU æè¨­è¨å¥½ IVT çä½ç½®ï¼ç± OS æ¾å¥é©ç¶ç ISR éé¨åä¹æ¯é©åç¨å¼(Device Drver) çä¸é¨å</p>
</blockquote>

<h5 id="120-interrupt-vector-table">1.20 Interrupt vector table</h5>

<ul>
  <li>Interrupt èçæµç¨:
    <ol>
      <li>Interrupt Request: ç¶ä¸­æ·è«æ±ç¼çæï¼å°ææä¸­æ· Disableï¼å° CPU åæå° Kernel mode</li>
      <li>Store State: æ«åç®åç Process ä¸¦ä¿å­æ­¤ Process çå·è¡çæ³</li>
      <li>Interrupt Vector Table: OS æ ¹æ Interrupt ID æ¥è©¢ IVTï¼ä¸¦åå¾ Interrupt Service Routine çéå§ä½ç½®</li>
      <li>Interrupt Service Routine: å·è¡ ISR</li>
      <li>Restore State: æ¢å¾©ä¹å Process çå·è¡çæ³
        <ul>
          <li>éæåä¸ä¸å®æ¢å¾©åæ¬ç Processï¼å çº System call å¯è½æ¹è® Process ççæï¼ç± Scheduler ä¾æ±ºå®ä¸ä¸åå·è¡ç Process(ä¸ä¸å®æ¯åæ¬ç Process)</li>
        </ul>
      </li>
    </ol>
  </li>
</ul>

<p><img src="/image/2023/09-12-operating_system_introduction/9.png" alt="" height="100%" width="100%" /></p>

<ul>
  <li>IVT æ¾ç½®çæ¯ ISR çéå§ä½ç½®
    <ul>
      <li>ISR éé ­é½æ¯ç¨çµèªå¯«çï¼å¦æ C çå·è¡ç°å¢è¨­å®å¥½ä¹å¯ä»¥ç¨ C</li>
    </ul>
  </li>
</ul>

<h5 id="121-interrupt-service-routine">1.21 Interrupt Service Routine</h5>

<p>ç¼ç Interrupt ææ¯ Disable Interruptï¼ä½å¨ ISR çæåå¯ä»¥è¦ææ³æ±ºå®æ¯å¦è¦ Enable Interruptï¼è¦åè¨±åªå¯« Interruptï¼å¦æå ISR ä¸­ Enable interrupt è¡¨ç¤ºåè¨±å·¢çä¸­æ·(Nested Interrupt)</p>

<ul>
  <li>Nested Interrupt: ãä¸åä¸­æ·ï¼è¢«å¦ä¸åä¸­æ·çµ¦ä¸­æ·ã</li>
</ul>

<p>Linux ä¸­ï¼ISR åªèçå¿é ç«å³èççé¨åï¼å©é¤çé¨åäº¤ç± Kernel thread èçãä¾å¦: ksoftirqd</p>

<ul>
  <li>ISR ä¸­ä¸è½å¼å«ä»»ä½æé æãwaitãçå½æ¸ï¼ä¾å¦: semaphore ä¸­ç <code class="language-plaintext highlighter-rouge">wait()</code>
    <ul>
      <li>å¾è¨­è¨ä¸ <code class="language-plaintext highlighter-rouge">wait()</code> çä¸»é«æ¯ task (can context swtich)ï¼ISR åªæ¯ä¸åæèªå·±å ççå½æ¸ï¼ä¸æ¯ task</li>
      <li>å¾éè¼¯ä¸ ISR æ¯èç I/O ä¸­çãå¿è¦é¨åã(ç·æ¥æ§)ï¼å æ­¤ä¸æè©² <code class="language-plaintext highlighter-rouge">wait()</code></li>
      <li>å¦æç¨å¼éè¼¯ä¸å¿é è¦ <code class="language-plaintext highlighter-rouge">wait()</code>ï¼å°±è¦èæ®æ¯å¦æéé¨åççµ¦ Bottom half è§£æ±º</li>
    </ul>
  </li>
</ul>

<h5 id="122-bottom-half">1.22 Bottom half</h5>

<p>Bottom half å¯ä»¥åçºä¸ç¨® softirq, tasklet, work-queue</p>
<ul>
  <li><strong>Softirq</strong> å¯ä»¥å¨å¤å CPU ä¸å¹³è¡éè¡ï¼å¿é å¨ç·¨è­¯æéæè¨»å</li>
  <li><strong>Tasklet</strong> æ¯å»ºç«å¨ softirq ä¹ä¸çä¸ç¨®æ©å¶ï¼tasklet å¯ä»¥åæè¨»ååé·æ¯ï¼ç¸åé¡åç tasklet ä¸è½å¨å¤å CPU ä¸åæéè¡</li>
  <li><strong>Work-queue</strong> æ¯ä¸ç¨®å®å¨ä¸åçæ©å¶ï¼work-queue å¯ä»¥ç¢ºä¿åä¸ç¨®é¡åç driver åªæå¨åä¸å CPU ä¸éè¡
å¾æè½é«ä½ä¸æ¯å¾å·¦å¾å³æåºï¼å¾æå¯«ç¨åº¦ä¸æ¯å¾å³å¾å·¦æåº</li>
</ul>

<p><img src="/image/2023/09-12-operating_system_introduction/10.png" alt="" height="100%" width="100%" /></p>

<ul>
  <li>çè«ä¸éä¸åé½æè©²ç± Kernel thread ä¾å¼å«
    <ul>
      <li>å¦ææ¯ Kernel thread(task) é£å°±å¯ä»¥ wait()</li>
    </ul>
  </li>
  <li>å¯¦éä¸ softirq, tasklet å¨ Linux kernel å¯ä»¥ç± Linux kernel æä¾çä¸å°æ®µç¨å¼ç¢¼å¨ ISR çµææå¼å«
    <ul>
      <li>éæ¨£çè©±ä»æ¯å·è¡å¨ ISR ä¸­ï¼éæ¨£æ¯ä¸è½ wait()</li>
    </ul>
  </li>
</ul>

<p>æè¨­è¨æ ISR ä¹å¯ä»¥å¼å«çåå æ¯ï¼å¦æéæ¬¡ ISR Loading ä¸¦ä¸éçæåå°±ä¹¾èå¨é¨çå·¥ä½é½å¨ ISR å®æï¼éæ¨£çæ¶èææ¯å¼å« Kernel thread æ´å°</p>

<p>å¨ <a href="./2023-09-12-operating_system_introduction.html#driver-architecture">Driver Architecture</a> ç¯ç« ææ´è©³ç´°çèªªæ</p>

<blockquote>
  <p>ksoftirqd æå¤å¯« 32 åé©åç¨å¼å¨è£¡é¢ï¼åªæé«éè£ç½®ææå¨ ksoftirqd ä¾å¦: Network Card</p>
</blockquote>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="https://stackoverflow.com/questions/7137209/difference-between-softirqs-and-tasklets">Difference between SoftIRQs and Tasklets</a>, <a href="https://stackoverflow.com/questions/14982589/tasklet-taskqueue-work-queue-which-to-use">tasklet, taskqueue, work-queue â which to use?</a></p>
</blockquote>

<h5 id="123-bottom-half-and-top-half">1.23 Bottom half and Top half</h5>

<blockquote>
  <p>Bottom half ç softirq æ¯å Core å°±åªæä¸å <code class="language-plaintext highlighter-rouge">ps -e | grep softirq</code></p>
</blockquote>

<p>å¨éè£¡ Top half, Bottom half åå¥æçæ¯:</p>
<ul>
  <li><strong>Top half</strong>: æ¯æä¾ç«å»é¿æç Interrupt æèççä¸­æ·å½æ¸ï¼å¨éåéæ®µå·è¡å¿«éä¸å¿è¦çç¡¬é«æä½ï¼å¦: ä¿å­çæï¼åå¼å« Bottom half</li>
  <li><strong>Bottom half</strong>: è· Top half çåå¥æ¯å·è¡æé Interrupt æ¯åç¨ç</li>
</ul>

<p>éè£¡é²å¥ Bottom half çå·¥ä½æè¢«åè£æä¸å Struct å©å Pointerï¼åå« Function, Dataï¼ç¶å¾å°éå Struct å å¥ä¸å Linked listï¼
ä¹å¾ç­å¾ CPU æç©ºéæ softirq æå¾ä¸­ååº Struct ä¾å·è¡ Bottom halfã</p>

<ul>
  <li><strong>Function pointer</strong>: è©²å½æ¸å®ç¾©äº Bottom half å¯¦éçå·è¡å·¥ä½ï¼åå«: èçè³æï¼ååå¦ä¸å I/O ç­ç­</li>
  <li><strong>Data pointer</strong>: æåå·¥ä½ç¸éçè³æï¼ç¡¬é«çè³æï¼è¦è¨ç®çåæ¸ï¼éè¦ä¿®æ¹ç Memory ç­ç­</li>
</ul>

<p>å¨ Linux ä¸­ï¼ç¶ top half æ±ºå®å°ä¸äºå·¥ä½æ¨é²å° bottom half æï¼éäºå·¥ä½æè¢«åè£æä¸åçµæ§ï¼è©²çµæ§åå«å©åææ¨ï¼ä¸åå½æ¸ææ¨åä¸åè³æææ¨Â¹ã</p>

<h5 id="124-polling">1.24 Polling</h5>

<blockquote>
  <p>å¦æç³»çµ±ç Loading å¾è¼ï¼ä¸¦ä¸ç³»çµ±è«æ±çæéæ¯è¼æ²è¦åæ Interrupt ææ¯è¼å¥½ï¼ä½å¦æè² è¼é« Interrupt è¢«ä¸æ·çéåºï¼
éæ¨£å¯è½æå°è´ CPU ä¸æ·çå»èç Interruptï¼æ­¤æ Polling ææ¯è¼å¥½</p>
</blockquote>

<ul>
  <li>è Interrupt ä¸åï¼Polling æ¯ OS æ¯éä¸æ®µæéä¸»åå»æ¢è©¢è£ç½®ççæ</li>
  <li>å¦ææ¸å Device å±ç¨åä¸æ¢ Interrupt é£éº¼ç¶ Interrupt ç¼çæï¼OS å¿é </li>
  <li>æäºè£ç½®åææ¯æ´ Interrupt å Pollingï¼ä¾å¦: Network Cardï¼å¯ä»¥å¨è² è¼éé«/ä½æååæ</li>
</ul>

<blockquote>
  <p>åæ»é¼ è·éµç¤å°±éå¸¸æ¯æ¡ç¨ Pollingï¼é¤éæç¹æ®éæ±ï¼ä¾å¦: é»ç«¶æ»é¼ </p>
</blockquote>

<h5 id="125-buffering-and-kernel-bypass">1.25 Buffering and Kernel bypass</h5>

<ol>
  <li>read(fd, buf, 200) æç¨æåå Register
    <ul>
      <li>read(): æ¬èº«å°±æ¯åæ¸(No. 3 Interrupt, $AX è¦è¨­å®çº 3)</li>
      <li>fd: å¾åªè£¡è®è³æ</li>
      <li>buf: buffer çèµ·å§ä½ç½®ï¼200 Buffer size</li>
    </ul>
  </li>
  <li>read å¼å«å¾ Kernel æéç½® krl_bufï¼DMA å³è¼¸æå°è³æå¾ dsk_buf æ¬ç§»å° krl_buk</li>
  <li>æå¾ç± Kernel å°è³æ Copy å° Userspace</li>
</ol>

<p><img src="/image/2023/09-12-operating_system_introduction/11.png" alt="" height="100%" width="100%" /></p>

<ul>
  <li><strong>Kernel bypass</strong>: æ¯æä¸éè¦éé Linux kernel çåè½ï¼ä½¿ç¨èªå·±å¯¦ç¾çç¸ååè½çç¨å¼ç¢¼ç´æ¥å° Device çè³æ Copy å° Userspace
    <ul>
      <li>éå¯ä»¥å¹«å©è§£æ±ºå¨é« concurrent ä¸ç±æ¼ Interrupt Handling, Memory Copy, Context switch, Locality miss, 
CPU Affinity, Memory Management æé æçæ§è½ç¶é ¸</li>
      <li>ä»£è¡¨çæè¡æ DPDK, eBPF ç­ç­</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="https://zhuanlan.zhihu.com/p/630976564">kernel-bypass åæ ¸æè·¯ææ¯ä»ç»</a></p>
</blockquote>

<h3 id="scheduler-and-file-system">Scheduler and File System</h3>

<h5 id="126-process-and-thread-of-linux">1.26 Process and Thread of Linux</h5>

<ul>
  <li>å¨ Linux æä¾ä¸å System call
    <ul>
      <li>fork(), vfork() ç¢ç Process</li>
      <li>clone() ç¢ç Task(Process, Thread)</li>
      <li>execve() å°ä¸åå·è¡æªå§çç¨å¼è¼å¥è©² Task ä¸­</li>
    </ul>
  </li>
  <li>å° Linux ä¾è¬ Process, Thread é½æ¯ Task
    <ul>
      <li>Linux ä½¿ç¨ Task struct ä¾æè¨´ Process, Thread</li>
      <li>Process, Thread çå·®ç°åªæ¯ãå±äº«è³æºçå¤å¯¡ãï¼å°¤å¶æ¯è¨æ¶é«æ¯å¦å±ç¨</li>
      <li>fork, vfork, clone é½æ¯å¼å« Kernel ä¸­ç do_fork</li>
    </ul>
  </li>
  <li>æä¸äº Thread åªå·è¡æ¼ Kernel modeï¼Linux ç¨±çº Kernel thread</li>
</ul>

<h5 id="127-scheduler">1.27 Scheduler</h5>

<blockquote>
  <p>å¦æåªèªª Scheduler éå¸¸æçæ¯ CPU Scheduler</p>
</blockquote>

<ul>
  <li>å³çµ±ä¸ Scheduler å¸æéæä»¥ä¸ç®æ¨
    <ul>
      <li>ä¾ç§åªåæ¬è³¦äºåªåæ¬çå¬å¹³æ§</li>
      <li>ææç Task é½å¯ä»¥å¨åççæéå§ï¼åæ¬¡ç²å¾ CPU ä½¿ç¨æ¬</li>
      <li>åªå I/O æè½ï¼ä¾å¦: èç I/O çè¨­åå¯ä»¥åå·è¡ï¼æ¥ä¸ä¾å·¥ä½äº¤çµ¦ I/O è¨­å</li>
    </ul>
  </li>
  <li>Linux æ´é²ä¸æ­¥çéå°ä»¥ä¸ç®æ¨
    <ul>
      <li>Multi-core ä¸è½åå° Load balance</li>
      <li>Scheduler æ¬èº«ä¸è³æ¼é æ Multi-core çæè½ç¶é ¸</li>
      <li>å°å¤åªé«ãéæ²ææ´å¥½çæ¯æ´ï¼CFS</li>
    </ul>
  </li>
  <li>Linux éæªéå°çç®æ¨
    <ul>
      <li>Real-time system çæ¯æ´</li>
      <li>Linux å¨ææ©ä¸ç Scheduler æ¯ iOS ç Scheduler æ´èé»(iOS ä¸¦ä¸æ¯çæ­£çå¤å·¥ OS)</li>
    </ul>
  </li>
</ul>

<h5 id="128-file-system">1.28 File system</h5>

<blockquote>
  <p>å¨æªæ¡ç³»çµ±è¦æ³¨æå°éäº: æ°æè¡å¦ï¼ SSDãç®¡ççåé¡(å¤§æªæ¡ãé¶ç¢æªæ¡)ãå­åè¡çº(å¾ªåº/é¨æ©å­å)ãæªæ¡çéè¤æ§åé¡ãæ··åç¡¬ç¢(SSD\HDD)</p>
</blockquote>

<ul>
  <li>Linux ä½¿ç¨ Virtual file system(VFS), å¼å®¹å¤ç¨®æªæ¡ç³»çµ±ï¼å¤§é¨åéäºæªæ¡ç³»çµ±é½ä½¿ç¨ã<strong><a href="https://en.m.wikipedia.org/wiki/Inode">i-node</a></strong>ãçæ¦å¿µæè¿°æªæ¡
    <ul>
      <li><strong><a href="https://en.m.wikipedia.org/wiki/Inode">i-node</a></strong>: ç¨æ¼æè¿°æªæ¡æç®éï¼è£¡é¢å²å­è³æçå±¬æ§åä½ç½®ï¼ä¾å¦: ææèãè¨±å¯æ¬ãå¤§å°ãæå¾ä¿®æ¹æéç­</li>
      <li><strong><a href="https://en.m.wikipedia.org/wiki/Virtual_file_system">VFS</a></strong>: ééçµ±ä¸çä»é¢ï¼ä½¿ç¡è«åºå±¤çæªæ¡ç³»çµ±æ¯ä»éº¼ï¼é½è½ééä»é¢èçï¼ä¾å¦: open(), read(), write()</li>
      <li><strong><a href="https://en.m.wikipedia.org/wiki/File_system">File system</a></strong>: ç¨æ¼ç®¡çåºå±¤è£ç½®è³æå­åçæ©å¶ï¼ä¾å¦: ext4, NTFS, FAT32 â¦</li>
    </ul>
  </li>
  <li>Linux å®æ¹ç File system æ¯ ext4â
    <ul>
      <li><strong>ext4</strong>ï¼ æ¯ Journaling file systemï¼å æ­¤ç¶ç¼çæå¤ï¼æªæ¡ç³»çµ±ä¸è³æ¼å®å¨ææ¯ï¼ä¸¦ä¸è½å¿«éæ¢å¾©(fsck.ext4)</li>
    </ul>
  </li>
  <li>Linux æ¯æ´ <strong><a href="https://zh.m.wikipedia.org/zh-tw/Btrfs">btrfs</a></strong>ï¼btrfs åç¨äº zfs çå¾å¤æ¦å¿µï¼ä¸»è¦åæ¬:
    <ul>
      <li>snapshot, copy-no-write, hot plugging HDD/SSD, difference disk load balance, backup support</li>
    </ul>
  </li>
</ul>

<h3 id="hardware-progress">Hardware progress</h3>

<p><a href="./2023-09-12-operating_system_introduction.html#129-smp-and-cmp">1.29 SMP and CMP</a><br />
<a href="./2023-09-12-operating_system_introduction.html#130-single-isa-heterogeneous-multi-core">1.30 Single-ISA heterogeneous multi-core</a><br />
<a href="./2023-09-12-operating_system_introduction.html#131-uma-and-numa">1.31 UMA and NUMA</a></p>

<ul>
  <li>ç®åå·²ç¶å¾é£æå CPU ç Clock
    <ul>
      <li>ç¸åæ¶æ§ä¸ï¼æå Clock æ¯æç´æ¥æ¹å¼ä¾çæå Performance</li>
      <li>æé« Clock æéå°å¤§éçç±ï¼ä¹æ¯æåæè½çç¶é ¸</li>
    </ul>
  </li>
  <li>Processor, Menory, Storage ç­ç­èç±ä¸æ·çãè¤è£½ï¼è²¼ä¸ãç¢çå¹³è¡éä½
    <ul>
      <li>å¹³è¡éä½å¾å¾éè¦è»ç¡¬é«çµå</li>
      <li>å¾å¤æåï¼ç¡¬é«æä¾ãå¤ç¨®é¸æãçµ¦è»é«é²è¡åªå</li>
    </ul>
  </li>
</ul>

<p><img src="/image/2023/09-12-operating_system_introduction/14.png" alt="" height="100%" width="100%" /></p>

<blockquote>
  <p>å¯«å¹³è¡åç¨å¼ï¼ç¨å¼ç¢¼æ¯å¹´å¯ä»¥æ 23% çæè½æåï¼å¦ååªæ 4.6%</p>
</blockquote>

<p>å¹³è¡èçæ¶æ§æçæ¯ãåæä½¿ç¨å¤å Process(Core)ãä¾å¦: PC å¸¸è¦ç Multi-Core Process
<strong>ä»çåªé»</strong>:</p>
<ul>
  <li>æé«ç¢è½: å¨å·¥ä½å¯ä»¥å¹³è¡åæï¼ç¢è½å°ä»¥åæ¸æå</li>
  <li>ææ¬èé: ç¸è¼æ¼é«æèç Processorï¼å·¥ä½å¹³è¡åå¾ï¼æ¸åæèä½ç Processor è½å¾å°ä¸æ¨£çææ</li>
  <li>å¢å å¯é åº¦: é«éä¼ºæå¨å¯ä»¥æä¾ Processor, Memory ç±ææçåè½ï¼ä¾å¦: Linux, å¯ä»¥å¨ä¸åæ©çææ³ä¸æ´æ CPU</li>
</ul>

<h5 id="129-smp-and-cmp">1.29 SMP and CMP</h5>

<ul>
  <li><em><a href="https://en.m.wikipedia.org/wiki/Symmetric_multiprocessing">Symmetirc multiprocessor</a></em>(SMP, å°ç¨±å¤èç)
    <ul>
      <li>æ¯å Processor çå°ä½æ¯ç­å¹çï¼æç¨ç¨å¼å¯ä»¥å¨éäºèçå¨ä¸åè½ç§»(migration)</li>
      <li>å¨éåæ¶æ§ä¸ææ Processor é½å±äº«ä¸åå±åç Main memoryï¼æå¯è½æå°è´è¨æ¶é«å­åè¡çªèå½±é¿æè½</li>
    </ul>
  </li>
  <li><em><a href="https://en.m.wikipedia.org/wiki/Multi-core_processor">Chip multiprocessor</a></em>(CMP, å®æ¶çå¤èç) ä¹ç¨±ä½ <strong>Multi-core</strong>
    <ul>
      <li>å°å¤é¡ (Core)Processor éæè³ä¸é¡æ¶ç</li>
      <li>æ¯å Core é½æèªå·±ç Cache å¯ä»¥æ¸å°å°å±ç¨ Memory çå­åéæ±</li>
      <li>å±äº«æä¸å±¤ç Last level cache(LLC)ï¼å æ­¤ä¸å Core ä¹éçè½ç§»æ¯è¼å¿«é</li>
    </ul>
  </li>
  <li><em><a href="https://en.m.wikipedia.org/wiki/Simultaneous_multithreading">Simultaneous multithreading</a></em>(SMT, åæ­¥å¤å·è¡ç·)
    <ul>
      <li>å¨ä¸é¡ Processor ä¸ç¨ç¡¬é«æ¨¡æ¬åº N é¡ Processï¼ç¡¬é«çä¸»è¦ææ¬æ¯ Logical register æ¸éå¢å  N å</li>
      <li>è½æ´ææçå©ç¨ Processor å§é¨ç Function unitï¼å¦: å æ³å¨ï¼ä¹æ³å¨ç­</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>Intel å®£ç¨±ä»åå¯¦ç¾ç SMT(Hyper-threading) å¢å  5% çæ¶çé¢ç©ï¼å¯ä»¥ç²å¾ 15% ~ 30% çæè½æå<br />
AMD æ¼ 2017 æ¨åºç Zen CPU ä¹å¯¦ç¾äº SMT</p>
</blockquote>

<p><img src="/image/2023/09-12-operating_system_introduction/12.png" alt="" height="100%" width="100%" /></p>

<blockquote class="block-warning">
  <p>ä¸æ¹å³åæå©å Instruction flow(Register set) å»ç«¶ç­è³æºï¼ä¾å¦: Floating point unit, Adder, Loader, Storer<br />
SMT ä¸æ¯å»å¢å ç³»çµ±çéåº¦ï¼æ¯å¢å ç³»çµ±çä½¿ç¨çï¼åææ¯æè¶³å¤ ç Task è·é²è¡çéç®å¯ä»¥ <a href="https://en.m.wikipedia.org/wiki/Loop_unrolling">Loop unrolling</a>ï¼<br />
ä¾å¦: Fibonacci å çºæ¯æ¬¡é½å¿é ç®åºåä¸åæ¸å­æè½ç¹¼çºå¾é¢æ¸å­çéç®</p>
</blockquote>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="https://stackoverflow.com/questions/8171141/algorithm-efficiency-is-partially-unrolling-a-loop-effective-if-it-requires-mo">Algorithm Efficiency - Is partially unrolling a loop effective if it requires more comparisons?</a></p>
</blockquote>

<h6 id="130-single-isa-heterogeneous-multi-core">1.30 Single-ISA heterogeneous multi-core</h6>

<ul>
  <li>å¨å­¸è¡ä¸æ¯å¤åèçå¨ï¼éäºèçå¨ä½¿ç¨åæ¨£çæä»¤éï¼ä½æ¯èçå¨çå§é¨è¨­è¨(Micro-Architecture)ä¸å
    <ul>
      <li>ä¾å¦: Clockï¼Pipeline depthï¼Funciont unit number</li>
      <li>æäºç¨å¼æä»¤å¹³è¡åº¦é«ï¼é©å PipelineãSuperscalar</li>
      <li>æäºç¨å¼æä»¤å¹³è¡åº¦ä½ï¼é©å In-order issueãHigh clock processor</li>
      <li>å  Instruction set ç¸åï¼OS å¯ä»¥å¹«åé©ç Task æé¸é©åç Processor</li>
    </ul>
  </li>
  <li>ARM ä¸å¯¦ç¾ç Big-Little æ¶æ§æ¯ä¸è¿°çä¸åå¯¦ç¾
    <ul>
      <li>éç¶ Processor éç®éåº¦ä¸åï¼ä½å¶ Instruction set ç¸å®¹</li>
      <li>OS å¯ä»¥ä¾ç§éæ±ä½¿ç¨é«æè½ Processor(Big) æçé»å Processor(Little)</li>
    </ul>
  </li>
</ul>

<p><img src="/image/2023/09-12-operating_system_introduction/13.png" alt="" height="100%" width="100%" /></p>

<blockquote>
  <p>å¨ Big.Little ä¸­å¯ä»¥å Task migrationï¼éé¨åæ¯ OS è· Programmer éè¦å»èæ®ç</p>
</blockquote>

<ul>
  <li>SMT æ¯ç± DM Tullsen, SJ Eggers, HM Levy ææåº
    <ul>
      <li>Simultaneous multithreading: Maximizing on-chip parallelism, ISCA, 1995.</li>
      <li>Intel æ¼ 2002 å¯¦ç¾éåæ§æ³ï¼ä¸¦å°å®ç¨±ä¹çº hyperthreading</li>
    </ul>
  </li>
  <li>Big.LITTLE çæ¦å¿µç± R Kumar, KI Farkas, NP Jouppi, P Ranganathan, DM Tullsen æåº
    <ul>
      <li>Single-ISA heterogeneous multi-core architectures: The potential for processor power reduction, MICRO, 2003.</li>
    </ul>
  </li>
  <li>æ´å²å®³çæ¯ï¼éäºåæ¶æ§çåµæ³ä¾èªæ¼åä¸åå¯¦é©å®¤
    <ul>
      <li>https://cseweb.ucsd.edu/~tullsen/</li>
    </ul>
  </li>
</ul>

<h5 id="132-uma-and-numa">1.32 UMA and NUMA</h5>

<ul>
  <li>ç®åçºæ­¢(2018)æä½¿ç¨ç Processor memory architecture å¤§é¨åçº <strong><a href="https://en.m.wikipedia.org/wiki/Uniform_memory_access">Uniform memory access</a></strong>(UMA)
    <ul>
      <li>å¤§è´ä¸å¯ä»¥èªª: æ¯å Processor å­åä»»ä½ä½ç½®ç Memory çéåº¦é½æ¯ç¸ç­ç</li>
      <li>UMA æ¶æ§ä½¿ç¨ä¸å¥è¨æ¶é«ææ§½ï¼ä¹å°±æ¯å±äº« Memory bus</li>
      <li>å°æ¼ UMA Processor èè¨ï¼ç¶ Processor å¢å æï¼è¨æ¶é«é »å¯¬æ¯æè½ç¶é ¸æå¨(Intel core i9 æ¯æ 18C36T ç UMA Processor)</li>
    </ul>
  </li>
  <li><strong><a href="https://en.m.wikipedia.org/wiki/Non-uniform_memory_access">Non-Uniform memory access</a></strong>(NUMA)
    <ul>
      <li>å³çµ±ä¸æ¯æå©åä»¥ä¸ç CPUï¼å¦é¨åæ©æ¶å¼ä¼ºæå¨: HP DL380 Gen7</li>
      <li>AMD ç threadripper å°å©é¡ CPU å°è£å¨ä¸èµ·ï¼threadripper ä¸å¯ä»¥çå°å©å DRAM ææ§½</li>
      <li>å° NUMA ä¾èªªè¨æ¶é«åçº Local, Remoteï¼å­å Local æçéåº¦æè¼å¿«</li>
    </ul>
  </li>
</ul>

<p><img src="/image/2023/09-12-operating_system_introduction/15.png" alt="" height="100%" width="100%" /></p>

<p><img src="/image/2023/09-12-operating_system_introduction/16.png" alt="" height="100%" width="100%" /></p>

<blockquote>
  <p>éæ¨£çåæ³å©éé½ææç¨ç«æ§å¶ç Memory busï¼é¿åäºé¨åçè¨æ¶é«é »å¯¬çæè½ç¶é ¸</p>
</blockquote>

<h3 id="driver-architecture">Driver Architecture</h3>

<p>Driver ä¸­å¯å»¶é²èç(Bottom half) çå½¢å¼å°±åæä¸ç¨®ï¼éé¨åå¨ <a href="./2023-09-12-operating_system_introduction.html#122-bottom-half">Bottom half</a> ç°¡å®æé:</p>

<ul>
  <li>softirq(è»ä¸­æ·)
    <ul>
      <li>softirq æ¯æ´ SMPï¼åä¸å softirq å¯ä»¥å¨ä¸åç CPU ä¸åæéè¡ï¼softirq å¿é æ¯ <strong><a href="https://en.m.wikipedia.org/wiki/Reentrancy_%2528computing%2529">Reentrancy</a></strong>(å¯éå¥ç)</li>
      <li>softirq æ¯å¨ç·¨è­¯æééæè¨»åï¼ä¸å tasklet é£æ¨£è½è¢«åæè¨»åæå»é¤</li>
      <li>HI_SOFTIRQ, TIMER_SOFTIRQ, NET_TX_SOFTIRQ, NET_RX_SOFTIRQ, SCSI_SOFTIRQ, TASKLET_SOFTIRQ</li>
      <li>åºæ¬ååæ¯ä½¿ç¨å¨é«éè£ç½®æè©²è£ç½®ä¸è½è¢«å»¶é²ï¼å¦: Network RX/TX, Timer inputerret, Disk, <strong>tasklet</strong></li>
    </ul>
  </li>
</ul>

<p>softirq å¨ Kernel ç·¨è­¯æ¯å°±å·²ç¶å®ç¾©ãè¨»åå¥½ï¼éå¸¸æ¯ä¸æå»åæ¹å¯«ãæä½¿ç¨ softirq çåå ä¸»è¦æ¯å çºç¼ç¾ I/O çæè½ç¶é ¸æ¯å¨ CPUï¼
åææ¯è¦æè¶³å¤ ç Processorã</p>

<ul>
  <li>tasklet
    <ul>
      <li>tasklet ä¸åè¨±å©åç¸åé¡åç tasklet åæå·è¡ï¼å³ä½¿å¨å©å</li>
    </ul>
  </li>
  <li>work-queue
    <ul>
      <li>ç± Kernel theard ä¾å¯¦ç¾ï¼æä»¥å¯ä»¥è¢« context switch(åå©ç¨®åªè½è¢« ISR ææ·)</li>
      <li>é©åéè¦é·æéå·è¡ï¼æéè¦ seelp</li>
      <li>é»èªå¯ä»¥è¢« Interruptï¼ä¸ææä»»ä½ Locked</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="https://embetronicx.com/tutorials/linux/device-drivers/softirq-in-linux-kernel/">V-Softirq in Linux Device Driver â Linux Device Driver Tutorial</a>, <a href="https://zhuanlan.zhihu.com/p/361409809">Linux softirq, tasklet, workqueue</a></p>
</blockquote>

<p><strong>ä¸é¢æ¯ Interrupt é¢éæè§¸ç¼ softirq çæµç¨èç¨å¼ç¢¼</strong>:</p>

<p><img src="/image/2023/09-12-operating_system_introduction/17.png" alt="" height="75%" width="75%" /></p>

<p>ksoftirq æ¯å¨ Kernel thread æå»å¼å« Loopï¼éå Loop æä¸æ·å»æ¿å·¥ä½ä¾åï¼éå Loop å¯ä»¥è¢« ISR æ ksoftirqd å¼å«ï¼
å¦ææ¯ç± ksoftirqd å¼å«é£å°±å¯ä»¥ sleepï¼ä½å¦ææ¯ç± ISR å¼å« Loop åæ¯å·è¡å¨ Interrupt context é£å°±ä¸è½ sleepã</p>
<ul>
  <li>æè¨­è¨ ISR å¯ä»¥å¼å« Loop çåå æ¯ Linux çºäºåªåï¼å¦æ Interrupt æè§¸ç¼çå·¥ä½ä¸¦ä¸å¤ï¼å°±ä¹¾èå¨ ISR ä¸­èçå®</li>
  <li>è¥æ¯ç± ksoftirq å¼å«å°±æè® Interrupt åçµæï¼å¾çºè® Scheduler ä¾å®æ Task é²è¡å·¥ä½</li>
</ul>

<p><img src="/image/2023/09-12-operating_system_introduction/18.png" alt="" height="75%" width="75%" /></p>

<p><img src="/image/2023/09-12-operating_system_introduction/19.png" alt="" height="75%" width="75%" /></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">invoke_softirq()</code> æå» Loop ä¸­æ¿åå·¥ä½ä¾å·è¡
    <ul>
      <li><code class="language-plaintext highlighter-rouge">force_irqthreads</code> ç¨éåè®æ¸ä¾å¤å¥æ¯ Interrupt context å¼å«éæ¯ Kernel thread</li>
      <li><code class="language-plaintext highlighter-rouge">__do_softirq()</code>, <code class="language-plaintext highlighter-rouge">do_softirq_own_stack()</code> é½æ¯å»å·è¡ softirqï¼å·®ç°å¨ IRQ STACK è©³ç´°å¯è¦å»¶ä¼¸é±è®</li>
      <li><code class="language-plaintext highlighter-rouge">wakeup_softirqd()</code> åæ¯å«é ksoftirqd æå©ä¸çå·¥ä½äº¤çµ¦ ksoftirqd ä¾æç¨</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>å»¶ä¼¸é±è®: <a href="http://www.wowotech.net/irq_subsystem/soft-irq.html">Linux kernelçä¸­æ­å­ç³»ç» softirq</a></p>
</blockquote>

<p><strong>ç¸è¼æ¼ softirq, work-queue çæµç¨å®ç´å¾å¤ï¼ä¸æéè¡å¨ Interrupt context:</strong></p>

<p><img src="/image/2023/09-12-operating_system_introduction/20.png" alt="" height="75%" width="75%" /></p>

<p><strong>General rules for driver writing</strong></p>

<p>å±ç¨çè³æè·èª°å±ç¨ï¼éæ¹æ¯å¦æåæå·è¡:</p>
<ul>
  <li>æ: å°±è¦ä½¿ç¨ spinlock(Mulit-Processor)ãsemaphore(Signle-Processor)</li>
  <li>ä¸æï¼é£è¦æ³¨ææ¯å¦æ Preempt:
    <ul>
      <li>èª°æ Preemmpt èª°</li>
      <li>å¦æå®ä¸æ¹åå¦ A Preempt Bï¼B å» Disable A å°±ä¸ææ Rest conditionï¼ä¾å¦: Scheduler, Local IRQ, Bottom half</li>
      <li>å¦ææ¯éåç Preempt é£å°±æ¯æåæå·è¡</li>
    </ul>
  </li>
  <li>è¦å¾æ¸æ¥ç¨å¼ä¸­é±èçææ
    <ul>
      <li>ä¾å¦: malloc æ¯å¦æé æ Context switch, write æå I/O åä½æä¸æ Context switch</li>
    </ul>
  </li>
</ul>

<h3 id="start-the-os">Start the OS</h3>

<h5 id="133-start-the-os">1.33 Start the OS</h5>

<blockquote>
  <p>çºä»éº¼ä¸è½ç´æ¥å¾ Disk åå OSï¼éæ¯å çº Disk ä¹éè¦ Driver ä¾åå</p>
</blockquote>

<ul>
  <li>CPU è½ç´æ¥æ§å¶ DARM, ROM æ¯å çºéå©èé½æ¯ Byte address
    <ul>
      <li>CPU åªè¦å¨ Address bus ä¸æ¾å¥è¦è®åçè³æç Address å°±è½å¾ Data bus ä¸è®åæ³è¦çè³æ</li>
    </ul>
  </li>
  <li>Disk å±¬æ¼ Block device éè¦ä¸éå½ä»¤åè¨´ Disk éè¦ç¬¬å¹¾å Blockï¼ä¹å¾ Disk åè¬ Block å¯«å°è»é«æå®çä½ç½®ï¼å¦ï¼ (ATA-8, <a href="https://en.m.wikipedia.org/wiki/ATAPI">ATAPI</a>)</li>
</ul>

<p>å¦ææ²æè»é«é©åçææ³ä¸ CPU ç¡æ³ç´æ¥è®å Diskï¼å æ­¤éè¦å¨ PC æ¶æ§ä¸­å¨ Boot rom ä¸­æ¾å¥ãBIOSãï¼
BIOS çéè¦ç®çå°±æ¯è®å Disk ä¸ç <a href="https://www.lifewire.com/what-is-a-boot-sector-2625815">Boot sector</a>ã</p>

<p><img src="/image/2023/09-12-operating_system_introduction/21.png" alt="" height="50%" width="50%" /></p>

<p><strong>Bootstrap</strong></p>

<ol>
  <li>BIOS(ROM) è®å Boot sector(éå¸¸æ¯ Disk ä¸çç¬¬ 0 å Block)</li>
  <li>BIOS æå¸¶èµ·ä¾çæ¯ GRUB(Boot loader)ï¼ç¾å¨ä¹å¯ä»¥å¾ BIOS ä½¿ç¨ UEFI(BIOS ä¹èªå¾ OS)</li>
  <li>å¦æå¸¶èµ·ç OS æ¯ Linux é£éº¼å°±å¿é æéæ©ç¸éçæªæ¡æ¾å¨ /boot ä¸ï¼ä¸¦ä¸ GRUB èªå¾è©²ç®éä½¿ç¨çæªæ¡ç³»çµ±</li>
  <li>Linux kernel åææè£ç½®çæï¼æ ¹æè£ç½®çæéç½®è¨æ¶é«(Virtual memory layout)ï¼ä¹å¾ååå Cache
    <ul>
      <li>åè¨­å® Virtual memory æ¯å çºéè£¡å¿é å°æ å°å° I/O çé¨åè¨­å®çº Non-cached</li>
    </ul>
  </li>
  <li>Linux kernel ååå¾ï¼ååç¬¬ä¸å User space çç¨å¼ï¼å³çµ±ä¸æ¯ initï¼ä¹æè¨±å¤ Linux æ¹ç¨ systemdï¼ä»åç pid é½æ¯ 1ï¼
è² è²¬ Linux å¾çºçåå§å</li>
</ol>

<blockquote>
  <p>éè£¡æ¯å çºå°æ I/O çåæ®µ(ä¾å¦: DMA)ï¼ä¸å¸æéäºæä½è¢« Cacheï¼å¦æè¢« Cache å¯è½æå°è´è³æä¸ä¸è´ï¼å æ­¤è¦åè¨­å® Non-cached</p>
</blockquote>

<p><strong>BIOS limitations</strong></p>

<ul>
  <li>BIOS å¿é è¦èªå¾ Disk ä¸çéæ© Blockï¼å¦æ BIOS ä¸æ¯æ´è©² Diskï¼å°ç¡æ³åå OS(ä¾å¦: å®¹éè¶é BIOS çå®åç¯å)</li>
  <li>BIOS å§å«å¤ç¨®é©åç¨å¼ï¼ä¾å¦è¦æ¯æ´ USB
    <ul>
      <li>å¤§é¨å BIOS ä¸æ¯æ´èè½è£ç½®ï¼å æ­¤éæ©æçèè½æ»é¼ ï¼éµç¤ç­ç­é½ä¸è½è BIOS äºå</li>
    </ul>
  </li>
</ul>

<blockquote class="block-warning">
  <h5 id="last-edit">Last Edit</h5>
  <p>10-09-2023 18:27</p>
</blockquote>

</section>
            </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div></div>
        <div class="normal">
            <section class="normal">
                
                <i class="fa fa-eye"></i>
                <span id="page-hit-tracker"></span>, 
                <i class="fa fa-archive"></i>
                
                OS
                
                
            </section>
        </div>
    </div>
<script async src="https://www2.cs.ccu.edu.tw/~xbs112m/tracker.php"></script>
</div>

<!-- introduce mathjax support -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ['$', '$'], ['\\(', '\\)'] ]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script
  type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>


<!-- introduce per-page mermaid support -->


<!-- introduce mathjax support -->
<script>
    function fixes_chrome_anchors() {
        let chrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
        if (window.location.hash && chrome) {
            setTimeout(function () {
                var hash = window.location.hash;
                window.location.hash = "";
                window.location.hash = hash;
            }, 300);
        }
    }

    if (document.readyState === "loading") {
        // Loading hasn't finished yet
        document.addEventListener("DOMContentLoaded", fixes_chrome_anchors);
    } else {
        // `DOMContentLoaded` has already fired
        fixes_chrome_anchors();
    }
</script>

<!-- customize line 38-50 swap next previous-->
                    
                        <a href="/jekyll/2023-09-20-compiler_introduction.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Paper | Test Case Generation Based on Constraint Logic Graph">
                            <i class="fa fa-angle-left"></i>
                        </a>
                    

                    
                        <a href="/jekyll/2023-09-07-test_case_generation_based_on_constraint_logic_graph.html" class="navigation navigation-next navigation-unique" aria-label="Next page: Compiler | Compilers Introduction">
                            <i class="fa fa-angle-right"></i>
                        </a>
                    
                </div>
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "next": {
            "title": "Compiler | Compilers Introduction",
            "level": "1.2",
            "depth": 1,
            "path": "_posts/2023/2023-09-20-compiler_introduction.md",
            "ref": "_posts/2023/2023-09-20-compiler_introduction.md",
            "articles": []
        },
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "expandable-chapter-small2": {
                "articlesExpand": true,
            },
            "fontsettings": {
                "family": "sans",
                "size": 1,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},            "sharing": {
                "facebook": false,

                "google": false,

                "github": true,
              
                "github_link": "https://github.com",
              

                "telegram": false,
                "telegram_link": "https://t.me",

                "instapaper": false,

                "twitter": false,
              

                "vk": false,

                "weibo": false,

                // "all": ["facebook", "google", "twitter", "weibo", "instapaper", "github", "telegram"]
            },
"theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            },
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "Home.md",
        },
        "variables": {},
        "title": "Home",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "_posts/2023/2023-09-12-operating_system_introduction.md",
        "mtime": "2023-09-12 00:00:00 +0000",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2025-09-16 12:46:29 +0000"
    },
    "basePath": "",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/assets/gitbook/gitbook.js"></script>
<script src="/assets/gitbook/theme.js"></script>

<script src="/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
<script src="/assets/gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
<script src="/assets/gitbook/gitbook-plugin-expandable-chapters-small2/expandable-chapters-small.js"></script>
<script src="/assets/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
<script src="/assets/gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
<script src="/assets/gitbook/gitbook-plugin-search-pro/search.js"></script>
<script src="/assets/gitbook/gitbook-plugin-sharing/buttons.js"></script>
<script src="/assets/gitbook/gitbook-plugin-splitter/splitter.js"></script>

<!--
<script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script>
-->

</body>
</html>